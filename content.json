{"meta":{"title":"milkomeda","subtitle":null,"description":null,"author":null,"url":"http://www.rainend.org","root":"/"},"pages":[{"title":"","date":"2022-02-05T07:40:23.062Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/index.html","permalink":"http://www.rainend.org/A-Dark-Room/index.html","excerpt":"","text":"小黑屋 if(!window.jQuery) { document.write('') } var oldIE = false; 游戏保存完毕."},{"title":"about","date":"2018-12-12T14:14:36.000Z","updated":"2022-04-05T08:37:10.188Z","comments":false,"path":"about/index.html","permalink":"http://www.rainend.org/about/index.html","excerpt":"","text":"[灼え落ちぬ六等星] 与&nbsp; Walnut&nbsp; （ 真（ま）白（しろ） ） 对话中... bot_ui_ini()"},{"title":"bangumi","date":"2019-02-10T13:32:48.000Z","updated":"2020-03-16T10:41:30.000Z","comments":false,"path":"bangumi/index.html","permalink":"http://www.rainend.org/bangumi/index.html","excerpt":"","text":""},{"title":"分类","date":"2022-01-23T21:33:09.000Z","updated":"2022-01-31T07:57:31.082Z","comments":false,"path":"categories/index.html","permalink":"http://www.rainend.org/categories/index.html","excerpt":"","text":""},{"title":"client","date":"2018-12-20T15:13:35.000Z","updated":"2020-03-16T10:41:30.000Z","comments":false,"path":"client/index.html","permalink":"http://www.rainend.org/client/index.html","excerpt":"","text":"直接下载 or 扫码下载："},{"title":"donate","date":"2018-12-20T15:13:05.000Z","updated":"2022-02-07T12:17:30.731Z","comments":false,"path":"donate/index.html","permalink":"http://www.rainend.org/donate/index.html","excerpt":"","text":""},{"title":"comment","date":"2018-12-20T15:13:48.000Z","updated":"2022-04-05T08:39:07.486Z","comments":true,"path":"comment/index.html","permalink":"http://www.rainend.org/comment/index.html","excerpt":"","text":"念两句诗 叙别梦、扬州一觉。 【宋代】吴文英《夜游宫·人去西楼雁杳》"},{"title":"lab","date":"2019-01-05T13:47:59.000Z","updated":"2020-03-16T10:41:30.000Z","comments":false,"path":"lab/index.html","permalink":"http://www.rainend.org/lab/index.html","excerpt":"","text":"sakura主题balabala"},{"title":"links","date":"2018-12-19T15:11:06.000Z","updated":"2022-04-05T08:38:08.817Z","comments":true,"path":"links/index.html","permalink":"http://www.rainend.org/links/index.html","excerpt":"","text":""},{"title":"music","date":"2018-12-20T15:14:28.000Z","updated":"2022-01-28T13:36:35.899Z","comments":false,"path":"music/index.html","permalink":"http://www.rainend.org/music/index.html","excerpt":"","text":""},{"title":"rss","date":"2018-12-20T15:09:03.000Z","updated":"2020-03-16T10:41:30.000Z","comments":true,"path":"rss/index.html","permalink":"http://www.rainend.org/rss/index.html","excerpt":"","text":""},{"title":"shuoshuo","date":"2022-04-02T13:58:54.417Z","updated":"2022-04-02T13:58:54.417Z","comments":false,"path":"shuoshuo/index.html","permalink":"http://www.rainend.org/shuoshuo/index.html","excerpt":"","text":"new Artitalk({ appId: 'rBd5iq33dNffzQP20eFIItSg-MdYXbMMI', // Your LeanCloud appId appKey: '8kCSBjCCuX0zUKYpszlHcVud' // Your LeanCloud appKey })"},{"title":"shuoshuo","date":"2022-03-27T14:07:41.147Z","updated":"2022-03-27T14:04:22.710Z","comments":false,"path":"shuoshuo/index1.html","permalink":"http://www.rainend.org/shuoshuo/index1.html","excerpt":"","text":"想要开学，想吃火锅，想吃烧烤，想吃蟹肉煲，想吃鸡脚米线，想喝奶茶~ 2020年2月25日 test文字 2020年2月25日 第一个说说 2020年2月25日 &lt;/div&gt; (function () { var oldClass = \"\"; var Obj = \"\"; $(\".cbp_tmtimeline li\").hover(function () { Obj = $(this).children(\".shuoshuo_author_img\"); Obj = Obj.children(\"img\"); oldClass = Obj.attr(\"class\"); var newClass = oldClass + \" zhuan\"; Obj.attr(\"class\", newClass); }, function () { Obj.attr(\"class\", oldClass); }) })"},{"title":"","date":"2022-03-27T11:21:35.846Z","updated":"2022-03-27T11:21:35.818Z","comments":true,"path":"shuoshuo/shuoshuo.css","permalink":"http://www.rainend.org/shuoshuo/shuoshuo.css","excerpt":"","text":"#shuoshuo_content { background-color: #fff; padding: 10px; min-height: 500px; } /* shuo */ body.theme-dark .cbp_tmtimeline::before { background: RGBA(255, 255, 255, 0.06); } ul.cbp_tmtimeline { padding: 0; } div class.cdp_tmlabel > li .cbp_tmlabel { margin-bottom: 0; } .cbp_tmtimeline { margin: 30px 0 0 0; padding: 0; list-style: none; position: relative; } /* The line */ .cbp_tmtimeline:before { content: ''; position: absolute; top: 0; bottom: 0; width: 4px; background: RGBA(0, 0, 0, 0.02); left: 80px; margin-left: 10px; } /* The date/time */ .cbp_tmtimeline > li .cbp_tmtime { display: block; /* width: 29%; */ /* padding-right: 110px; */ max-width: 70px; position: absolute; } .cbp_tmtimeline > li .cbp_tmtime span { display: block; text-align: right; } .cbp_tmtimeline > li .cbp_tmtime span:first-child { font-size: 0.9em; color: #bdd0db; } .cbp_tmtimeline > li .cbp_tmtime span:last-child { font-size: 1.2em; color: #9BCD9B; } .cbp_tmtimeline > li:nth-child(odd) .cbp_tmtime span:last-child { color: RGBA(255, 125, 73, 0.75); } div.cbp_tmlabel > p { margin-bottom: 0; } /* Right content */ .cbp_tmtimeline > li .cbp_tmlabel { margin: 0 0 45px 65px; background: #9BCD9B; color: #fff; padding: .8em 1.2em .4em 1.2em; /* font-size: 1.2em; */ font-weight: 300; line-height: 1.4; position: relative; border-radius: 5px; transition: all 0.3s ease 0s; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15); cursor: pointer; display: block; } .cbp_tmlabel:hover { /* transform:scale(1.05); */ transform: translateY(-3px); z-index: 1; box-shadow: 0 15px 32px rgba(0, 0, 0, 0.15) !important } .cbp_tmtimeline > li:nth-child(odd) .cbp_tmlabel { background: RGBA(255, 125, 73, 0.75); } /* The triangle */ .cbp_tmtimeline > li .cbp_tmlabel:after { right: 100%; border: solid transparent; content: \" \"; height: 0; width: 0; position: absolute; pointer-events: none; border-right-color: #9BCD9B; border-width: 10px; top: 4px; } .cbp_tmtimeline > li:nth-child(odd) .cbp_tmlabel:after { border-right-color: RGBA(255, 125, 73, 0.75); } p.shuoshuo_time { margin-top: 10px; border-top: 1px dashed #fff; padding-top: 5px; } /* Media */ @media screen and (max-width: 65.375em) { .cbp_tmtimeline > li .cbp_tmtime span:last-child { font-size: 1.2em; } } .shuoshuo_author_img img { border: 1px solid #ddd; padding: 2px; float: left; border-radius: 64px; transition: all 1.0s; } .avatar { border-radius: 100% !important; -moz-border-radius: 100% !important; box-shadow: inset 0 -1px 0 3333sf; -webkit-box-shadow: inset 0 -1px 0 3333sf; -webkit-transition: 0.4s; -webkit-transition: -webkit-transform 0.4s ease-out; transition: transform 0.4s ease-out; -moz-transition: -moz-transform 0.4s ease-out; } .zhuan { transform: rotateZ(720deg); -webkit-transform: rotateZ(720deg); -moz-transform: rotateZ(720deg); } /* end */"},{"title":"tags","date":"2018-12-12T14:14:16.000Z","updated":"2020-03-16T10:41:30.000Z","comments":true,"path":"tags/index.html","permalink":"http://www.rainend.org/tags/index.html","excerpt":"","text":""},{"title":"Hello World","date":"2022-02-05T08:57:38.061Z","updated":"2022-02-05T08:55:48.418Z","comments":true,"path":"test/index.html","permalink":"http://www.rainend.org/test/index.html","excerpt":"","text":""},{"title":"theme-sakura","date":"2019-01-04T14:53:25.000Z","updated":"2022-04-05T08:37:41.300Z","comments":false,"path":"theme-sakura/index.html","permalink":"http://www.rainend.org/theme-sakura/index.html","excerpt":"","text":"Powered by Hexo theme Sakura by Mashiro&amp;Hojun 方案 Hexo deploy自动部署到CentOs服务器，利用Nginx代理服务器代理 资源加速 预加载:Instant.page、静态资源压缩:hexo-neat、CDN:jsdelivr 图床 github仓库+jsdelivr+picgo 自制图床"},{"title":"video","date":"2018-12-20T15:14:38.000Z","updated":"2020-03-16T10:41:30.000Z","comments":false,"path":"video/index.html","permalink":"http://www.rainend.org/video/index.html","excerpt":"","text":"var videos = [ { img: 'https://lain.bgm.tv/pic/cover/l/0e/1e/218971_2y351.jpg', title: '朝花夕誓——于离别之朝束起约定之花', status: '已追完', progress: 100, jp: 'さよならの朝に約束の花をかざろう', time: '放送时间: 2018-02-24 SUN.', desc: ' 住在远离尘嚣的土地，一边将每天的事情编织成名为希比欧的布，一边静静生活的伊欧夫人民。在15岁左右外表就停止成长，拥有数百年寿命的他们，被称为“离别的一族”，并被视为活着的传说。没有双亲的伊欧夫少女玛奇亚，过着被伙伴包围的平稳日子，却总感觉“孤身一人”。他们的这种日常，一瞬间就崩溃消失。追求伊欧夫的长寿之血，梅萨蒂军乘坐着名为雷纳特的古代兽发动了进攻。在绝望与混乱之中，伊欧夫的第一美女蕾莉亚被梅萨蒂带走，而玛奇亚暗恋的少年克里姆也失踪了。玛奇亚虽然总算逃脱了，却失去了伙伴和归去之地……。' }, { img : 'https://lain.bgm.tv/pic/cover/l/0e/1e/218971_2y351.jpg', title: '朝花夕誓——于离别之朝束起约定之花', status: '已追完', progress: 100, jp: 'さよならの朝に約束の花をかざろう', time: '2018-02-24 SUN.', desc: ' 住在远离尘嚣的土地，一边将每天的事情编织成名为希比欧的布，一边静静生活的伊欧夫人民。在15岁左右外表就停止成长，拥有数百年寿命的他们，被称为“离别的一族”，并被视为活着的传说。没有双亲的伊欧夫少女玛奇亚，过着被伙伴包围的平稳日子，却总感觉“孤身一人”。他们的这种日常，一瞬间就崩溃消失。追求伊欧夫的长寿之血，梅萨蒂军乘坐着名为雷纳特的古代兽发动了进攻。在绝望与混乱之中，伊欧夫的第一美女蕾莉亚被梅萨蒂带走，而玛奇亚暗恋的少年克里姆也失踪了。玛奇亚虽然总算逃脱了，却失去了伙伴和归去之地……。' } ] .should-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:95%;}.should-ellipsis-full{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:100%;}.should-ellipsis i{position:absolute;right:24px;}.grey-text{color:#9e9e9e !important}.grey-text.text-darken-4{color:#212121 !important}html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}img{border-style:none}progress{display:inline-block;vertical-align:baseline}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{-webkit-box-sizing:border-box;box-sizing:border-box}*,*:before,*:after{-webkit-box-sizing:inherit;box-sizing:inherit}ul:not(.browser-default){padding-left:0;list-style-type:none}ul:not(.browser-default)>li{list-style-type:none}.card{-webkit-box-shadow:0 2px 2px 0 rgba(0,0,0,0.14),0 3px 1px -2px rgba(0,0,0,0.12),0 1px 5px 0 rgba(0,0,0,0.2);box-shadow:0 2px 2px 0 rgba(0,0,0,0.14),0 3px 1px -2px rgba(0,0,0,0.12),0 1px 5px 0 rgba(0,0,0,0.2)}.hoverable{-webkit-transition:-webkit-box-shadow .25s;transition:-webkit-box-shadow .25s;transition:box-shadow .25s;transition:box-shadow .25s,-webkit-box-shadow .25s}.hoverable:hover{-webkit-box-shadow:0 8px 17px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);box-shadow:0 8px 17px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19)}i{line-height:inherit}i.right{float:right;margin-left:15px}.bangumi .right{float:right !important}.material-icons{text-rendering:optimizeLegibility;-webkit-font-feature-settings:'liga';-moz-font-feature-settings:'liga';font-feature-settings:'liga'}.row{margin-left:auto;margin-right:auto;margin-bottom:20px}.row:after{content:\"\";display:table;clear:both}.row .col{float:left;-webkit-box-sizing:border-box;box-sizing:border-box;padding:0 .75rem;min-height:1px}.row .col.s12{width:100%;margin-left:auto;left:auto;right:auto}@media only screen and (min-width:601px){.row .col.m6{width:50%;margin-left:auto;left:auto;right:auto}}html{line-height:1.5;font-family:-apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,Oxygen-Sans,Ubuntu,Cantarell,\"Helvetica Neue\",sans-serif;font-weight:normal;color:rgba(0,0,0,0.87)}@media only screen and (min-width:0){html{font-size:14px}}@media only screen and (min-width:992px){html{font-size:14.5px}}@media only screen and (min-width:1200px){html{font-size:15px}}.card{position:relative;margin:.5rem 0 1rem 0;background-color:#fff;-webkit-transition:-webkit-box-shadow .25s;transition:-webkit-box-shadow .25s;transition:box-shadow .25s;transition:box-shadow .25s,-webkit-box-shadow .25s;border-radius:2px}.card .card-title{font-size:24px;font-weight:300}.card .card-title.activator{cursor:pointer}.card .card-image{position:relative}.card .card-image img{display:block;border-radius:2px 2px 0 0;position:relative;left:0;right:0;top:0;bottom:0;width:100%}.card .card-content{padding:24px;border-radius:0 0 2px 2px}.card .card-content p{margin:0}.card .card-content .card-title{display:block;line-height:32px;margin-bottom:8px}.card .card-content .card-title i{line-height:32px}.card .card-reveal{padding:24px;position:absolute;background-color:#fff;width:100%;overflow-y:auto;left:0;top:100%;height:100%;z-index:3;display:none}.card .card-reveal .card-title{cursor:pointer;display:block}.waves-effect{position:relative;cursor:pointer;display:inline-block;overflow:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent;vertical-align:middle;z-index:1;-webkit-transition:.3s ease-out;transition:.3s ease-out}.waves-effect img{position:relative;z-index:-1}.waves-block{display:block}::-webkit-input-placeholder{color:#d1d1d1}::-moz-placeholder{color:#d1d1d1}:-ms-input-placeholder{color:#d1d1d1}::-ms-input-placeholder{color:#d1d1d1}[type=\"radio\"]:not(:checked){position:absolute;opacity:0;pointer-events:none}[type=\"radio\"]:not(:checked)+span{position:relative;padding-left:35px;cursor:pointer;display:inline-block;height:25px;line-height:25px;font-size:1rem;-webkit-transition:.28s ease;transition:.28s ease;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}[type=\"radio\"]:not(:checked)+span:before,[type=\"radio\"]:not(:checked)+span:after{border-radius:50%}[type=\"radio\"]:not(:checked)+span:before,[type=\"radio\"]:not(:checked)+span:after{border:2px solid #5a5a5a}[type=\"radio\"]:not(:checked)+span:after{-webkit-transform:scale(0);transform:scale(0)}[type=\"checkbox\"]:not(:checked){position:absolute;opacity:0;pointer-events:none}[type=\"checkbox\"]:not(:checked):disabled+span:not(.lever):before{border:none;background-color:rgba(0,0,0,0.42)}[type=\"checkbox\"].filled-in:not(:checked)+span:not(.lever):before{width:0;height:0;border:3px solid transparent;left:6px;top:10px;-webkit-transform:rotateZ(37deg);transform:rotateZ(37deg);-webkit-transform-origin:100% 100%;transform-origin:100% 100%}[type=\"checkbox\"].filled-in:not(:checked)+span:not(.lever):after{height:20px;width:20px;background-color:transparent;border:2px solid #5a5a5a;top:0px;z-index:0}input[type=checkbox]:not(:disabled) ~ .lever:active:before,input[type=checkbox]:not(:disabled).tabbed:focus ~ .lever::before{-webkit-transform:scale(2.4);transform:scale(2.4);background-color:rgba(0,0,0,0.08)}input[type=range].focused:focus:not(.active)::-webkit-slider-thumb{-webkit-box-shadow:0 0 0 10px rgba(38,166,154,0.26);box-shadow:0 0 0 10px rgba(38,166,154,0.26)}input[type=range].focused:focus:not(.active)::-moz-range-thumb{box-shadow:0 0 0 10px rgba(38,166,154,0.26)}input[type=range].focused:focus:not(.active)::-ms-thumb{box-shadow:0 0 0 10px rgba(38,166,154,0.26)} 番组计划 这里将是永远的回忆 window.onload = function(){ videos.forEach(function(video, i){ $('#rootRow').append(` ${video.title} ${video.jp} ${video.status} ${video.title} ${video.jp} 放送时间: ${video.time} ${video.desc} ${video.status} `) }) }"},{"title":"","date":"2022-02-05T07:40:23.062Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/css/main.css","permalink":"http://www.rainend.org/A-Dark-Room/css/main.css","excerpt":"","text":"/* Fonts */ body, .tooltip { font-family: \"Times New Roman\", Times, serif; font-size: 16px; font-weight: normal; line-height: normal; letter-spacing: normal; } html { height: 100%; } body { height: 100%; margin: 0; } ::selection{ background-color: transparent; } /* Framework stuff */ div.clear { clear: both; } div#wrapper { margin: auto; width: 700px; padding: 20px 0 0 220px; position: relative; } div#saveNotify { position: absolute; top: 20px; right: 0px; background: white; opacity: 0; } div#content { position: relative; overflow: hidden; height: 700px; } div#header { padding-bottom: 20px; height: 20px; } .menu { position: absolute; right: 10px; bottom: 10px; color: #666; } .menu span { cursor: pointer; float: right; margin-left: 20px; } .menu span:hover { text-decoration: underline; } div.headerButton { font-size: 18px; cursor: pointer; float: left; border-left: 1px solid black; margin-left: 10px; padding-left: 10px; } div.headerButton:hover { text-decoration: underline; } div.headerButton:first-child { border-left: none; margin-left: 0px; padding-left: 0px; } div.headerButton.selected, div.headerButton.selected:hover { cursor: default; text-decoration: underline; } div#outerSlider { position: absolute; } div#outerSlider > div { position: relative; float: left; width: 700px; height: 700px; overflow: hidden; } div#locationSlider { position: absolute; } div.location { position: relative; float: left; width: 700px; } div.row_key { clear: both; float: left; } div.row_val { float: right; } /* Notifications */ div#notifications { position: absolute; top: 20px; left: 0px; height: 700px; width: 200px; overflow: hidden; } div#notifications div.notification { margin-bottom: 10px; } div#notifyGradient { position: absolute; top: 0px; left: 0px; height: 100%; width: 100%; background-color: white; background: -webkit-linear-gradient( rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 1) 100% ); background: linear-gradient( rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 1) 100% ); filter: alpha( Opacity=0, FinishOpacity=100, Style=1, StartX=0, StartY=0, FinishX=0, FinishY=500 ); } /* Button */ div.button { position: relative; text-align: center; border: 1px solid black; width: 100px; margin-bottom: 5px; padding: 5px 10px; cursor: pointer; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; } div.button:hover { text-decoration: underline; } div.button.disabled, div.button.disabled:hover { cursor: default; border-color: grey; color: grey; text-decoration: none; } div.button div.cooldown { position: absolute; top: 0px; left: 0px; z-index: -1; height: 100%; background-color: #DDDDDD; } /* Up/Down buttons. They're complicated! */ .upBtn, .dnBtn, .upManyBtn, .dnManyBtn { position: absolute; width: 14px; height: 15px; cursor: pointer; } .upBtn, .dnBtn { right: 0px; } .upManyBtn, .dnManyBtn { right: -11px; } .upBtn.disabled, .dnBtn.disabled, .upManyBtn.disabled, .dnManyBtn.disabled { cursor: default; } .upBtn { top: -2px; } .upManyBtn { top: -2px; } .upBtn:after, .upBtn:before, .upManyBtn:after, .upManyBtn:before { position: absolute; border: medium solid transparent; content: \" \"; height: 0; width: 0; bottom: 4px; } .upBtn:after, .upManyBtn:after { border-color: transparent transparent white; } .upBtn:before, .upManyBtn:before { border-color: transparent transparent black; } .upBtn.disabled:before, .upManyBtn.disabled:before { border-color: transparent transparent #999; } .dnBtn { bottom: -3px; } .dnManyBtn { bottom: -3px; } .dnBtn:after, .dnBtn:before, .dnManyBtn:after, .dnManyBtn:before { position: absolute; border: medium solid transparent; content: \" \"; height: 0; width: 0; top: 4px; } .upBtn:after, .dnBtn:after { border-width: 3px; left: 50%; margin-left: -3px; } .upBtn:before, .dnBtn:before, .upManyBtn:before, .dnManyBtn:before { border-width: 5px; left: 50%; margin-left: -5px; } .upManyBtn:after, .dnManyBtn:after { border-width: 2px; left: 50%; margin-left: -2px; } .dnBtn:after, .dnManyBtn:after { border-color: white transparent transparent; } .dnBtn:before, .dnManyBtn:before { border-color: black transparent transparent; } .dnBtn.disabled:before, .dnManyBtn.disabled:before { border-color: #999 transparent transparent; } div.button div.tooltip { width: 100px; } /* Tooltip */ div.tooltip { display: none; padding: 2px 5px; border: 1px solid black; position: absolute; box-shadow: -1px 3px 2px #666; background: white; z-index: 999; } .tooltip.bottom { top: 30px; } .tooltip.right { left: 2px; } .tooltip.left { right: 0px; } .tooltip.top { bottom: 20px; } *:hover > div.tooltip { display: block; } div.tooltip:hover { display: none !important; } .disabled:hover > div.tooltip, .button.free:hover > div.tooltip { display: none; } #event .button.disabled:hover > div.tooltip { display: block; } /* Events */ .eventPanel { background: none repeat scroll 0 0 white; border: 2px solid transparent; left: 250px; padding: 20px; position: absolute; top: 90px; width: 335px; z-index: 20; } body.noMask .eventPanel { background-color: black; } .eventPanel:before { background-color:white; opacity: 0.6; content: \" \"; height: 700px; left: -252px; position: absolute; top: -75px; width: 920px; z-index: -2; } body.noMask .eventPanel:before { opacity: 0; } .eventPanel:after { position: absolute; top: -2px; left: -2px; width: 100%; height: 100%; content: \" \"; border: 2px solid black; box-shadow: 5px 5px 5px #666666; z-index: -2; } body.noMask .eventPanel:after { border-color: white; } .eventPanel .button { float:left; margin-right: 20px; } body.noMask .eventPanel .button { border-color: white; color: white; } .eventTitle { display: inline-block; font-weight: bold; position: absolute; top: -12px; } body.noMask .eventTitle { color: white; } .eventTitle:after { background-color: white; bottom: 32%; content: \" \"; height: 5px; left: 0; position: absolute; width: 100%; z-index: -1; } body.noMask .eventTitle:after { background-color: black; } #description { position: relative; min-height: 100px; } #description textarea { width: 100%; height: 225px; } body.noMask #description { color: white; } #description > div { padding-bottom: 20px; } #buttons > .button { margin: 0 5px 5px; margin-right: 15px; } /* Combat! */ #description div.fighter { padding: 0px; position: absolute; bottom: 15px; } #wanderer { left: 25%; } #enemy { right: 25%; } .hp { position: absolute; top: -15px; margin-left: -50%; } #description .bullet { padding: 0px 20px 0px 20px; bottom: 25px; position: absolute; height: 1px; line-height: 1px; } .damageText { position: absolute; bottom: 15px; left: 50%; margin-left: -50%; } #lootButtons { padding-bottom: 0px !important; margin: 20px 0 0 5px; position: relative; } #lootButtons:before { content: \"获取:\"; position: absolute; top: -25px; left: 0px; } #dropMenu { background: none repeat scroll 0 0 white; border: 1px solid black; position: absolute; z-index: 100; padding-top: 5px; text-align: left; box-shadow: -1px 3px 2px #666; cursor: default; } #dropMenu:before { content: \"drop:\"; border-bottom: 1px solid black; display: block; margin-bottom: 5px; padding: 0px 0px 5px 5px; } #dropMenu > div { padding: 0px 5px 5px 5px; cursor: pointer; } #dropMenu > div:hover { text-decoration: underline; }"},{"title":"","date":"2022-02-05T07:40:23.062Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/css/outside.css","permalink":"http://www.rainend.org/A-Dark-Room/css/outside.css","excerpt":"","text":"div#village { position: absolute; top: 0px; right: 0px; border: 1px solid black; cursor: default; padding: 5px 10px; width: 200px; } div#population { position: absolute; top: -13px; right: 10px; background-color: white; } .noHuts #population { display: none; } div#village:before { position: absolute; background: white; content: \"村庄\"; left: 8px; top: -13px; } div#village.noHuts:before { content: \"森林\"; } div#workers { position:absolute; top: -4px; left: 160px; width: 150px; } .workerRow > .row_val { position: relative; padding-right: 20px; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; } .workerRow { position: relative; margin: 10px 0px; cursor: default; } .workerRow .tooltip { width: 150px; } div.storeRow div.tooltip { width: 160px; }"},{"title":"","date":"2022-02-05T07:40:23.062Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/css/path.css","permalink":"http://www.rainend.org/A-Dark-Room/css/path.css","excerpt":"","text":"#outfitting { position: relative; border: 1px solid black; width: 200px; margin-bottom: 20px; padding: 5px 10px; } div#outfitting:before { position: absolute; content: \"补给装备\"; top: -13px; background-color: white; } div.outfitRow { position: relative; cursor: default; margin: 10px -30px 10px 0px; } div.outfitRow > .row_val { padding-right: 30px; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; } div.outfitRow .tooltip { width: 150px; } div#bagspace { background-color: white; position: absolute; top:-13px; right: 10px; } div#perks { position: absolute; top: 0px; right: 0px; border: 1px solid black; cursor: default; padding: 5px 10px; width: 200px; } div#perks:before { position: absolute; content: \"能力\"; top: -13px; background-color: white; } div.perkRow { position: relative; } div.perkRow .row_key { float: none; }"},{"title":"","date":"2022-02-05T07:40:23.066Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/css/room.css","permalink":"http://www.rainend.org/A-Dark-Room/css/room.css","excerpt":"","text":"div#buildBtns { position: absolute; top: 50px; left: 0px; } div#buildBtns:before { content: \"建造/制作:\"; position: relative; top: -5px; } div#craftBtns { position: absolute; top: 50px; left: 150px; } div#craftBtns:before { content: \"生产/制作:\"; position: relative; top: -5px; } div#buyBtns { position: absolute; top: 50px; left: 300px; } div#buyBtns:before { content: \"购买:\"; position: relative; top: -5px; } div#storesContainer { position: absolute; top: 0px; right: 0px; } div#stores { position: relative; border: 1px solid black; cursor: default; padding: 5px 10px; width: 200px; } div.storeRow { position: relative; } div#stores:before { position: absolute; background: white; content: \"储藏室\"; left: 8px; top: -13px; } div#weapons { margin-top: 15px; position: relative; right: 0px; border: 1px solid black; cursor: default; padding: 5px 10px; width: 200px; } div#weapons:before { position: absolute; background: white; content: \"军械库\"; left: 8px; top: -13px; }"},{"title":"","date":"2022-02-05T07:40:23.066Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/css/ship.css","permalink":"http://www.rainend.org/A-Dark-Room/css/ship.css","excerpt":"","text":"div#hullRow { width: 70px; } div#engineRow { width: 70px; margin-bottom: 20px;"},{"title":"","date":"2022-02-05T07:40:23.066Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/css/space.css","permalink":"http://www.rainend.org/A-Dark-Room/css/space.css","excerpt":"","text":"@-ms-keyframes spin { 0% { -ms-transform: rotate(0deg); -webkit-transform: rotate(0deg); -moz-transform: rotate(0deg); transform:rotate(0deg); } 100% { -ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); -moz-transform: rotate(360deg); transform:rotate(360deg); } } @-webkit-keyframes spin { 0% { -ms-transform: rotate(0deg); -webkit-transform: rotate(0deg); -moz-transform: rotate(0deg); transform:rotate(0deg); } 100% { -ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); -moz-transform: rotate(360deg); transform:rotate(360deg); } } @-moz-keyframes spin { 0% { -ms-transform: rotate(0deg); -webkit-transform: rotate(0deg); -moz-transform: rotate(0deg); transform:rotate(0deg); } 100% { -ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); -moz-transform: rotate(360deg); transform:rotate(360deg); } } @keyframes spin { 0% { -ms-transform: rotate(0deg); -webkit-transform: rotate(0deg); -moz-transform: rotate(0deg); transform:rotate(0deg); } 100% { -ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); -moz-transform: rotate(360deg); transform:rotate(360deg); } } #spacePanel { float: none !important; position: absolute !important; top: -700px; left: 0px; } #starsContainer { width: 100%; height: 100%; position: absolute; top: 0px; left: 0px; overflow: hidden; } #stars, #starsBack { position: absolute; z-index: -1; left: 0px; } #stars > div, #starsBack > div { position: relative; height: 3000px; width: 3000px; color: white; } #starsBack { opacity: 0.5; } .star { position: absolute; } #ship { cursor: default; position: absolute; margin-top: -10px; margin-left: -7.5px; } #theEnd { position: relative; cursor: default; top: 200px; margin-left: -220px; text-align: center; font-size: 24px; font-weight: bold; opacity: 0; color: white; } .asteroid { cursor: default; position: absolute; top: -40px; left: 350px; -webkit-animation: 1s linear 0s normal none infinite spin; -moz-animation: 1s linear 0s normal none infinite spin; -ms-animation: 1s linear 0s normal none infinite spin; animation: 1s linear 0s normal none infinite spin; font-size: 32px; } #hullRemaining { width: 70px; position: absolute; top: 0px; left: 0px; } .centerCont { padding-top:10%; } .endGame { font-size:48px; color:#FFFFFF; opacity:0; position:relative; } .endGameRestart { font-size: 32px; cursor: pointer; } .endGameRestart:hover { text-decoration: underline; }"},{"title":"","date":"2022-02-05T07:40:23.066Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/css/world.css","permalink":"http://www.rainend.org/A-Dark-Room/css/world.css","excerpt":"","text":"#worldOuter { position: relative; display: inline-block; } #map { position: relative; font-family: \"Courier New\", Courier, monospace; border: 1px solid black; overflow: hidden; display: inline-block; line-height: 10px; letter-spacing: 1px; color: #999; cursor: default; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; } #map .landmark { position: relative; font-weight: bold; color: black; line-height: 0px; /* Hack to prevent the boldness from increasing the row's line-height. I hope it works in all browsers... */ } #bagspace-world { border: 1px solid black; height: 62px; margin-bottom: 5px; margin-top: 13px; overflow: hidden; } #bagspace-world > div { padding: 6px 4px; } #backpackTitle { position: absolute; top: 0px; left: 10px; background-color: white; z-index: 1; } #backpackSpace { position: absolute; top: 0px; right: 10px; background-color: white; z-index: 1; } #healthCounter { position: absolute; top: 0px; left: 80px; background-color: white; z-index: 1; } div.supplyItem { display: inline-block; border: 1px solid #999; float: left; margin: 0px 5px 6px 0px; padding: 0 5px; cursor: default; }"},{"title":"","date":"2022-02-05T07:40:23.066Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/lib/base64.js","permalink":"http://www.rainend.org/A-Dark-Room/lib/base64.js","excerpt":"","text":"/** * * Base64 encode / decode * http://www.webtoolkit.info/ * **/ var Base64 = { // private property _keyStr : \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\", // public method for encoding encode : function (input) { var output = \"\"; var chr1, chr2, chr3, enc1, enc2, enc3, enc4; var i = 0; input = Base64._utf8_encode(input); while (i < input.length) { chr1 = input.charCodeAt(i++); chr2 = input.charCodeAt(i++); chr3 = input.charCodeAt(i++); enc1 = chr1 >> 2; enc2 = ((chr1 & 3) < 4) | (chr2 >> 4); enc3 = ((chr2 & 15) < 2) | (chr3 >> 6); enc4 = chr3 & 63; if (isNaN(chr2)) { enc3 = enc4 = 64; } else if (isNaN(chr3)) { enc4 = 64; } output = output + this._keyStr.charAt(enc1) + this._keyStr.charAt(enc2) + this._keyStr.charAt(enc3) + this._keyStr.charAt(enc4); } return output; }, // public method for decoding decode : function (input) { var output = \"\"; var chr1, chr2, chr3; var enc1, enc2, enc3, enc4; var i = 0; input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\"); while (i < input.length) { enc1 = this._keyStr.indexOf(input.charAt(i++)); enc2 = this._keyStr.indexOf(input.charAt(i++)); enc3 = this._keyStr.indexOf(input.charAt(i++)); enc4 = this._keyStr.indexOf(input.charAt(i++)); chr1 = (enc1 < 2) | (enc2 >> 4); chr2 = ((enc2 & 15) < 4) | (enc3 >> 2); chr3 = ((enc3 & 3) < 6) | enc4; output = output + String.fromCharCode(chr1); if (enc3 != 64) { output = output + String.fromCharCode(chr2); } if (enc4 != 64) { output = output + String.fromCharCode(chr3); } } output = Base64._utf8_decode(output); return output; }, // private method for UTF-8 encoding _utf8_encode : function (string) { string = string.replace(/\\r\\n/g,\"\\n\"); var utftext = \"\"; for (var n = 0; n < string.length; n++) { var c = string.charCodeAt(n); if (c < 128) { utftext += String.fromCharCode(c); } else if((c > 127) && (c < 2048)) { utftext += String.fromCharCode((c >> 6) | 192); utftext += String.fromCharCode((c & 63) | 128); } else { utftext += String.fromCharCode((c >> 12) | 224); utftext += String.fromCharCode(((c >> 6) & 63) | 128); utftext += String.fromCharCode((c & 63) | 128); } } return utftext; }, // private method for UTF-8 decoding _utf8_decode : function (utftext) { var string = \"\"; var i = 0; var c = c1 = c2 = 0; while ( i < utftext.length ) { c = utftext.charCodeAt(i); if (c < 128) { string += String.fromCharCode(c); i++; } else if((c > 191) && (c < 224)) { c2 = utftext.charCodeAt(i+1); string += String.fromCharCode(((c & 31) < 6) | (c2 & 63)); i += 2; } else { c2 = utftext.charCodeAt(i+1); c3 = utftext.charCodeAt(i+2); string += String.fromCharCode(((c & 15) < 12) | ((c2 & 63) < 6) | (c3 & 63)); i += 3; } } return string; } }"},{"title":"","date":"2022-02-05T07:40:23.066Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/lib/jquery.color-2.1.2.min.js","permalink":"http://www.rainend.org/A-Dark-Room/lib/jquery.color-2.1.2.min.js","excerpt":"","text":"/*! jQuery Color v@2.1.2 http://github.com/jquery/jquery-color | jquery.org/license */ (function(a,b){function m(a,b,c){var d=h[b.type]||{};return a==null?c||!b.def?null:b.def:(a=d.floor?~~a:parseFloat(a),isNaN(a)?b.def:d.mod?(a+d.mod)%d.mod:0>a?0:d.max2?1:0),b&&b"},{"title":"","date":"2022-02-05T07:40:23.066Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/lib/jquery.event.move.js","permalink":"http://www.rainend.org/A-Dark-Room/lib/jquery.event.move.js","excerpt":"","text":"// jquery.event.move // // 1.3.1 // // Stephen Band // // Triggers 'movestart', 'move' and 'moveend' events after // mousemoves following a mousedown cross a distance threshold, // similar to the native 'dragstart', 'drag' and 'dragend' events. // Move events are throttled to animation frames. Move event objects // have the properties: // // pageX: // pageY: Page coordinates of pointer. // startX: // startY: Page coordinates of pointer at movestart. // distX: // distY: Distance the pointer has moved since movestart. // deltaX: // deltaY: Distance the finger has moved since last event. // velocityX: // velocityY: Average velocity over last few events. (function (module) { if (typeof define === 'function' && define.amd) { // AMD. Register as an anonymous module. define(['jquery'], module); } else { // Browser globals module(jQuery); } })(function(jQuery, undefined){ var // Number of pixels a pressed pointer travels before movestart // event is fired. threshold = 6, add = jQuery.event.add, remove = jQuery.event.remove, // Just sugar, so we can have arguments in the same order as // add and remove. trigger = function(node, type, data) { jQuery.event.trigger(type, data, node); }, // Shim for requestAnimationFrame, falling back to timer. See: // see http://paulirish.com/2011/requestanimationframe-for-smart-animating/ requestFrame = (function(){ return ( window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(fn, element){ return window.setTimeout(function(){ fn(); }, 25); } ); })(), ignoreTags = { textarea: true, input: true, select: true, button: true }, mouseevents = { move: 'mousemove', cancel: 'mouseup dragstart', end: 'mouseup' }, touchevents = { move: 'touchmove', cancel: 'touchend', end: 'touchend' }; // Constructors function Timer(fn){ var callback = fn, active = false, running = false; function trigger(time) { if (active){ callback(); requestFrame(trigger); running = true; active = false; } else { running = false; } } this.kick = function(fn) { active = true; if (!running) { trigger(); } }; this.end = function(fn) { var cb = callback; if (!fn) { return; } // If the timer is not running, simply call the end callback. if (!running) { fn(); } // If the timer is running, and has been kicked lately, then // queue up the current callback and the end callback, otherwise // just the end callback. else { callback = active ? function(){ cb(); fn(); } : fn ; active = true; } }; } // Functions function returnTrue() { return true; } function returnFalse() { return false; } function preventDefault(e) { e.preventDefault(); } function preventIgnoreTags(e) { // Don't prevent interaction with form elements. if (ignoreTags[ e.target.tagName.toLowerCase() ]) { return; } e.preventDefault(); } function isLeftButton(e) { // Ignore mousedowns on any button other than the left (or primary) // mouse button, or when a modifier key is pressed. return (e.which === 1 && !e.ctrlKey && !e.altKey); } function identifiedTouch(touchList, id) { var i, l; if (touchList.identifiedTouch) { return touchList.identifiedTouch(id); } // touchList.identifiedTouch() does not exist in // webkit yet… we must do the search ourselves... i = -1; l = touchList.length; while (++i < l) { if (touchList[i].identifier === id) { return touchList[i]; } } } function changedTouch(e, event) { var touch = identifiedTouch(e.changedTouches, event.identifier); // This isn't the touch you're looking for. if (!touch) { return; } // Chrome Android (at least) includes touches that have not // changed in e.changedTouches. That's a bit annoying. Check // that this touch has changed. if (touch.pageX === event.pageX && touch.pageY === event.pageY) { return; } return touch; } // Handlers that decide when the first movestart is triggered function mousedown(e){ var data; if (!isLeftButton(e)) { return; } data = { target: e.target, startX: e.pageX, startY: e.pageY, timeStamp: e.timeStamp }; add(document, mouseevents.move, mousemove, data); add(document, mouseevents.cancel, mouseend, data); } function mousemove(e){ var data = e.data; checkThreshold(e, data, e, removeMouse); } function mouseend(e) { removeMouse(); } function removeMouse() { remove(document, mouseevents.move, mousemove); remove(document, mouseevents.cancel, mouseend); } function touchstart(e) { var touch, template; // Don't get in the way of interaction with form elements. if (ignoreTags[ e.target.tagName.toLowerCase() ]) { return; } touch = e.changedTouches[0]; // iOS live updates the touch objects whereas Android gives us copies. // That means we can't trust the touchstart object to stay the same, // so we must copy the data. This object acts as a template for // movestart, move and moveend event objects. template = { target: touch.target, startX: touch.pageX, startY: touch.pageY, timeStamp: e.timeStamp, identifier: touch.identifier }; // Use the touch identifier as a namespace, so that we can later // remove handlers pertaining only to this touch. add(document, touchevents.move + '.' + touch.identifier, touchmove, template); add(document, touchevents.cancel + '.' + touch.identifier, touchend, template); } function touchmove(e){ var data = e.data, touch = changedTouch(e, data); if (!touch) { return; } checkThreshold(e, data, touch, removeTouch); } function touchend(e) { var template = e.data, touch = identifiedTouch(e.changedTouches, template.identifier); if (!touch) { return; } removeTouch(template.identifier); } function removeTouch(identifier) { remove(document, '.' + identifier, touchmove); remove(document, '.' + identifier, touchend); } // Logic for deciding when to trigger a movestart. function checkThreshold(e, template, touch, fn) { var distX = touch.pageX - template.startX, distY = touch.pageY - template.startY; // Do nothing if the threshold has not been crossed. if ((distX * distX) + (distY * distY) < (threshold * threshold)) { return; } triggerStart(e, template, touch, distX, distY, fn); } function handled() { // this._handled should return false once, and after return true. this._handled = returnTrue; return false; } function flagAsHandled(e) { e._handled(); } function triggerStart(e, template, touch, distX, distY, fn) { var node = template.target, touches, time; touches = e.targetTouches; time = e.timeStamp - template.timeStamp; // Create a movestart object with some special properties that // are passed only to the movestart handlers. template.type = 'movestart'; template.distX = distX; template.distY = distY; template.deltaX = distX; template.deltaY = distY; template.pageX = touch.pageX; template.pageY = touch.pageY; template.velocityX = distX / time; template.velocityY = distY / time; template.targetTouches = touches; template.finger = touches ? touches.length : 1 ; // The _handled method is fired to tell the default movestart // handler that one of the move events is bound. template._handled = handled; // Pass the touchmove event so it can be prevented if or when // movestart is handled. template._preventTouchmoveDefault = function() { e.preventDefault(); }; // Trigger the movestart event. trigger(template.target, template); // Unbind handlers that tracked the touch or mouse up till now. fn(template.identifier); } // Handlers that control what happens following a movestart function activeMousemove(e) { var event = e.data.event, timer = e.data.timer; updateEvent(event, e, e.timeStamp, timer); } function activeMouseend(e) { var event = e.data.event, timer = e.data.timer; removeActiveMouse(); endEvent(event, timer, function() { // Unbind the click suppressor, waiting until after mouseup // has been handled. setTimeout(function(){ remove(event.target, 'click', returnFalse); }, 0); }); } function removeActiveMouse(event) { remove(document, mouseevents.move, activeMousemove); remove(document, mouseevents.end, activeMouseend); } function activeTouchmove(e) { var event = e.data.event, timer = e.data.timer, touch = changedTouch(e, event); if (!touch) { return; } // Stop the interface from gesturing e.preventDefault(); event.targetTouches = e.targetTouches; updateEvent(event, touch, e.timeStamp, timer); } function activeTouchend(e) { var event = e.data.event, timer = e.data.timer, touch = identifiedTouch(e.changedTouches, event.identifier); // This isn't the touch you're looking for. if (!touch) { return; } removeActiveTouch(event); endEvent(event, timer); } function removeActiveTouch(event) { remove(document, '.' + event.identifier, activeTouchmove); remove(document, '.' + event.identifier, activeTouchend); } // Logic for triggering move and moveend events function updateEvent(event, touch, timeStamp, timer) { var time = timeStamp - event.timeStamp; event.type = 'move'; event.distX = touch.pageX - event.startX; event.distY = touch.pageY - event.startY; event.deltaX = touch.pageX - event.pageX; event.deltaY = touch.pageY - event.pageY; // Average the velocity of the last few events using a decay // curve to even out spurious jumps in values. event.velocityX = 0.3 * event.velocityX + 0.7 * event.deltaX / time; event.velocityY = 0.3 * event.velocityY + 0.7 * event.deltaY / time; event.pageX = touch.pageX; event.pageY = touch.pageY; timer.kick(); } function endEvent(event, timer, fn) { timer.end(function(){ event.type = 'moveend'; trigger(event.target, event); return fn && fn(); }); } // jQuery special event definition function setup(data, namespaces, eventHandle) { // Stop the node from being dragged //add(this, 'dragstart.move drag.move', preventDefault); // Prevent text selection and touch interface scrolling //add(this, 'mousedown.move', preventIgnoreTags); // Tell movestart default handler that we've handled this add(this, 'movestart.move', flagAsHandled); // Don't bind to the DOM. For speed. return true; } function teardown(namespaces) { remove(this, 'dragstart drag', preventDefault); remove(this, 'mousedown touchstart', preventIgnoreTags); remove(this, 'movestart', flagAsHandled); // Don't bind to the DOM. For speed. return true; } function addMethod(handleObj) { // We're not interested in preventing defaults for handlers that // come from internal move or moveend bindings if (handleObj.namespace === \"move\" || handleObj.namespace === \"moveend\") { return; } // Stop the node from being dragged add(this, 'dragstart.' + handleObj.guid + ' drag.' + handleObj.guid, preventDefault, undefined, handleObj.selector); // Prevent text selection and touch interface scrolling add(this, 'mousedown.' + handleObj.guid, preventIgnoreTags, undefined, handleObj.selector); } function removeMethod(handleObj) { if (handleObj.namespace === \"move\" || handleObj.namespace === \"moveend\") { return; } remove(this, 'dragstart.' + handleObj.guid + ' drag.' + handleObj.guid); remove(this, 'mousedown.' + handleObj.guid); } jQuery.event.special.movestart = { setup: setup, teardown: teardown, add: addMethod, remove: removeMethod, _default: function(e) { var template, data; // If no move events were bound to any ancestors of this // target, high tail it out of here. if (!e._handled()) { return; } template = { target: e.target, startX: e.startX, startY: e.startY, pageX: e.pageX, pageY: e.pageY, distX: e.distX, distY: e.distY, deltaX: e.deltaX, deltaY: e.deltaY, velocityX: e.velocityX, velocityY: e.velocityY, timeStamp: e.timeStamp, identifier: e.identifier, targetTouches: e.targetTouches, finger: e.finger }; data = { event: template, timer: new Timer(function(time){ trigger(e.target, template); }) }; if (e.identifier === undefined) { // We're dealing with a mouse // Stop clicks from propagating during a move add(e.target, 'click', returnFalse); add(document, mouseevents.move, activeMousemove, data); add(document, mouseevents.end, activeMouseend, data); } else { // We're dealing with a touch. Stop touchmove doing // anything defaulty. e._preventTouchmoveDefault(); add(document, touchevents.move + '.' + e.identifier, activeTouchmove, data); add(document, touchevents.end + '.' + e.identifier, activeTouchend, data); } } }; jQuery.event.special.move = { setup: function() { // Bind a noop to movestart. Why? It's the movestart // setup that decides whether other move events are fired. add(this, 'movestart.move', jQuery.noop); }, teardown: function() { remove(this, 'movestart.move', jQuery.noop); } }; jQuery.event.special.moveend = { setup: function() { // Bind a noop to movestart. Why? It's the movestart // setup that decides whether other move events are fired. add(this, 'movestart.moveend', jQuery.noop); }, teardown: function() { remove(this, 'movestart.moveend', jQuery.noop); } }; add(document, 'mousedown.move', mousedown); add(document, 'touchstart.move', touchstart); // Make jQuery copy touch event properties over to the jQuery event // object, if they are not already listed. But only do the ones we // really need. IE7/8 do not have Array#indexOf(), but nor do they // have touch events, so let's assume we can ignore them. if (typeof Array.prototype.indexOf === 'function') { (function(jQuery, undefined){ var props = [\"changedTouches\", \"targetTouches\"], l = props.length; while (l--) { if (jQuery.event.props.indexOf(props[l]) === -1) { jQuery.event.props.push(props[l]); } } })(jQuery); }; });"},{"title":"","date":"2022-02-05T07:40:23.066Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/lib/jquery.event.swipe.js","permalink":"http://www.rainend.org/A-Dark-Room/lib/jquery.event.swipe.js","excerpt":"","text":"// jQuery.event.swipe // 0.5 // Stephen Band // Dependencies // jQuery.event.move 1.2 // One of swipeleft, swiperight, swipeup or swipedown is triggered on // moveend, when the move has covered a threshold ratio of the dimension // of the target node, or has gone really fast. Threshold and velocity // sensitivity changed with: // // jQuery.event.special.swipe.settings.threshold // jQuery.event.special.swipe.settings.sensitivity (function (module) { if (typeof define === 'function' && define.amd) { // AMD. Register as an anonymous module. define(['jquery'], module); } else { // Browser globals module(jQuery); } })(function(jQuery, undefined){ var add = jQuery.event.add, remove = jQuery.event.remove, // Just sugar, so we can have arguments in the same order as // add and remove. trigger = function(node, type, data) { jQuery.event.trigger(type, data, node); }, settings = { // Ratio of distance over target finger must travel to be // considered a swipe. threshold: 0.4, // Faster fingers can travel shorter distances to be considered // swipes. 'sensitivity' controls how much. Bigger is shorter. sensitivity: 6 }; function moveend(e) { var w, h, event; w = e.target.offsetWidth; h = e.target.offsetHeight; // Copy over some useful properties from the move event event = { distX: e.distX, distY: e.distY, velocityX: e.velocityX, velocityY: e.velocityY, finger: e.finger }; // Find out which of the four directions was swiped if (e.distX > e.distY) { if (e.distX > -e.distY) { if (e.distX/w > settings.threshold || e.velocityX * e.distX/w * settings.sensitivity > 1) { event.type = 'swiperight'; trigger(e.currentTarget, event); } } else { if (-e.distY/h > settings.threshold || e.velocityY * e.distY/w * settings.sensitivity > 1) { event.type = 'swipeup'; trigger(e.currentTarget, event); } } } else { if (e.distX > -e.distY) { if (e.distY/h > settings.threshold || e.velocityY * e.distY/w * settings.sensitivity > 1) { event.type = 'swipedown'; trigger(e.currentTarget, event); } } else { if (-e.distX/w > settings.threshold || e.velocityX * e.distX/w * settings.sensitivity > 1) { event.type = 'swipeleft'; trigger(e.currentTarget, event); } } } } function getData(node) { var data = jQuery.data(node, 'event_swipe'); if (!data) { data = { count: 0 }; jQuery.data(node, 'event_swipe', data); } return data; } jQuery.event.special.swipe = jQuery.event.special.swipeleft = jQuery.event.special.swiperight = jQuery.event.special.swipeup = jQuery.event.special.swipedown = { setup: function( data, namespaces, eventHandle ) { var data = getData(this); // If another swipe event is already setup, don't setup again. if (data.count++ > 0) { return; } add(this, 'moveend', moveend); return true; }, teardown: function() { var data = getData(this); // If another swipe event is still setup, don't teardown. if (--data.count > 0) { return; } remove(this, 'moveend', moveend); return true; }, settings: settings }; });"},{"title":"","date":"2022-02-05T07:40:23.070Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/script/Button.js","permalink":"http://www.rainend.org/A-Dark-Room/script/Button.js","excerpt":"","text":"var Button = { Button: function(options) { if(typeof options.cooldown == 'number') { this.data_cooldown = options.cooldown; } this.data_remaining = 0; if(typeof options.click == 'function') { this.data_handler = options.click; } var el = $('') .attr('id', typeof(options.id) != 'undefined' ? options.id : \"BTN_\" + Engine.getGuid()) .addClass('button') .text(typeof(options.text) != 'undefined' ? options.text : \"button\") .click(function() { if(!$(this).hasClass('disabled')) { Button.cooldown($(this)); $(this).data(\"handler\")($(this)); } }) .data(\"handler\", typeof options.click == 'function' ? options.click : function() { Engine.log(\"click\"); }) .data(\"remaining\", 0) .data(\"cooldown\", typeof options.cooldown == 'number' ? options.cooldown : 0); el.append($(\"\").addClass('cooldown')); if(options.cost) { var ttPos = options.ttPos ? options.ttPos : \"bottom right\"; var costTooltip = $('').addClass('tooltip ' + ttPos); for(var k in options.cost) { $(\"\").addClass('row_key').text(k).appendTo(costTooltip); $(\"\").addClass('row_val').text(options.cost[k]).appendTo(costTooltip); } if(costTooltip.children().length > 0) { costTooltip.appendTo(el); } } if(options.width) { el.css('width', options.width); } return el; }, setDisabled: function(btn, disabled) { if(btn) { if(!disabled && !btn.data('onCooldown')) { btn.removeClass('disabled'); } else if(disabled) { btn.addClass('disabled'); } btn.data('disabled', disabled); } }, isDisabled: function(btn) { if(btn) { return btn.data('disabled') === true; } return false; }, cooldown: function(btn) { var cd = btn.data(\"cooldown\"); if(cd > 0) { $('div.cooldown', btn).stop(true, true).width(\"100%\").animate({width: '0%'}, cd * 1000, 'linear', function() { var b = $(this).closest('.button'); b.data('onCooldown', false); if(!b.data('disabled')) { b.removeClass('disabled'); } }); btn.addClass('disabled'); btn.data('onCooldown', true); } }, clearCooldown: function(btn) { $('div.cooldown', btn).stop(true, true); btn.data('onCooldown', false); if(!btn.data('disabled')) { btn.removeClass('disabled'); } } };"},{"title":"","date":"2022-02-05T07:40:23.070Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/script/engine.js","permalink":"http://www.rainend.org/A-Dark-Room/script/engine.js","excerpt":"","text":"var Engine = { /* TODO *** MICHAEL IS A LAZY BASTARD AND DOES NOT WANT TO REFACTOR *** * Here is what he should be doing: * - All updating values (store numbers, incomes, etc...) should be objects that can register listeners to * value-change events. These events should be fired whenever a value (or group of values, I suppose) is updated. * That would be so elegant and awesome. */ SITE_URL: encodeURIComponent(\"http://adarkroom.doublespeakgames.com\"), VERSION: 1.3, MAX_STORE: 99999999999999, SAVE_DISPLAY: 30 * 1000, GAME_OVER: false, //object event types topics: {}, Perks: { '通臂拳': { desc: '提高徒手攻击力', notify: '通臂拳' }, '金刚掌': { desc: '再次提高徒手攻击力.', notify: '金刚掌' }, '降龙十八掌': { desc: '两倍攻速+更高攻击力', notify: '降龙十八掌' }, '夺命连环三仙剑': { desc: '近战武器攻击提高', notify: '夺命连环三仙剑' }, '避免饥饿': { desc: '两倍挨饿能力', notify: '学习如何避免饥饿' }, '避免流失水分': { desc: '两倍忍渴能力', notify: '学习如何避免流失水分' }, '凌波微步': { desc: '躲闪能力加强', notify: \"凌波微步\" }, '兰花佛穴手': { desc: '命中率加强', notify: '兰花佛穴手' }, '千里眼': { desc: '视野扩大', notify: '千里眼' }, '潜行术': { desc: '降低遇敌概率', notify: '潜行术' }, '九阳神功': { desc: '进食恢复hp加强', notify: '九阳神功' } }, options: { state: null, debug: false, log: false }, init: function(options) { this.options = $.extend( this.options, options ); this._debug = this.options.debug; this._log = this.options.log; // Check for HTML5 support if(!Engine.browserValid()) { window.location = 'browserWarning.html'; } // Check for mobile if(Engine.isMobile()) { window.location = 'mobileWarning.html'; } if(this.options.state != null) { window.State = this.options.state; } else { Engine.loadGame(); } $('').attr('id', 'locationSlider').appendTo('#main'); var menu = $('') .addClass('menu') .appendTo('body'); $('') .addClass('lightsOff menuBtn') .text('关灯.') .click(Engine.turnLightsOff) .appendTo(menu); $('') .addClass('menuBtn') .text('重新来过.') .click(Engine.confirmDelete) .appendTo(menu); // $('') // .addClass('menuBtn') // .text('share.') // .click(Engine.share) // .appendTo(menu); $('') .addClass('menuBtn') .text('存档.') .click(Engine.exportImport) .appendTo(menu); $(' ') .addClass('menuBtn') .attr('id','sss1') //.attr('src','微博1.png') //.html(\"test\") //.html('') //.text('u77新浪微博') .click(function() { window.open('http://www.dwz.cn/fd8Bo'); }) //.append(' ') .appendTo(menu); // $(' ') // .addClass('menuBtn') // //.text('www dd') // //.click(function() { window.open('http://www.u77.com'); }) // .appendTo(menu); //$('').prependTo('#sss1'); //$('#ss1').append(' '); $(' ') .addClass('menuBtn') .attr('src','腾讯1.png') .attr('id','sss2') //.text('QQ空间分享') .click(function() { window.open('http://dwz.cn/u77_xhw'); }) .appendTo(menu); // $('') // .addClass('menuBtn') // .text('app store.') // .click(function() { window.open('https://itunes.apple.com/us/app/a-dark-room/id736683061'); }) // .appendTo(menu); $(' ') .addClass('menuBtn') //.text('u77.')u77logo.png .click(function() { window.open('http://www.u77.com'); }) .appendTo(menu); // Register keypress handlers $('body').off('keydown').keydown(Engine.keyDown); $('body').off('keyup').keyup(Engine.keyUp); // Register swipe handlers swipeElement = $('#outerSlider'); swipeElement.on('swipeleft', Engine.swipeLeft); swipeElement.on('swiperight', Engine.swipeRight); swipeElement.on('swipeup', Engine.swipeUp); swipeElement.on('swipedown', Engine.swipeDown); //subscribe to stateUpdates $.Dispatch('stateUpdate').subscribe(Engine.handleStateUpdates); $SM.init(); Notifications.init(); Events.init(); Room.init(); if($SM.get('stores[\"木头\"]')) { Outside.init(); } if($SM.get('stores[\"罗盘\"]', true) > 0) { Path.init(); } if($SM.get('features.location.spaceShip')) { Ship.init(); } Engine.travelTo(Room); }, browserValid: function() { return location.search.indexOf('ignorebrowser=true') >= 0 || ( typeof Storage != 'undefined' && !oldIE); }, isMobile: function() { return location.search.indexOf('ignorebrowser=true') < 0 && /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent); }, saveGame: function() { if(typeof Storage != 'undefined' && localStorage) { if(Engine._saveTimer != null) { clearTimeout(Engine._saveTimer); } if(typeof Engine._lastNotify == 'undefined' || Date.now() - Engine._lastNotify > Engine.SAVE_DISPLAY){ $('#saveNotify').css('opacity', 1).animate({opacity: 0}, 1000, 'linear'); Engine._lastNotify = Date.now(); } localStorage.gameState = JSON.stringify(State); } }, loadGame: function() { try { var savedState = JSON.parse(localStorage.gameState); if(savedState) { State = savedState; $SM.updateOldState(); Engine.log(\"loaded save!\"); } } catch(e) { State = {}; $SM.set('version', Engine.VERSION); Engine.event('progress', 'new game'); } }, exportImport: function() { Events.startEvent({ title: '导出 / 导入', scenes: { start: { text: ['导入导出游戏, 备份游戏', '或者从其他地方导入'], buttons: { 'export': { text: '导出', onChoose: Engine.export64 }, 'import': { text: '导入', nextScene: {1: 'confirm'}, }, 'cancel': { text: '取消', nextScene: 'end' } } }, 'confirm': { text: ['确定么?', '如果导入存档非法, 存档将丢失.', '本过程不可逆.'], buttons: { 'yes': { text: '是', nextScene: 'end', onChoose: Engine.import64 }, 'no': { text: '否', nextScene: 'end' } } } } }); }, export64: function() { Engine.saveGame(); var string64 = Base64.encode(localStorage.gameState); string64 = string64.replace(/\\s/g, ''); string64 = string64.replace(/\\./g, ''); string64 = string64.replace(/\\n/g, ''); Events.startEvent({ title: 'Export', scenes: { start: { text: ['导出存档.'], textarea: string64, buttons: { 'done': { text: '搞定', nextScene: 'end' } } } } }); }, import64: function() { var string64 = prompt(\"put the save code here.\",\"\"); string64 = string64.replace(/\\s/g, ''); string64 = string64.replace(/\\./g, ''); string64 = string64.replace(/\\n/g, ''); var decodedSave = Base64.decode(string64); localStorage.gameState = decodedSave; location.reload(); }, event: function(cat, act) { if(typeof ga === 'function') { ga('send', 'event', cat, act); } }, confirmDelete: function() { Events.startEvent({ title: '消除存档?', scenes: { start: { text: ['彻底重新开始新游戏?'], buttons: { 'yes': { text: '是', nextScene: 'end', onChoose: Engine.deleteSave }, 'no': { text: '否', nextScene: 'end' } } } } }); }, deleteSave: function(noReload) { if(typeof Storage != 'undefined' && localStorage) { var prestige = Prestige.get(); window.State = {}; localStorage.clear(); Prestige.set(prestige); } if(!noReload) { location.reload(); } }, share: function() { Events.startEvent({ title: 'Share', scenes: { start: { text: ['bring your friends.'], buttons: { 'facebook': { text: 'facebook', nextScene: 'end', onChoose: function() { window.open('https://www.facebook.com/sharer/sharer.php?u=' + Engine.SITE_URL, 'sharer', 'width=626,height=436,location=no,menubar=no,resizable=no,scrollbars=no,status=no,toolbar=no'); } }, 'google': { text:'google+', nextScene: 'end', onChoose: function() { window.open('https://plus.google.com/share?url=' + Engine.SITE_URL, 'sharer', 'width=480,height=436,location=no,menubar=no,resizable=no,scrollbars=no,status=no,toolbar=no'); } }, 'twitter': { text: 'twitter', onChoose: function() { window.open('https://twitter.com/intent/tweet?text=A%20Dark%20Room&url=' + Engine.SITE_URL, 'sharer', 'width=660,height=260,location=no,menubar=no,resizable=no,scrollbars=yes,status=no,toolbar=no'); }, nextScene: 'end' }, 'reddit': { text: 'reddit', onChoose: function() { window.open('http://www.reddit.com/submit?url=' + Engine.SITE_URL, 'sharer', 'width=960,height=700,location=no,menubar=no,resizable=no,scrollbars=yes,status=no,toolbar=no'); }, nextScene: 'end' }, 'close': { text: 'close', nextScene: 'end' } } } } }, {width: '400px'}); }, findStylesheet: function(title) { for(var i=0; i 0 ? \"+\" : \"\") + num + \" 每\" + delay + \"秒\"; }, keyDown: function(e) { if(!Engine.keyPressed && !Engine.keyLock) { Engine.pressed = true; if(Engine.activeModule.keyDown) { Engine.activeModule.keyDown(e); } } return false; }, keyUp: function(e) { Engine.pressed = false; if(Engine.activeModule.keyUp) { Engine.activeModule.keyUp(e); } else { switch(e.which) { case 38: // Up case 87: Engine.log('up'); break; case 40: // Down case 83: Engine.log('down'); break; case 37: // Left case 65: if(Engine.activeModule == Ship && Path.tab) Engine.travelTo(Path); else if(Engine.activeModule == Path && Outside.tab) Engine.travelTo(Outside); else if(Engine.activeModule == Outside && Room.tab) Engine.travelTo(Room); Engine.log('left'); break; case 39: // Right case 68: if(Engine.activeModule == Room && Outside.tab) Engine.travelTo(Outside); else if(Engine.activeModule == Outside && Path.tab) Engine.travelTo(Path); else if(Engine.activeModule == Path && Ship.tab) Engine.travelTo(Ship); Engine.log('right'); break; } } return false; }, swipeLeft: function(e) { if(Engine.activeModule.swipeLeft) { Engine.activeModule.swipeLeft(e); } }, swipeRight: function(e) { if(Engine.activeModule.swipeRight) { Engine.activeModule.swipeRight(e); } }, swipeUp: function(e) { if(Engine.activeModule.swipeUp) { Engine.activeModule.swipeUp(e); } }, swipeDown: function(e) { if(Engine.activeModule.swipeDown) { Engine.activeModule.swipeDown(e); } }, handleStateUpdates: function(e){ } }; //create jQuery Callbacks() to handle object events $.Dispatch = function( id ) { var callbacks, topic = id && Engine.topics[ id ]; if ( !topic ) { callbacks = jQuery.Callbacks(); topic = { publish: callbacks.fire, subscribe: callbacks.add, unsubscribe: callbacks.remove }; if ( id ) { Engine.topics[ id ] = topic; } } return topic; }; $(function() { Engine.init(); });"},{"title":"","date":"2022-02-05T07:40:23.074Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/script/header.js","permalink":"http://www.rainend.org/A-Dark-Room/script/header.js","excerpt":"","text":"/** * Module that takes care of header buttons */ var Header = { init: function(options) { this.options = $.extend( this.options, options ); }, options: {}, // Nothing for now canTravel: function() { return $('div#header div.headerButton').length > 1; }, addLocation: function(text, id, module) { return $('').attr('id', \"location_\" + id) .addClass('headerButton') .text(text).click(function() { if(Header.canTravel()) { Engine.travelTo(module); } }).appendTo($('div#header')); } };"},{"title":"","date":"2022-02-05T07:40:23.074Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/script/notifications.js","permalink":"http://www.rainend.org/A-Dark-Room/script/notifications.js","excerpt":"","text":"/** * Module that registers the notification box and handles messages */ var Notifications = { init: function(options) { this.options = $.extend( this.options, options ); // Create the notifications box elem = $('').attr({ id: 'notifications', className: 'notifications' }); // Create the transparency gradient $('').attr('id', 'notifyGradient').appendTo(elem); elem.appendTo('div#wrapper'); }, options: {}, // Nothing for now elem: null, notifyQueue: {}, // Allow notification to the player notify: function(module, text, noQueue) { if(typeof text == 'undefined') return; if(text.slice(-1) != \".\") text += \".\"; if(module != null && Engine.activeModule != module) { if(!noQueue) { if(typeof this.notifyQueue[module] == 'undefined') { this.notifyQueue[module] = new Array(); } this.notifyQueue[module].push(text); } } else { Notifications.printMessage(text); } Engine.saveGame(); }, printMessage: function(t) { var text = $('').addClass('notification').css('opacity', '0').text(t).prependTo('div#notifications'); text.animate({opacity: 1}, 500, 'linear'); }, printQueue: function(module) { if(typeof this.notifyQueue[module] != 'undefined') { while(this.notifyQueue[module].length > 0) { Notifications.printMessage(this.notifyQueue[module].shift()); } } } };"},{"title":"","date":"2022-02-05T07:40:23.074Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/script/outside.js","permalink":"http://www.rainend.org/A-Dark-Room/script/outside.js","excerpt":"","text":"/** * Module that registers the outdoors functionality */ var Outside = { name: \"Outside\", _GATHER_DELAY: 60, _TRAPS_DELAY: 90, _POP_DELAY: [0.5, 3], _INCOME: { 'gatherer': { //tim test should be 10 1 delay: 10, stores: { '木头': 1 } }, '捕猎手': { delay: 10, stores: { '毛皮': 0.5, '肉': 0.5 } }, '兽夹制作者': { delay: 10, stores: { '肉': -1, '诱饵': 1 } }, '制革工': { delay: 10, stores: { '毛皮': -5, '皮革': 1 } }, '腌肉者': { delay: 10, stores: { '肉': -5, '木头': -5, '腌肉': 1 } }, '铁矿工': { delay: 10, stores: { '腌肉': -1, '铁': 1 } }, '煤矿工': { delay: 10, stores: { '腌肉': -1, '煤': 1 } }, '硫磺矿工': { delay: 10, stores: { '腌肉': -1, '硫磺': 1 } }, '熔炼工': { delay: 10, stores: { '铁': -1, '煤': -1, '钢': 1 } }, '军械师': { delay: 10, stores: { '钢': -1, '硫磺': -1, '子弹': 1 } } }, TrapDrops: [ { rollUnder: 0.5, name: '毛皮', message: '破碎的皮毛' }, { rollUnder: 0.75, name: '肉', message: '小片的肉' }, { rollUnder: 0.85, name: '鳞片', message: '奇怪的鳞片' }, { rollUnder: 0.93, name: '牙齿', message: '残缺的牙齿' }, { rollUnder: 0.995, name: '布匹', message: '破烂的布料' }, { rollUnder: 1.0, name: '护身符', message: '一个粗糙的护身符' } ], init: function(options) { this.options = $.extend( this.options, options ); if(Engine._debug) { this._GATHER_DELAY = 0; this._TRAPS_DELAY = 0; } // Create the outside tab this.tab = Header.addLocation(\"A Silent Forest\", \"outside\", Outside); // Create the Outside panel this.panel = $('').attr('id', \"outsidePanel\") .addClass('location') .appendTo('div#locationSlider'); //subscribe to stateUpdates $.Dispatch('stateUpdate').subscribe(Outside.handleStateUpdates); if(typeof $SM.get('features.location.outside') == 'undefined') { $SM.set('features.location.outside', true); if(!$SM.get('game.buildings')) $SM.set('game.buildings', {}); if(!$SM.get('game.population')) $SM.set('game.population', 0); if(!$SM.get('game.workers')) $SM.set('game.workers', {}); } this.updateVillage(); Outside.updateWorkersView(); Engine.updateSlider(); // Create the gather button new Button.Button({ id: 'gatherButton', text: \"收集木头\", click: Outside.gatherWood, cooldown: Outside._GATHER_DELAY, width: '80px' }).appendTo('div#outsidePanel'); }, getMaxPopulation: function() { return $SM.get('game.buildings[\"木屋\"]', true) * 4; }, increasePopulation: function() { var space = Outside.getMaxPopulation() - $SM.get('game.population'); if(space > 0) { var num = Math.floor(Math.random()*(space/2) + space/2); if(num == 0) num = 1; if(num == 1) { Notifications.notify(null, '一个生人在夜晚到来.'); } else if(num < 5) { Notifications.notify(null, '一个长途跋涉的家庭搬入了一个木屋.'); } else if(num < 10) { Notifications.notify(null, '一小群人抵达了, 个个瘦骨嶙峋.'); } else if(num < 30) { Notifications.notify(null, '一大队人群抵达, 带来了磨难与希望.'); } else { Notifications.notify(null, \"小村已成为小镇, 热闹非凡, 言语无法形容.\"); } Engine.log('population increased by ' + num); $SM.add('game.population', num); } Outside.schedulePopIncrease(); }, killVillagers: function(num) { $SM.add('game.population', num * -1); if($SM.get('game.population') < 0) { $SM.set('game.population', 0); } var remaining = Outside.getNumGatherers(); if(remaining < 0) { var gap = -remaining; for(var k in $SM.get('game.workers')) { var num = $SM.get('game.workers[\"'+k+'\"]'); if(num < gap) { gap -= num; $SM.set('game.workers[\"'+k+'\"]', 0); } else { $SM.add('game.workers[\"'+k+'\"]', gap * -1); break; } } } }, schedulePopIncrease: function() { var nextIncrease = Math.floor(Math.random()*(Outside._POP_DELAY[1] - Outside._POP_DELAY[0])) + Outside._POP_DELAY[0]; Engine.log('next population increase scheduled in ' + nextIncrease + ' minutes'); Outside._popTimeout = setTimeout(Outside.increasePopulation, nextIncrease * 60 * 1000); }, updateWorkersView: function() { var workers = $('div#workers'); // If our population is 0 and we don't already have a workers view, // there's nothing to do here. if(!workers.length && $SM.get('game.population') == 0) return; var needsAppend = false; if(workers.length == 0) { needsAppend = true; workers = $('').attr('id', 'workers').css('opacity', 0); } var numGatherers = $SM.get('game.population'); var gatherer = $('div#workers_row_gatherer', workers); for(var k in $SM.get('game.workers')) { var workerCount = $SM.get('game.workers[\"'+k+'\"]'); var row = $('div#workers_row_' + k.replace(' ', '-'), workers); if(row.length == 0) { row = Outside.makeWorkerRow(k, workerCount); var curPrev = null; workers.children().each(function(i) { var child = $(this); var cName = child.attr('id').substring(12).replace('-', ' '); if(cName != 'gatherer') { if(cName < k && (curPrev == null || cName > curPrev)) { curPrev = cName; } } }); if(curPrev == null && gatherer.length == 0) { row.prependTo(workers); } else if(curPrev == null) { row.insertAfter(gatherer); } else { row.insertAfter(workers.find('#workers_row_' + curPrev.replace(' ', '-'))); } } else { $('div#' + row.attr('id') + ' > div.row_val > span', workers).text(workerCount); } numGatherers -= workerCount; if(workerCount == 0) { $('.dnBtn', row).addClass('disabled'); $('.dnManyBtn', row).addClass('disabled'); } else { $('.dnBtn', row).removeClass('disabled'); $('.dnManyBtn', row).removeClass('disabled'); } } if(gatherer.length == 0) { gatherer = Outside.makeWorkerRow('gatherer', numGatherers); gatherer.prependTo(workers); } else { $('div#workers_row_gatherer > div.row_val > span', workers).text(numGatherers); } if(numGatherers == 0) { $('.upBtn', '#workers').addClass('disabled'); $('.upManyBtn', '#workers').addClass('disabled'); } else { $('.upBtn', '#workers').removeClass('disabled'); $('.upManyBtn', '#workers').removeClass('disabled'); } if(needsAppend && workers.children().length > 0) { workers.appendTo('#outsidePanel').animate({opacity:1}, 300, 'linear'); } }, getNumGatherers: function() { var num = $SM.get('game.population'); for(var k in $SM.get('game.workers')) { num -= $SM.get('game.workers[\"'+k+'\"]'); } return num; }, makeWorkerRow: function(name, num) { var row = $('') .attr('id', 'workers_row_' + name.replace(' ','-')) .addClass('workerRow'); $('').addClass('row_key').text(name).appendTo(row); var val = $('').addClass('row_val').appendTo(row); $('').text(num).appendTo(val); if(name != 'gatherer') { $('').addClass('upManyBtn').appendTo(val).click([10], Outside.increaseWorker); $('').addClass('upBtn').appendTo(val).click([1], Outside.increaseWorker); $('').addClass('dnBtn').appendTo(val).click([1], Outside.decreaseWorker); $('').addClass('dnManyBtn').appendTo(val).click([10], Outside.decreaseWorker); } $('').addClass('clear').appendTo(row); var tooltip = $('').addClass('tooltip bottom right').appendTo(row); var income = Outside._INCOME[name]; for(var s in income.stores) { var r = $('').addClass('storeRow'); $('').addClass('row_key').text(s).appendTo(r); $('').addClass('row_val').text(Engine.getIncomeMsg(income.stores[s], income.delay)).appendTo(r); r.appendTo(tooltip); } return row; }, increaseWorker: function(btn) { var worker = $(this).closest('.workerRow').children('.row_key').text(); if(Outside.getNumGatherers() > 0) { var increaseAmt = Math.min(Outside.getNumGatherers(), btn.data); Engine.log('increasing ' + worker + ' by ' + increaseAmt); $SM.add('game.workers[\"'+worker+'\"]', increaseAmt); } }, decreaseWorker: function(btn) { var worker = $(this).closest('.workerRow').children('.row_key').text(); if($SM.get('game.workers[\"'+worker+'\"]') > 0) { var decreaseAmt = Math.min($SM.get('game.workers[\"'+worker+'\"]') || 0, btn.data); Engine.log('decreasing ' + worker + ' by ' + decreaseAmt); $SM.add('game.workers[\"'+worker+'\"]', decreaseAmt * -1); } }, updateVillageRow: function(name, num, village) { var id = 'building_row_' + name.replace(' ', '-'); var row = $('div#' + id, village); if(row.length == 0 && num > 0) { row = $('').attr('id', id).addClass('storeRow'); $('').addClass('row_key').text(name).appendTo(row); $('').addClass('row_val').text(num).appendTo(row); $('').addClass('clear').appendTo(row); var curPrev = null; village.children().each(function(i) { var child = $(this); if(child.attr('id') != 'population') { var cName = child.attr('id').substring(13).replace('-', ' '); if(cName < name && (curPrev == null || cName > curPrev)) { curPrev = cName; } } }); if(curPrev == null) { row.prependTo(village); } else { row.insertAfter('#building_row_' + curPrev.replace(' ', '-')); } } else if(num > 0) { $('div#' + row.attr('id') + ' > div.row_val', village).text(num); } else if(num == 0) { row.remove(); } }, updateVillage: function(ignoreStores) { var village = $('div#village'); var population = $('div#population'); var needsAppend = false; if(village.length == 0) { needsAppend = true; village = $('').attr('id', 'village').css('opacity', 0); population = $('').attr('id', 'population').appendTo(village); } for(var k in $SM.get('game.buildings')) { if(k == '陷阱') { var numTraps = $SM.get('game.buildings[\"'+k+'\"]'); var numBait = $SM.get('stores[\"诱饵\"]', true); var traps = numTraps - numBait; traps = traps < 0 ? 0 : traps; Outside.updateVillageRow(k, traps, village); Outside.updateVillageRow('上饵陷阱', numBait > numTraps ? numTraps : numBait, village); } else { if(Outside.checkWorker(k)) { Outside.updateWorkersView(); } Outside.updateVillageRow(k, $SM.get('game.buildings[\"'+k+'\"]'), village); } } population.text('人口 ' + $SM.get('game.population') + '/' + this.getMaxPopulation()); var hasPeeps; if($SM.get('game.buildings[\"木屋\"]', true) == 0) { hasPeeps = false; village.addClass('noHuts'); } else { hasPeeps = true; village.removeClass('noHuts'); } if(needsAppend && village.children().length > 1) { village.appendTo('#outsidePanel'); village.animate({opacity:1}, 300, 'linear'); } if(hasPeeps && typeof Outside._popTimeout == 'undefined') { Outside.schedulePopIncrease(); } this.setTitle(); if(!ignoreStores && Engine.activeModule === Outside && village.children().length > 1) { $('#storesContainer').css({top: village.height() + 26 + 'px'}); } }, checkWorker: function(name) { var jobMap = { '猎人小屋': ['捕猎手', '兽夹制作者'], '制革坊': ['制革工'], '腌肉坊': ['腌肉者'], '铁矿': ['铁矿工'], '煤矿': ['煤矿工'], '硫磺矿': ['硫磺矿工'], '炼钢炉': ['熔炼工'], '军械库' : ['军械师'] }; var jobs = jobMap[name]; var added = false; if(typeof jobs == 'object') { for(var i = 0, len = jobs.length; i < len; i++) { var job = jobs[i]; if(typeof $SM.get('game.buildings[\"'+name+'\"]') == 'number' && typeof $SM.get('game.workers[\"'+job+'\"]') != 'number') { Engine.log('adding ' + job + ' to the workers list'); $SM.set('game.workers[\"'+job+'\"]', 0); added = true; } } } return added; }, updateVillageIncome: function() { for(var worker in Outside._INCOME) { var income = Outside._INCOME[worker]; var num = worker == 'gatherer' ? Outside.getNumGatherers() : $SM.get('game.workers[\"'+worker+'\"]'); if(typeof num == 'number') { var stores = {}; if(num < 0) num = 0; var tooltip = $('.tooltip', 'div#workers_row_' + worker.replace(' ', '-')); tooltip.empty(); var needsUpdate = false; var curIncome = $SM.getIncome(worker); for(var store in income.stores) { stores[store] = income.stores[store] * num; if(curIncome[store] != stores[store]) needsUpdate = true; var row = $('').addClass('storeRow'); $('').addClass('row_key').text(store).appendTo(row); $('').addClass('row_val').text(Engine.getIncomeMsg(stores[store], income.delay)).appendTo(row); row.appendTo(tooltip); } if(needsUpdate) { $SM.setIncome(worker, { delay: income.delay, stores: stores }); } } } Room.updateIncomeView(); }, updateTrapButton: function() { var btn = $('div#trapsButton'); if($SM.get('game.buildings[\"陷阱\"]', true) > 0) { if(btn.length == 0) { new Button.Button({ id: 'trapsButton', text: \"检查陷阱\", click: Outside.checkTraps, cooldown: Outside._TRAPS_DELAY, width: '80px' }).appendTo('div#outsidePanel'); } else { Button.setDisabled(btn, false); } } else { if(btn.length > 0) { Button.setDisabled(btn, true); } } }, setTitle: function() { var numHuts = $SM.get('game.buildings[\"木屋\"]', true); var title; if(numHuts == 0) { title = \"静谧森林\"; } else if(numHuts == 1) { title = \"孤单的木屋\"; } else if(numHuts"},{"title":"","date":"2022-02-05T07:40:23.074Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/script/path.js","permalink":"http://www.rainend.org/A-Dark-Room/script/path.js","excerpt":"","text":"var Path = { DEFAULT_BAG_SPACE: 10, // Everything not in this list weighs 1 Weight: { '骨枪': 2, '铁剑': 3, '钢剑': 5, '步枪': 5, '子弹': 0.1, '燃料电池': 0.2, '镭射枪': 5, '链球': 0.5 }, name: 'Path', options: {}, // Nuthin' init: function(options) { this.options = $.extend( this.options, options ); // Init the World World.init(); // Create the path tab this.tab = Header.addLocation(\"探索者尘路\", \"path\", Path); // Create the Path panel this.panel = $('').attr('id', \"pathPanel\") .addClass('location') .appendTo('div#locationSlider'); // Add the outfitting area var outfitting = $('').attr('id', 'outfitting').appendTo(this.panel); $('').attr('id', 'bagspace').appendTo(outfitting); // Add the embark button new Button.Button({ id: 'embarkButton', text: \"出发\", click: Path.embark, width: '80px', cooldown: World.DEATH_COOLDOWN }).appendTo(this.panel); Path.outfit = {}; Engine.updateSlider(); //subscribe to stateUpdates $.Dispatch('stateUpdate').subscribe(Path.handleStateUpdates); }, openPath: function() { Path.init(); Engine.event('progress', 'path'); Notifications.notify(Room, '罗盘指向 ' + World.dir); }, getWeight: function(thing) { var w = Path.Weight[thing]; if(typeof w != 'number') w = 1; return w; }, getCapacity: function() { if($SM.get('stores[\"大货车\"]', true) > 0) { //same return Path.DEFAULT_BAG_SPACE + 60; //tim test, should be 60 } else if($SM.get('stores[\"货车\"]', true) > 0) { //same return Path.DEFAULT_BAG_SPACE + 30; } else if($SM.get('stores[\"旅行包\"]', true) > 0) { //tim mark, in case of bug stores.rucksack return Path.DEFAULT_BAG_SPACE + 10; } return Path.DEFAULT_BAG_SPACE; }, getFreeSpace: function() { var num = 0; if(Path.outfit) { for(var k in Path.outfit) { var n = Path.outfit[k]; if(isNaN(n)) { // No idea how this happens, but I will fix it here! Path.outfit[k] = n = 0; } num += n * Path.getWeight(k); } } return Path.getCapacity() - num; }, updatePerks: function() { if($SM.get('character.perks')) { var perks = $('#perks'); var needsAppend = false; if(perks.length == 0) { needsAppend = true; perks = $('').attr('id', 'perks'); } for(var k in $SM.get('character.perks')) { var id = 'perk_' + k.replace(' ', '-'); var r = $('#' + id); if($SM.get('character.perks[\"'+k+'\"]') && r.length == 0) { r = $('').attr('id', id).addClass('perkRow').appendTo(perks); $('').addClass('row_key').text(k).appendTo(r); $('').addClass('tooltip bottom right').text(Engine.Perks[k].desc).appendTo(r); } } if(needsAppend && perks.children().length > 0) { perks.appendTo(Path.panel); } if(Engine.activeModule === Path) { $('#storesContainer').css({top: perks.height() + 26 + 'px'}); } } }, updateOutfitting: function() { var outfit = $('div#outfitting'); if(!Path.outfit) { Path.outfit = {}; } // Add the armour row var armour = \"none\"; if($SM.get('stores[\"钢甲\"]', true) > 0) armour = \"钢甲\"; else if($SM.get('stores[\"铁甲\"]', true) > 0) armour = \"铁甲\"; else if($SM.get('stores[\"皮甲\"]', true) > 0) armour = \"皮甲\"; var aRow = $('#armourRow'); if(aRow.length == 0) { aRow = $('').attr('id', 'armourRow').addClass('outfitRow').prependTo(outfit); $('').addClass('row_key').text('防护装甲').appendTo(aRow); $('').addClass('row_val').text(armour).appendTo(aRow); $('').addClass('clear').appendTo(aRow); } else { $('.row_val', aRow).text(armour); } // Add the water row var wRow = $('#waterRow'); if(wRow.length == 0) { wRow = $('').attr('id', 'waterRow').addClass('outfitRow').insertAfter(aRow); $('').addClass('row_key').text('水').appendTo(wRow); $('').addClass('row_val').text(World.getMaxWater()).appendTo(wRow); $('').addClass('clear').appendTo(wRow); } else { $('.row_val', wRow).text(World.getMaxWater()); } var space = Path.getFreeSpace(); var total = 0; // Add the non-craftables to the craftables var carryable = $.extend({ '腌肉': { type: 'tool' }, '子弹': { type: 'tool' }, '手雷': {type: 'weapon' }, '链球': {type: 'weapon' }, '镭射枪': {type: 'weapon' }, '燃料电池': {type: 'tool' }, '刺刀': {type: 'weapon' }, '护身符': {type: 'tool'}, '医疗药剂': {type: 'tool'} }, Room.Craftables); for(var k in carryable) { var store = carryable[k]; var have = $SM.get('stores[\"'+k+'\"]'); var num = Path.outfit[k]; num = typeof num == 'number' ? num : 0; var numAvailable = $SM.get('stores[\"'+k+'\"]', true); var row = $('div#outfit_row_' + k.replace(' ', '-'), outfit); if((store.type == 'tool' || store.type == 'weapon') && have > 0) { total += num * Path.getWeight(k); if(row.length == 0) { row = Path.createOutfittingRow(k, num); var curPrev = null; outfit.children().each(function(i) { var child = $(this); if(child.attr('id').indexOf('outfit_row_') == 0) { var cName = child.attr('id').substring(11).replace('-', ' '); if(cName < k && (curPrev == null || cName > curPrev)) { curPrev = cName; } } }); if(curPrev == null) { row.insertAfter(wRow); } else { row.insertAfter(outfit.find('#outfit_row_' + curPrev.replace(' ', '-'))); } } else { $('div#' + row.attr('id') + ' > div.row_val > span', outfit).text(num); $('div#' + row.attr('id') + ' .tooltip .numAvailable', outfit).text(numAvailable - num); } if(num == 0) { $('.dnBtn', row).addClass('disabled'); $('.dnManyBtn', row).addClass('disabled'); } else { $('.dnBtn', row).removeClass('disabled'); $('.dnManyBtn', row).removeClass('disabled'); } if(num >= numAvailable || space < Path.getWeight(k)) { $('.upBtn', row).addClass('disabled'); $('.upManyBtn', row).addClass('disabled'); } else if(space >= Path.getWeight(k)) { $('.upBtn', row).removeClass('disabled'); $('.upManyBtn', row).removeClass('disabled'); } } else if(have == 0 && row.length > 0) { row.remove(); } } // Update bagspace $('#bagspace').text('容量 ' + Math.floor(Path.getCapacity() - total) + '/' + Path.getCapacity()); if(Path.outfit['腌肉'] > 0) { Button.setDisabled($('#embarkButton'), false); } else { Button.setDisabled($('#embarkButton'), true); } }, createOutfittingRow: function(name, num) { var row = $('').attr('id', 'outfit_row_' + name.replace(' ', '-')).addClass('outfitRow'); $('').addClass('row_key').text(name).appendTo(row); var val = $('').addClass('row_val').appendTo(row); $('').text(num).appendTo(val); $('').addClass('upBtn').appendTo(val).click([1], Path.increaseSupply); $('').addClass('dnBtn').appendTo(val).click([1], Path.decreaseSupply); $('').addClass('upManyBtn').appendTo(val).click([10], Path.increaseSupply); $('').addClass('dnManyBtn').appendTo(val).click([10], Path.decreaseSupply); $('').addClass('clear').appendTo(row); var numAvailable = $SM.get('stores[\"'+name+'\"]', true); var tt = $('').addClass('tooltip bottom right').appendTo(row); $('').addClass('row_key').text('重量').appendTo(tt); $('').addClass('row_val').text(Path.getWeight(name)).appendTo(tt); $('').addClass('row_key').text('库存').appendTo(tt); $('').addClass('row_val').addClass('numAvailable').text(numAvailable).appendTo(tt); return row; }, increaseSupply: function(btn) { var supply = $(this).closest('.outfitRow').children('.row_key').text().replace('-', ' '); Engine.log('increasing ' + supply + ' by up to ' + btn.data); var cur = Path.outfit[supply]; cur = typeof cur == 'number' ? cur : 0; if(Path.getFreeSpace() >= Path.getWeight(supply) && cur < $SM.get('stores[\"'+supply+'\"]', true)) { var maxExtraByWeight = Math.floor(Path.getFreeSpace() / Path.getWeight(supply)); var maxExtraByStore = $SM.get('stores[\"'+supply+'\"]', true) - cur; var maxExtraByBtn = btn.data; Path.outfit[supply] = cur + Math.min(maxExtraByBtn, Math.min(maxExtraByWeight, maxExtraByStore)); Path.updateOutfitting(); } }, decreaseSupply: function(btn) { var supply = $(this).closest('.outfitRow').children('.row_key').text().replace('-', ' '); Engine.log('decreasing ' + supply + ' by up to ' + btn.data); var cur = Path.outfit[supply]; cur = typeof cur == 'number' ? cur : 0; if(cur > 0) { Path.outfit[supply] = Math.max(0, cur - btn.data); Path.updateOutfitting(); } }, onArrival: function(transition_diff) { Path.setTitle(); Path.updateOutfitting(); Path.updatePerks(); Engine.moveStoresView($('#perks'), transition_diff); }, setTitle: function() { document.title = '探索者尘路'; }, embark: function() { for(var k in Path.outfit) { $SM.add('stores[\"'+k+'\"]', -Path.outfit[k]); } World.onArrival(); $('#outerSlider').animate({left: '-700px'}, 300); Engine.activeModule = World; }, handleStateUpdates: function(e){ if(e.category == 'character' && e.stateName.indexOf('character.perks') == 0 && Engine.activeModule == Path){ Path.updatePerks(); }; } };"},{"title":"","date":"2022-02-05T07:40:23.074Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/script/prestige.js","permalink":"http://www.rainend.org/A-Dark-Room/script/prestige.js","excerpt":"","text":"var Prestige = { name: 'Prestige', options: {}, init: function(options) { this.options = $.extend(this.options, options); }, storesMap: [ { store: '木头', type: 'g' }, { store: '毛皮', type: 'g' }, { store: '肉', type: 'g' }, { store: '铁', type: 'g' }, { store: '煤', type: 'g' }, { store: '硫磺', type: 'g' }, { store: '钢', type: 'g' }, { store: '腌肉', type: 'g' }, { store: '鳞片', type: 'g' }, { store: '牙齿', type: 'g' }, { store: '皮革', type: 'g' }, { store: '诱饵', type: 'g' }, { store: '火炬', type: 'g' }, { store: '布匹', type: 'g' }, { store: '骨枪', type: 'w' }, { store: '铁剑', type: 'w' }, { store: '钢剑', type: 'w' }, { store: '刺刀', type: 'w' }, { store: '步枪', type: 'w' }, { store: '镭射枪', type: 'w' }, { store: '子弹', type: 'a' }, { store: '燃料电池', type: 'a' }, { store: '手雷', type: 'a' }, { store: '链球', type: 'a' } ], getStores: function(reduce) { var stores = []; for(var i in this.storesMap) { var s = this.storesMap[i]; stores.push($SM.get('stores[\"' + s.store + '\"]', true) / (reduce ? this.randGen(s.type) : 1)); } return stores; }, get: function() { return { stores: $SM.get('previous.stores'), score: $SM.get('previous.score') }; }, set: function(prestige) { $SM.set('previous.stores', prestige.stores); $SM.set('previous.score', prestige.score); }, save: function() { $SM.set('previous.stores', this.getStores(true)); $SM.set('previous.score', Score.totalScore()); }, collectStores : function() { var prevStores = $SM.get('previous.stores'); if(prevStores != null) { var toAdd = {}; for(var i in this.storesMap) { var s = this.storesMap[i]; toAdd[s.store] = prevStores[i]; } $SM.addM('stores', toAdd); // Loading the stores clears em from the save prevStores.length = 0; } }, randGen : function(storeType) { switch(storeType) { case 'g': return Math.floor(Math.random() * 10); case 'w': return Math.floor(Math.floor(Math.random() * 10) / 2); case 'a': return Math.ceil(Math.random() * 10 * Math.ceil(Math.random() * 10)); default: return 1; } } };"},{"title":"","date":"2022-02-05T07:40:23.074Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/script/scoring.js","permalink":"http://www.rainend.org/A-Dark-Room/script/scoring.js","excerpt":"","text":"var Score = { name : 'Score', options : {}, init : function(options) { this.options = $.extend(this.options, options); }, calculateScore : function() { var scoreUnadded = Prestige.getStores(false); var fullScore = 0; fullScore = fullScore + scoreUnadded[0] * 1; fullScore = fullScore + scoreUnadded[1] * 1.5; fullScore = fullScore + scoreUnadded[2] * 1; fullScore = fullScore + scoreUnadded[3] * 2; fullScore = fullScore + scoreUnadded[4] * 2; fullScore = fullScore + scoreUnadded[5] * 3; fullScore = fullScore + scoreUnadded[6] * 3; fullScore = fullScore + scoreUnadded[7] * 2; fullScore = fullScore + scoreUnadded[8] * 2; fullScore = fullScore + scoreUnadded[9] * 2; fullScore = fullScore + scoreUnadded[10] * 2; fullScore = fullScore + scoreUnadded[11] * 1.5; fullScore = fullScore + scoreUnadded[12] * 1; fullScore = fullScore + scoreUnadded[13] * 1; fullScore = fullScore + scoreUnadded[14] * 10; fullScore = fullScore + scoreUnadded[15] * 30; fullScore = fullScore + scoreUnadded[16] * 50; fullScore = fullScore + scoreUnadded[17] * 100; fullScore = fullScore + scoreUnadded[18] * 150; fullScore = fullScore + scoreUnadded[19] * 150; fullScore = fullScore + scoreUnadded[20] * 3; fullScore = fullScore + scoreUnadded[21] * 3; fullScore = fullScore + scoreUnadded[22] * 5; fullScore = fullScore + scoreUnadded[23] * 4; fullScore = fullScore + $SM.get('stores[\"外星合金\"]', true) * 10; fullScore = fullScore + Ship.getMaxHull() * 50; return Math.floor(fullScore); }, save: function() { $SM.set('playStats.score', Score.calculateScore()); }, totalScore : function() { return $SM.get('previous.score', true) + Score.calculateScore(); } };"},{"title":"","date":"2022-02-05T07:40:23.074Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/script/ship.js","permalink":"http://www.rainend.org/A-Dark-Room/script/ship.js","excerpt":"","text":"/** * Module that registers the starship! */ var Ship = { LIFTOFF_COOLDOWN: 120, ALLOY_PER_HULL: 1, ALLOY_PER_THRUSTER: 1, BASE_HULL: 0, BASE_THRUSTERS: 1, name: \"Ship\", init: function(options) { this.options = $.extend( this.options, options ); if(!$SM.get('features.location.spaceShip')) { $SM.set('features.location.spaceShip', true); $SM.setM('game.spaceShip', { hull: Ship.BASE_HULL, thrusters: Ship.BASE_THRUSTERS }); } // Create the Ship tab this.tab = Header.addLocation(\"古老的飞船\", \"ship\", Ship); // Create the Ship panel this.panel = $('').attr('id', \"shipPanel\") .addClass('location') .appendTo('div#locationSlider'); Engine.updateSlider(); // Draw the hull label var hullRow = $('').attr('id', 'hullRow').appendTo('div#shipPanel'); $('').addClass('row_key').text('外壳:').appendTo(hullRow); $('').addClass('row_val').text($SM.get('game.spaceShip.hull')).appendTo(hullRow); $('').addClass('clear').appendTo(hullRow); // Draw the thrusters label var engineRow = $('').attr('id', 'engineRow').appendTo('div#shipPanel'); $('').addClass('row_key').text('引擎:').appendTo(engineRow); $('').addClass('row_val').text($SM.get('game.spaceShip.thrusters')).appendTo(engineRow); $('').addClass('clear').appendTo(engineRow); // Draw the reinforce button new Button.Button({ id: 'reinforceButton', text: '加固船身', click: Ship.reinforceHull, width: '100px', cost: {'外星合金': Ship.ALLOY_PER_HULL} }).appendTo('div#shipPanel'); // Draw the engine button new Button.Button({ id: 'engineButton', text: '升级引擎', click: Ship.upgradeEngine, width: '100px', cost: {'外星合金': Ship.ALLOY_PER_THRUSTER} }).appendTo('div#shipPanel'); // Draw the lift off button var b = new Button.Button({ id: 'liftoffButton', text: '飞向火星', click: Ship.checkLiftOff, width: '100px', cooldown: Ship.LIFTOFF_COOLDOWN }).appendTo('div#shipPanel'); if($SM.get('game.spaceShip.hull')"},{"title":"","date":"2022-02-05T07:40:23.078Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/script/space.js","permalink":"http://www.rainend.org/A-Dark-Room/script/space.js","excerpt":"","text":"/** * Module that registers spaaaaaaaaace! */ var Space = { SHIP_SPEED: 3, BASE_ASTEROID_DELAY: 500, BASE_ASTEROID_SPEED: 1500, FTB_SPEED: 60000, STAR_WIDTH: 3000, STAR_HEIGHT: 3000, NUM_STARS: 200, STAR_SPEED: 60000, FRAME_DELAY: 100, stars: null, backStars: null, ship: null, lastMove: null, done: false, shipX: null, shipY: null, hull: 0, name: \"Space\", init: function(options) { this.options = $.extend( this.options, options ); // Create the Space panel this.panel = $('').attr('id', \"spacePanel\") .addClass('location') .appendTo('#outerSlider'); // Create the ship Space.ship = $('').text(\"@\").attr('id', 'ship').appendTo(this.panel); // Create the hull display var h = $('').attr('id', 'hullRemaining').appendTo(this.panel); $('').addClass('row_key').text('外壳: ').appendTo(h); $('').addClass('row_val').appendTo(h); //subscribe to stateUpdates $.Dispatch('stateUpdate').subscribe(Space.handleStateUpdates); }, options: {}, // Nothing for now onArrival: function() { Space.done = false; Engine.keyLock = false; Space.hull = Ship.getMaxHull(); Space.altitude = 0; Space.setTitle(); Space.updateHull(); Space.up = Space.down = Space.left = Space.right = false; Space.ship.css({ top: '350px', left: '350px' }); Space.startAscent(); Space._shipTimer = setInterval(Space.moveShip, 33); }, setTitle: function() { if(Engine.activeModule == this) { var t; if(Space.altitude < 10) { t = \"Troposphere\"; } else if(Space.altitude < 20) { t = \"Stratosphere\"; } else if(Space.altitude < 30) { t = \"Mesosphere\"; } else if(Space.altitude < 45) { t = \"Thermosphere\"; } else if(Space.altitude < 60){ t = \"Exosphere\"; } else { t = \"Space\"; } document.title = t; } }, getSpeed: function() { return Space.SHIP_SPEED + $SM.get('game.spaceShip.thrusters'); }, updateHull: function() { $('div#hullRemaining div.row_val', Space.panel).text(Space.hull + '/' + Ship.getMaxHull()); }, createAsteroid: function(noNext) { var r = Math.random(); var c; if(r < 0.2) c = '#'; else if(r < 0.4) c = '$'; else if(r < 0.6) c = '%'; else if(r < 0.8) c = '&'; else c = 'H'; var x = Math.floor(Math.random() * 700); var a = $('').addClass('asteroid').text(c).appendTo('#spacePanel').css('left', x + 'px'); a.data({ xMin: x, xMax: x + a.width(), height: a.height() }); a.animate({ top: '740px' }, { duration: Space.BASE_ASTEROID_SPEED - Math.floor(Math.random() * (Space.BASE_ASTEROID_SPEED * 0.65)), easing: 'linear', progress: function() { // Collision detection var t = $(this); if(t.data('xMin') = Space.shipX) { var aY = t.css('top'); aY = parseFloat(aY.substring(0, aY.length - 2)); if(aY = Space.shipY) { // Collision Engine.log('collision'); t.remove(); Space.hull--; Space.updateHull(); if(Space.hull == 0) { Space.crash(); } } } }, complete: function() { $(this).remove(); } }); if(!noNext) { // Harder if(Space.altitude > 10) { Space.createAsteroid(true); } // HARDER if(Space.altitude > 20) { Space.createAsteroid(true); Space.createAsteroid(true); } // HAAAAAARDERRRRR!!!!1 if(Space.altitude > 40) { Space.createAsteroid(true); Space.createAsteroid(true); } if(!Space.done) { setTimeout(Space.createAsteroid, 1000 - (Space.altitude * 10)); } } }, moveShip: function() { var x = Space.ship.css('left'); x = parseFloat(x.substring(0, x.length - 2)); var y = Space.ship.css('top'); y = parseFloat(y.substring(0, y.length - 2)); var dx = 0, dy = 0; if(Space.up) { dy -= Space.getSpeed(); } else if(Space.down) { dy += Space.getSpeed(); } if(Space.left) { dx -= Space.getSpeed(); } else if(Space.right) { dx += Space.getSpeed(); } if(dx != 0 && dy != 0) { dx = dx / Math.sqrt(2); dy = dy / Math.sqrt(2); } if(Space.lastMove != null) { var dt = Date.now() - Space.lastMove; dx *= dt / 33; dy *= dt / 33; } x = x + dx; y = y + dy; if(x < 10) { x = 10; } else if(x > 690) { x = 690; } if(y < 10) { y = 10; } else if(y > 690) { y = 690; } Space.shipX = x; Space.shipY = y; Space.ship.css({ left: x + 'px', top: y + 'px' }); Space.lastMove = Date.now(); }, startAscent: function() { if (Engine.isLightsOff()) { var body_color = '#272823'; var to_color = '#EEEEEE'; } else { var body_color = '#FFFFFF'; var to_color = '#000000'; } $('body').addClass('noMask').css({backgroundColor: body_color}).animate({ backgroundColor: to_color }, { duration: Space.FTB_SPEED, easing: 'linear', progress: function() { var cur = $('body').css('background-color'); var s = 'linear-gradient(rgba' + cur.substring(3, cur.length - 1) + ', 0) 0%, rgba' + cur.substring(3, cur.length - 1) + ', 1) 100%)'; $('#notifyGradient').attr('style', 'background-color:'+cur+';background:-webkit-' + s + ';background:' + s); }, complete: Space.endGame }); Space.drawStars(); Space._timer = setInterval(function() { Space.altitude += 1; if(Space.altitude % 10 == 0) { Space.setTitle(); } if(Space.altitude > 60) { clearInterval(Space._timer); } }, 1000); Space._panelTimeout = setTimeout(function() { if (Engine.isLightsOff()) $('#spacePanel, .menu').animate({color: '#272823'}, 500, 'linear'); else $('#spacePanel, .menu').animate({color: 'white'}, 500, 'linear'); }, Space.FTB_SPEED / 2); Space.createAsteroid(); }, drawStars: function(duration) { var starsContainer = $('').attr('id', 'starsContainer').appendTo('body'); Space.stars = $('').css('bottom', '0px').attr('id', 'stars').appendTo(starsContainer); var s1 = $('').css({ width: Space.STAR_WIDTH + 'px', height: Space.STAR_HEIGHT + 'px' }); var s2 = s1.clone(); Space.stars.append(s1).append(s2); Space.drawStarAsync(s1, s2, 0); Space.stars.data('speed', Space.STAR_SPEED); Space.startAnimation(Space.stars); Space.starsBack = $('').css('bottom', '0px').attr('id', 'starsBack').appendTo(starsContainer); s1 = $('').css({ width: Space.STAR_WIDTH + 'px', height: Space.STAR_HEIGHT + 'px' }); s2 = s1.clone(); Space.starsBack.append(s1).append(s2); Space.drawStarAsync(s1, s2, 0); Space.starsBack.data('speed', Space.STAR_SPEED * 2); Space.startAnimation(Space.starsBack); }, startAnimation: function(el) { el.animate({bottom: '-3000px'}, el.data('speed'), 'linear', function() { $(this).css('bottom', '0px'); Space.startAnimation($(this)); }); }, drawStarAsync: function(el, el2, num) { var top = Math.floor(Math.random() * Space.STAR_HEIGHT) + 'px'; var left = Math.floor(Math.random() * Space.STAR_WIDTH) + 'px'; $('').text('.').addClass('star').css({ top: top, left: left }).appendTo(el); $('').text('.').addClass('star').css({ top: top, left: left }).appendTo(el2); if(num < Space.NUM_STARS) { setTimeout(function() { Space.drawStarAsync(el, el2, num + 1); }, 100); } }, crash: function() { if(Space.done) return; Engine.keyLock = true; Space.done = true; clearInterval(Space._timer); clearInterval(Space._shipTimer); clearTimeout(Space._panelTimeout); if (Engine.isLightsOff()) var body_color = '#272823'; else var body_color = '#FFFFFF'; // Craaaaash! $('body').removeClass('noMask').stop().animate({ backgroundColor: body_color }, { duration: 300, progress: function() { var cur = $('body').css('background-color'); var s = 'linear-gradient(rgba' + cur.substring(3, cur.length - 1) + ', 0) 0%, rgba' + cur.substring(3, cur.length - 1) + ', 1) 100%)'; $('#notifyGradient').attr('style', 'background-color:'+cur+';background:-webkit-' + s + ';background:' + s); }, complete: function() { Space.stars.remove(); Space.starsBack.remove(); Space.stars = Space.starsBack = null; $('#starsContainer').remove(); $('body').attr('style', ''); $('#notifyGradient').attr('style', ''); $('#spacePanel').attr('style', ''); } }); $('.menu').animate({color: '#666'}, 300, 'linear'); $('#outerSlider').animate({top: '0px'}, 300, 'linear'); Engine.activeModule = Ship; Ship.onArrival(); Button.cooldown($('#liftoffButton')); Engine.event('progress', 'crash'); }, endGame: function() { if(Space.done) return; Engine.event('progress', 'win'); Space.done = true; clearInterval(Space._timer); clearInterval(Space._shipTimer); clearTimeout(Engine._saveTimer); clearTimeout(Outside._popTimeout); clearTimeout(Engine._incomeTimeout); clearTimeout(Events._eventTimeout); clearTimeout(Room._fireTimer); clearTimeout(Room._tempTimer); for(var k in Room.Craftables) { Room.Craftables[k].button = null; } for(var k in Room.TradeGoods) { Room.TradeGoods[k].button = null; } delete Outside._popTimeout; $('#hullRemaining', Space.panel).animate({opacity: 0}, 500, 'linear'); Space.ship.animate({ top: '350px', left: '240px' }, 3000, 'linear', function() { setTimeout(function() { Space.ship.animate({ top: '-100px' }, 200, 'linear', function() { // Restart everything! Play FOREVER! $('#outerSlider').css({'left': '0px', 'top': '0px'}); $('#locationSlider, #worldPanel, #spacePanel, #notifications').remove(); $('#header').empty(); setTimeout(function() { $('body').stop(); if (Engine.isLightsOff()) var container_color = '#EEE'; else var container_color = '#000'; $('#starsContainer').animate({ opacity: 0, 'background-color': container_color }, { duration: 2000, progress: function() { var cur = $('body').css('background-color'); var s = 'linear-gradient(rgba' + cur.substring(3, cur.length - 1) + ', 0) 0%, rgba' + cur.substring(3, cur.length - 1) + ', 1) 100%)'; $('#notifyGradient').attr('style', 'background-color:'+cur+';background:-webkit-' + s + ';background:' + s); }, complete: function() { Engine.GAME_OVER = true; Score.save(); Prestige.save(); $('') .addClass('centerCont') .appendTo('body'); $('') .addClass('endGame') .text('本局游戏积分: ' + Score.calculateScore()) .appendTo('.centerCont') .animate({opacity:1},1500); $('') .appendTo('.centerCont'); $('') .addClass('endGame') .text('总计游戏积分: ' + Prestige.get().score) .appendTo('.centerCont') .animate({opacity:1},1500); $('') .appendTo('.centerCont'); $('') .appendTo('.centerCont'); $('#starsContainer').remove(); $('#content, #notifications').remove(); $('') .addClass('endGame endGameRestart') .text('重新开始游戏') .click(Engine.confirmDelete) .appendTo('.centerCont') .animate({opacity:1},1500); Engine.options = {}; Engine.deleteSave(true); } }); }, 2000); }); }, 2000); }); }, keyDown: function(event) { switch(event.which) { case 38: // Up case 87: Space.up = true; Engine.log('up on'); break; case 40: // Down case 83: Space.down = true; Engine.log('down on'); break; case 37: // Left case 65: Space.left = true; Engine.log('left on'); break; case 39: // Right case 68: Space.right = true; Engine.log('right on'); break; } }, keyUp: function(event) { switch(event.which) { case 38: // Up case 87: Space.up = false; Engine.log('up off'); break; case 40: // Down case 83: Space.down = false; Engine.log('down off'); break; case 37: // Left case 65: Space.left = false; Engine.log('left off'); break; case 39: // Right case 68: Space.right = false; Engine.log('right off'); break; } }, handleStateUpdates: function(e){ } };"},{"title":"","date":"2022-02-05T07:40:23.078Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/script/state_manager.js","permalink":"http://www.rainend.org/A-Dark-Room/script/state_manager.js","excerpt":"","text":"/* * Module for handling States * * All states should be get and set through the StateManager ($SM). * * The manager is intended to handle all needed checks and error catching. * This includes creating the parents of layered/deep states so undefined states * do not need to be tested for and created beforehand. * * When a state is changed, an update event is sent out containing the name of the state * changed or in the case of multiple changes (.setM, .addM) the parent class changed. * Event: type: 'stateUpdate', stateName: * * Original file created by: Michael Galusha */ var StateManager = { MAX_STORE: 99999999999999, options: {}, init: function(options) { this.options = $.extend( this.options, options ); //create categories var cats = [ 'features', //big features like buildings, location availability, unlocks, etc 'stores', //little stuff, items, weapons, etc 'character', //this is for player's character stats such as perks 'income', 'timers', 'game', //mostly location related: fire temp, workers, population, world map, etc 'playStats', //anything play related: play time, loads, etc 'previous' // prestige, score, trophies (in future), achievements (again, not yet), etc ]; for(var which in cats) { if(!$SM.get(cats[which])) $SM.set(cats[which], {}); }; //subscribe to stateUpdates $.Dispatch('stateUpdate').subscribe($SM.handleStateUpdates); }, //create all parents and then set state createState: function(stateName, value) { var words = stateName.split(/[.\\[\\]'\"]+/); //for some reason there are sometimes empty strings for (var i = 0; i < words.length; i++) { if (words[i] == '') { words.splice(i, 1); i--; } }; var obj = State; var w = null; for(var i=0, len=words.length-1;i $SM.MAX_STORE) value = $SM.MAX_STORE; try{ eval('('+fullPath+') = value'); } catch (e) { //parent doesn't exist, so make parent $SM.createState(stateName, value); } //stores values can not be negative if(stateName.indexOf('stores') == 0 && $SM.get(stateName, true) < 0) { eval('('+fullPath+') = 0'); Engine.log('WARNING: state:' + stateName + ' can not be a negative value. Set to 0 instead.'); } if(!noEvent) { Engine.saveGame(); $SM.fireUpdate(stateName); } }, //sets a list of states setM: function(parentName, list, noEvent) { $SM.buildPath(parentName); //make sure the state exists to avoid errors, if($SM.get(parentName) == undefined) $SM.set(parentName, {}, true); for(var k in list){ $SM.set(parentName+'[\"'+k+'\"]', list[k], true); } if(!noEvent) { Engine.saveGame(); $SM.fireUpdate(parentName); } }, //shortcut for altering number values, return 1 if state wasn't a number add: function(stateName, value, noEvent) { var err = 0; //0 if undefined, null (but not {}) should allow adding to new objects //could also add in a true = 1 thing, to have something go from existing (true) //to be a count, but that might be unwanted behavior (add with loose eval probably will happen anyways) var old = $SM.get(stateName, true); //check for NaN (old != old) and non number values if(old != old){ Engine.log('WARNING: '+stateName+' was corrupted (NaN). Resetting to 0.'); old = 0; $SM.set(stateName, old + value, noEvent); } else if(typeof old != 'number' || typeof value != 'number'){ Engine.log('WARNING: Can not do math with state:'+stateName+' or value:'+value+' because at least one is not a number.'); err = 1; } else { $SM.set(stateName, old + value, noEvent); //setState handles event and save } return err; }, //alters multiple number values, return number of fails addM: function(parentName, list, noEvent) { var err = 0; //make sure the parent exists to avoid errors if($SM.get(parentName) == undefined) $SM.set(parentName, {}, true); for(var k in list){ if(!$SM.add(parentName+'[\"'+k+'\"]', list[k], true)) err++; } if(!noEvent) { Engine.saveGame(); $SM.fireUpdate(parentName); } return err; }, //return state, undefined or 0 get: function(stateName, requestZero) { var whichState = null; var fullPath = $SM.buildPath(stateName); //catch errors if parent of state doesn't exist try{ eval('whichState = ('+fullPath+')'); } catch (e) { whichState = undefined; } //prevents repeated if undefined, null, false or {}, then x = 0 situations if((!whichState || whichState == {}) && requestZero) return 0; else return whichState; }, //mainly for local copy use, add(M) can fail so we can't shortcut them //since set does not fail, we know state exists and can simply return the object setget: function(stateName, value, noEvent){ $SM.set(stateName, value, noEvent); return eval('('+$SM.buildPath(stateName)+')'); }, remove: function(stateName, noEvent) { var whichState = $SM.buildPath(stateName); try{ eval('(delete '+whichState+')'); } catch (e) { //it didn't exist in the first place Engine.log('WARNING: Tried to remove non-existant state \\''+stateName+'\\'.'); } if(!noEvent){ Engine.saveGame(); $SM.fireUpdate(stateName); }; }, //creates full reference from input //hopefully this won't ever need to be more complicated buildPath: function(input){ var dot = (input.charAt(0) == '[')? '' : '.'; //if it starts with [foo] no dot to join return 'State' + dot + input; }, fireUpdate: function(stateName, save){ var category = $SM.getCategory(stateName); if(stateName == undefined) stateName = category = 'all'; //best if this doesn't happen as it will trigger more stuff $.Dispatch('stateUpdate').publish({'category': category, 'stateName':stateName}); if(save) Engine.saveGame(); }, getCategory: function(stateName){ var firstOB = stateName.indexOf('['); var firstDot = stateName.indexOf('.'); var cutoff = null; if(firstOB == -1 || firstDot == -1){ cutoff = firstOB > firstDot ? firstOB : firstDot; } else { cutoff = firstOB < firstDot ? firstOB : firstDot; } if (cutoff == -1){ return stateName; } else { return stateName.substr(0,cutoff); } }, //Use this function to make old save games compatible with new version updateOldState: function(){ var version = $SM.get('version'); if(typeof version != 'number') version = 1.0; if(version == 1.0) { // v1.1 introduced the Lodge, so get rid of lodgeless hunters $SM.remove('outside.workers[\"捕猎手\"]', true); $SM.remove('income[\"捕猎手\"]', true); Engine.log('upgraded save to v1.1'); version = 1.1; }; if(version == 1.1) { //v1.2 added the Swamp to the map, so add it to already generated maps if($SM.get('world')) { World.placeLandmark(15, World.RADIUS * 1.5, World.TILE.SWAMP, $SM.get('world.map')); } Engine.log('upgraded save to v1.2'); version = 1.2; }; if(version == 1.2) { //StateManager added, so move data to new locations $SM.remove('room.fire'); $SM.remove('room.temperature'); $SM.remove('room.buttons'); if($SM.get('room')){ $SM.set('features.location.room', true); $SM.set('game.builder.level', $SM.get('room.builder')); $SM.remove('room'); }; if($SM.get('outside')){ $SM.set('features.location.outside', true); $SM.set('game.population', $SM.get('outside.population')); $SM.set('game.buildings', $SM.get('outside.buildings')); $SM.set('game.workers', $SM.get('outside.workers')); $SM.set('game.outside.seenForest', $SM.get('outside.seenForest')); $SM.remove('outside'); }; if($SM.get('world')){ $SM.set('features.location.world', true); $SM.set('game.world.map', $SM.get('world.map')); $SM.set('game.world.mask', $SM.get('world.mask')); $SM.set('starved', $SM.get('character.starved', true)); $SM.set('dehydrated', $SM.get('character.dehydrated', true)); $SM.remove('world'); $SM.remove('starved'); $SM.remove('dehydrated'); }; if($SM.get('ship')){ $SM.set('features.location.spaceShip', true); $SM.set('game.spaceShip.hull', $SM.get('ship.hull', true)); $SM.set('game.spaceShip.thrusters', $SM.get('ship.thrusters', true)); $SM.set('game.spaceShip.seenWarning', $SM.get('ship.seenWarning')); $SM.set('game.spaceShip.seenShip', $SM.get('ship.seenShip')); $SM.remove('ship'); }; if($SM.get('punches')){ $SM.set('character.punches', $SM.get('punches')); $SM.remove('punches'); }; if($SM.get('perks')){ $SM.set('character.perks', $SM.get('perks')); $SM.remove('perks'); }; if($SM.get('小偷')){ $SM.set('game[\"小偷\"]', $SM.get('小偷')); $SM.remove('小偷'); }; if($SM.get('stolen')){ $SM.set('game.stolen', $SM.get('stolen')); $SM.remove('stolen'); }; if($SM.get('cityCleared')){ $SM.set('character.cityCleared', $SM.get('cityCleared')); $SM.remove('cityCleared'); }; $SM.set('version', 1.3); }; }, /****************************************************************** * Start of specific state functions ******************************************************************/ //PERKS addPerk: function(name) { $SM.set('character.perks[\"'+name+'\"]', true); Notifications.notify(null, Engine.Perks[name].notify); }, hasPerk: function(name) { return $SM.get('character.perks[\"'+name+'\"]'); }, //INCOME setIncome: function(source, options) { var existing = $SM.get('income[\"'+source+'\"]'); if(typeof existing != 'undefined') { options.timeLeft = existing.timeLeft; } $SM.set('income[\"'+source+'\"]', options); }, getIncome: function(source) { var existing = $SM.get('income[\"'+source+'\"]'); if(typeof existing != 'undefined') { return existing; } return {}; }, collectIncome: function() { var changed = false; if(typeof $SM.get('income') != 'undefined' && Engine.activeModule != Space) { for(var source in $SM.get('income')) { var income = $SM.get('income[\"'+source+'\"]'); if(typeof income.timeLeft != 'number') { income.timeLeft = 0; } income.timeLeft--; if(income.timeLeft"},{"title":"悦读","date":"2019-02-10T13:32:48.000Z","updated":"2022-01-28T07:54:10.491Z","comments":false,"path":"tags/悦读/index.html","permalink":"http://www.rainend.org/tags/%E6%82%A6%E8%AF%BB/index.html","excerpt":"","text":""},{"title":"","date":"2022-02-05T07:40:23.070Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/script/events/encounters.js","permalink":"http://www.rainend.org/A-Dark-Room/script/events/encounters.js","excerpt":"","text":"/** * Events that can occur when wandering around the world **/ Events.Encounters = [ /* Tier 1 */ { /* Snarling Beast */ title: '咆哮的野兽', isAvailable: function() { return World.getDistance() 20 && World.getTerrain() == World.TILE.FIELD; }, scenes: { 'start': { combat: true, enemy: '狙击手', chara: 'S', damage: 15, hit: 0.8, attackDelay: 4, health: 30, ranged: true, loot: { '布匹': { min: 5, max: 10, chance: 0.8 }, '子弹': { min: 1, max: 5, chance: 0.5 }, '步枪': { min: 1, max: 1, chance: 0.2 }, '医疗药剂': { min: 1, max: 2, chance: 0.1 } }, notification: '一声枪响, 远远得传来' } } } ];"},{"title":"","date":"2022-02-05T07:40:23.070Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/script/events/global.js","permalink":"http://www.rainend.org/A-Dark-Room/script/events/global.js","excerpt":"","text":"/** * Events that can occur when any module is active (Except World. It's special.) **/ Events.Global = [ { /* The Thief */ title: '小偷', isAvailable: function() { return (Engine.activeModule == Room || Engine.activeModule == Outside) && $SM.get('game[\"小偷\"]') == 1; }, scenes: { 'start': { text: [ '村名们从储藏室拖出了一个肮脏的家伙.', \"他的家人偷走了一些物资.\", '他应该被绞死以示惩罚.' ], notification: '一个小偷被抓住了', buttons: { 'kill': { text: '吊死他', nextScene: {1: 'hang'} }, 'spare': { text: '释放他', nextScene: {1: 'spare'} } } }, 'hang': { text: [ '村名们把小偷吊死在了储藏室前面.', '在强大的压力下, 丢失的物资很快就被退回来了.' ], onLoad: function() { $SM.set('game[\"小偷\"]', 2); $SM.remove('income[\"小偷\"]'); $SM.addM('stores', $SM.get('game.stolen')); }, buttons: { 'leave': { text: '离开', nextScene: 'end' } } }, 'spare': { text: [ \"小偷感谢不杀之恩, 他说再也不偷了.\", \"他在离开之前把他的那些偷偷摸摸的技巧分享给了大家.\" ], onLoad: function() { $SM.set('game[\"小偷\"]', 2); $SM.remove('income[\"小偷\"]'); $SM.addPerk('潜行术'); }, buttons: { 'leave': { text: '离开', nextScene: 'end' } } } } } ];"},{"title":"","date":"2022-02-05T07:40:23.070Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/script/events/outside.js","permalink":"http://www.rainend.org/A-Dark-Room/script/events/outside.js","excerpt":"","text":"/** * Events that can occur when the Outside module is active **/ Events.Outside = [ { /* Ruined traps */ title: '破损的陷阱', isAvailable: function() { return Engine.activeModule == Outside && $SM.get('game.buildings[\"陷阱\"]', true) > 0; }, scenes: { 'start': { text: [ '一些陷阱已经严重损毁.', '巨大的足印导向森林.' ], onLoad: function() { var numWrecked = Math.floor(Math.random() * $SM.get('game.buildings[\"陷阱\"]', true)) + 1; $SM.add('game.buildings[\"陷阱\"]', -numWrecked); Outside.updateVillage(); Outside.updateTrapButton(); }, notification: '一些陷阱损坏了', buttons: { 'track': { text: '追踪足迹', nextScene: {0.5: 'nothing', 1: 'catch'} }, 'ignore': { text: '忽略', nextScene: 'end' } } }, 'nothing': { text: [ '踪迹消失了...', '森林再次归于宁静.' ], buttons: { 'end': { text: '离开', nextScene: 'end' } } }, 'catch': { text: [ '在离开村子的不远处发现了一只巨大的野兽, 它的皮毛覆满了暗淡的血液.', '在武器面前, 它已经没什么抵抗力了.' ], reward: { '毛皮': 100, '肉': 100, '牙齿': 10 }, buttons: { 'end': { text: '离开', nextScene: 'end' } } } } }, { /* Sickness */ title: '疾病', isAvailable: function() { return Engine.activeModule == Outside && $SM.get('game.population', true) > 10 && $SM.get('game.population', true) < 50 && $SM.get('stores[\"医疗药剂\"]', true) > 0; }, scenes: { 'start': { text: [ '疾病在村子里面传播.', '急需医疗药剂.' ], buttons: { 'heal': { text: '1 医疗药剂', cost: { '医疗药剂' : 1 }, nextScene: {1: 'healed'} }, 'ignore': { text: '置之不理', nextScene: {1: 'death'} } } }, 'healed': { text: [ '疾病被即时控制了.' ], buttons: { 'end': { text: '离开', nextScene: 'end' } } }, 'death': { text: [ '疾病蔓延在整个村庄.', '天天都有人死去.', '黑夜总是伴随着惊声尖叫.' ], onLoad: function() { var numKilled = Math.floor(Math.random() * 20) + 1; Outside.killVillagers(numKilled); }, buttons: { 'end': { text: '离开', nextScene: 'end' } } } } }, { /* Plague */ title: '瘟疫', isAvailable: function() { return Engine.activeModule == Outside && $SM.get('game.population', true) > 50 && $SM.get('stores[\"医疗药剂\"]', true) > 0; }, scenes: { 'start': { text: [ '一场可怕的瘟疫在村子里面迅速蔓延开.', '急需治疗药剂.' ], buttons: { 'heal': { text: '5 治疗药剂', cost: { '医疗药剂' : 5 }, nextScene: {1: 'healed'} }, 'ignore': { text: '置之不理', nextScene: {1: 'death'} } } }, 'healed': { text: [ '瘟疫不制止了.', '我们只失去了几个人.', '我们埋葬了这些死者.' ], onLoad: function() { var numKilled = Math.floor(Math.random() * 5) + 2; Outside.killVillagers(numKilled); }, buttons: { 'end': { text: '离开', nextScene: 'end' } } }, 'death': { text: [ '瘟疫席卷了整个村庄.', '尖叫恐惧声响彻了整个黑夜.', '死亡也许是更好的归宿.' ], onLoad: function() { var numKilled = Math.floor(Math.random() * 80) + 10; Outside.killVillagers(numKilled); }, buttons: { 'end': { text: '离开', nextScene: 'end' } } } } }, { /* Beast attack */ title: '猛兽袭击', isAvailable: function() { return Engine.activeModule == Outside && $SM.get('game.population', true) > 0; }, scenes: { 'start': { text: [ '一群野兽冲出了森林奔向村庄.', '战斗短暂而血腥, 兽群最终被击退了.', '村名们放弃了追击, 集体悼念了死去的人.' ], onLoad: function() { var numKilled = Math.floor(Math.random() * 10) + 1; Outside.killVillagers(numKilled); }, reward: { '毛皮': 100, '肉': 100, '牙齿': 10 }, buttons: { 'end': { text: '离开', nextScene: 'end' } } } } }, { /* Soldier attack */ title: '武装冲突', isAvailable: function() { return Engine.activeModule == Outside && $SM.get('game.population', true) > 0 && $SM.get('game.cityCleared');; }, scenes: { 'start': { text: [ '一声枪响穿透树林.', '武装精良的士兵冲突森林, 向我们的人开火.', '在冲突后, 几个村名死亡, 随即武装人员就离开了.' ], onLoad: function() { var numKilled = Math.floor(Math.random() * 40) + 1; Outside.killVillagers(numKilled); }, reward: { '子弹': 10, '腌肉': 50 }, buttons: { 'end': { text: '离开', nextScene: 'end' } } } } } ];"},{"title":"","date":"2022-02-05T07:40:23.070Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/script/events/room.js","permalink":"http://www.rainend.org/A-Dark-Room/script/events/room.js","excerpt":"","text":"/** * Events that can occur when the Room module is active **/ Events.Room = [ { /* The Nomad -- Merchant */ title: '游牧帐篷', isAvailable: function() { return Engine.activeModule == Room && $SM.get('stores.毛皮', true) > 0; }, scenes: { 'start': { text: [ '一个游牧贸易团进入了视野, 他们携带了很多粗糙的麻线袋, 装满了货物.', \"他们没有说他们从那里来, 显然也不会一直呆在这里.\" ], notification: '一个游牧帐篷抵达并寻求贸易', buttons: { 'buyScales': { text: '购买 鳞片', cost: { '毛皮': 100 }, reward: { '鳞片': 1 } }, 'buyTeeth': { text: '购买 牙齿', cost: { '毛皮': 200 }, reward: { '牙齿': 1 } }, 'buyBait': { text: '购买 诱饵', cost: { '毛皮': 5 }, reward: { '诱饵': 1 }, notification: '带诱饵的陷阱更有效.' }, 'buyCompass': { available: function() { return $SM.get('stores[\"罗盘\"]', true) < 1; }, text: '购买 罗盘', cost: { '毛皮': 300, '鳞片': 15, '牙齿': 5 }, reward: { '罗盘': 1 }, notification: '罗盘看上去很旧, 布满了灰尘, 但是依旧工作良好.', onChoose: Path.openPath }, 'goodbye': { text: '再见', nextScene: 'end' } } } } }, { /* Noises Outside -- gain wood/fur */ title: '噪音', isAvailable: function() { return Engine.activeModule == Room && $SM.get('stores[\"木头\"]'); }, scenes: { 'start': { text: [ '嘈杂声穿墙入耳.', \"不知道发生了什么事.\" ], notification: '怪的声音穿墙而来', buttons: { 'investigate': { text: '调查', nextScene: { 0.3: 'stuff', 1: 'nothing' } }, 'ignore': { text: '无视', nextScene: 'end' } } }, 'nothing': { text: [ '模糊的身影移动着进入了黑暗.', '噪音消失了.' ], buttons: { 'backinside': { text: '离开', nextScene: 'end' } } }, 'stuff': { reward: { '木头': 100, '毛皮': 10 }, text: [ '一大捆用毛皮绑着的木头躺在门槛上.', '黑夜再次趋于宁静.' ], buttons: { 'backinside': { text: '离开', nextScene: 'end' } } } } }, { /* Noises Inside -- trade wood for better good */ title: '噪音', isAvailable: function() { return Engine.activeModule == Room && $SM.get('stores[\"木头\"]'); }, scenes: { start: { text: [ '摩擦声从储藏室内传来.', '一定有什么东西在那.' ], notification: '有东西在储藏室', buttons: { 'investigate': { text: '调查', nextScene: { 0.5: '鳞片', 0.8: '牙齿', 1: '布匹' } }, 'ignore': { text: '忽略', nextScene: 'end' } } }, '鳞片': { text: [ '一些木头不见了.', '地上有很多细小的鳞片' ], onLoad: function() { var numWood = $SM.get('stores[\"木头\"]', true); numWood = Math.floor(numWood * 0.1); if(numWood == 0) numWood = 1; var numScales = Math.floor(numWood / 5); if(numScales == 0) numScales = 1; $SM.addM('stores', {'木头': -numWood, '鳞片': numScales}); }, buttons: { 'leave': { text: '离开', nextScene: 'end' } } }, '牙齿': { text: [ '一些木头丢失了.', '地面流下了一些破碎的牙齿' ], onLoad: function() { var numWood = $SM.get('stores[\"木头\"]', true); numWood = Math.floor(numWood * 0.1); if(numWood == 0) numWood = 1; var numTeeth = Math.floor(numWood / 5); if(numTeeth == 0) numTeeth = 1; $SM.addM('stores', {'木头': -numWood, '牙齿': numTeeth}); }, buttons: { 'leave': { text: '离开', nextScene: 'end' } } }, '布匹': { text: [ '丢失了一些木头.', '地上有很多碎步屑' ], onLoad: function() { var numWood = $SM.get('stores[\"木头\"]', true); numWood = Math.floor(numWood * 0.1); if(numWood == 0) numWood = 1; var numCloth = Math.floor(numWood / 5); if(numCloth == 0) numCloth = 1; $SM.addM('stores', {'木头': -numWood, '布匹': numCloth}); }, buttons: { 'leave': { text: '离开', nextScene: 'end' } } } } }, { /* The Beggar -- trade fur for better good */ title: '乞丐', isAvailable: function() { return Engine.activeModule == Room && $SM.get('stores[\"毛皮\"]'); }, scenes: { start: { text: [ '来了一个乞丐.', '乞求能给他一点暖和身子的皮毛.' ], notification: '来了一个乞丐', buttons: { '50furs': { text: '给 50', cost: {'毛皮': 50}, nextScene: { 0.5: '鳞片', 0.8: '牙齿', 1: '布匹' } }, '100furs': { text: '给 100', cost: {'毛皮': 100}, nextScene: { 0.5: '牙齿', 0.8: '鳞片', 1: '布匹' } }, 'deny': { text: '撵走他', nextScene: 'end' } } }, '鳞片': { reward: { '鳞片': 20 }, text: [ '乞丐感激异常.', '留下一堆20的鳞片.' ], buttons: { 'leave': { text: '再见', nextScene: 'end' } } }, '牙齿': { reward: { '牙齿': 20 }, text: [ '乞丐感激异常.', '留下一堆20的牙齿.' ], buttons: { 'leave': { text: '再见', nextScene: 'end' } } }, '布匹': { reward: { '布匹': 20 }, text: [ '乞丐感激异常.', '留下一堆20的布料.' ], buttons: { 'leave': { text: '再见', nextScene: 'end' } } } } }, { /* Mysterious Wanderer -- wood gambling */ title: '神秘流浪者', isAvailable: function() { return Engine.activeModule == Room && $SM.get('stores[\"木头\"]'); }, scenes: { start: { text: [ '一个流浪汉带着一个空筐子来到了木屋, 说如果能给她一些木头带走, 他之后会带来更多.', \"工人不知道他是否值得信任.\" ], notification: '一个神秘的流浪汉抵达', buttons: { '100wood': { text: '给 100', cost: {'木头': 100}, nextScene: { 1: '100wood'} }, '500wood': { text: '给 500', cost: {'木头': 500}, nextScene: { 1: '500wood' } }, 'deny': { text: '撵走他', nextScene: 'end' } } }, '100wood': { text: [ '流浪汉离开了, 筐子满载木头' ], onLoad: function() { if(Math.random() < 0.5) { setTimeout(function() { $SM.add('stores[\"木头\"]', 300); Notifications.notify(Room, '流浪女回来了, 带回来了300的木头.'); }, 60 * 1000); } }, buttons: { 'leave': { text: '再见', nextScene: 'end' } } }, '500wood': { text: [ '流浪汉离开了, 筐子满载木头' ], onLoad: function() { if(Math.random() < 0.3) { setTimeout(function() { $SM.add('stores[\"木头\"]', 1500); Notifications.notify(Room, '流浪女回来了, 带回来了1500的木头.'); }, 60 * 1000); } }, buttons: { 'leave': { text: '再见', nextScene: 'end' } } } } }, { /* Mysterious Wanderer -- fur gambling */ title: '神秘流浪者', isAvailable: function() { return Engine.activeModule == Room && $SM.get('stores[\"毛皮\"]'); }, scenes: { start: { text: [ '一个流浪女带着一个空筐子来到了木屋, 说如果能给她一些皮毛带走, 她之后会带来更多.', \"工人不知道她是否值得信任.\" ], notification: '一个神秘的流浪女抵达', buttons: { '100fur': { text: '给 100', cost: {'毛皮': 100}, nextScene: { 1: '100fur'} }, '500fur': { text: '给 500', cost: {'毛皮': 500}, nextScene: { 1: '500fur' } }, 'deny': { text: '撵走她', nextScene: 'end' } } }, '100fur': { text: [ '流浪女离开了, 筐子满载皮毛' ], onLoad: function() { if(Math.random() < 0.5) { setTimeout(function() { $SM.add('stores[\"毛皮\"]', 300); Notifications.notify(Room, '流浪女回来了, 带回来了300的皮毛.'); }, 60 * 1000); } }, buttons: { 'leave': { text: '再见', nextScene: 'end' } } }, '500fur': { text: [ '流浪女离开了, 筐子满载皮毛' ], onLoad: function() { if(Math.random() < 0.3) { setTimeout(function() { $SM.add('stores[\"毛皮\"]', 1500); Notifications.notify(Room, '流浪女回来了, 带回来了1500的皮毛'); }, 60 * 1000); } }, buttons: { 'leave': { text: '再见', nextScene: 'end' } } } } }, { /* The Scout -- Map Merchant */ title: '侦察兵', isAvailable: function() { return Engine.activeModule == Room && $SM.get('features.location.world'); }, scenes: { 'start': { text: [ \"这个侦察兵说她已经去过所有的地图了.\", \"她愿意谈谈地图, 当然不是免费的.\" ], notification: '一个侦察兵在夜幕中到来', buttons: { 'buyMap': { text: '购买地图', cost: { '毛皮': 200, '鳞片': 10 }, notification: '地图包含大地图的一角', onChoose: World.applyMap }, 'learn': { text: '学习侦察', cost: { '毛皮': 1000, '鳞片': 50, '牙齿': 20 }, available: function() { return !$SM.hasPerk('千里眼'); }, onChoose: function() { $SM.addPerk('千里眼'); } }, 'leave': { text: '离开', nextScene: 'end' } } } } }, { /* The Wandering Master */ title: '大师', isAvailable: function() { return Engine.activeModule == Room && $SM.get('features.location.world'); }, scenes: { 'start': { text: [ '一个年老的流浪汉出现了', '他微笑着青请求寄宿过夜.' ], notification: '一个年老的流浪汉出现了', buttons: { 'agree': { text: '同意', cost: { '腌肉': 100, '毛皮': 100, '火炬': 1 }, nextScene: {1: 'agree'} }, 'deny': { text: '撵走他', nextScene: 'end' } } }, 'agree': { text: [ '作为交换, 老流浪汉分享了他的智慧.' ], buttons: { 'evasion': { text: '逃脱术', available: function() { return !$SM.hasPerk('凌波微步'); }, onChoose: function() { $SM.addPerk('凌波微步'); }, nextScene: 'end' }, 'precision': { text: '精准术', available: function() { return !$SM.hasPerk('兰花佛穴手'); }, onChoose: function() { $SM.addPerk('兰花佛穴手'); }, nextScene: 'end' }, 'force': { text: '力量大师', available: function() { return !$SM.hasPerk('降龙十八掌'); }, onChoose: function() { $SM.addPerk('降龙十八掌'); }, nextScene: 'end' }, 'nothing': { text: '无视', nextScene: 'end' } } } } }, { /* The Sick Man */ title: '病人', isAvailable: function() { return Engine.activeModule == Room && $SM.get('stores[\"医疗药剂\"]', true) > 0; }, scenes: { 'start': { text: [ \"一个男人躬着身, 咳嗽.\", \"他乞求一些治疗药剂.\" ], notification: '一个病人蹒跚而至', buttons: { 'help': { text: '给 1 治疗药剂', cost: { '医疗药剂': 1 }, notification: '这个男人狼吞虎咽喝掉了治疗药剂', nextScene: { 0.1: 'alloy', 0.3: 'cells', 0.5: '鳞片', 1.0: 'nothing' } }, 'ignore': { text: '撵他走', nextScene: 'end' } } }, 'alloy': { text: [ \"这个男人很感激.\", '他留下了他的反馈.', '在他旅行中获得的一些奇怪的金属.' ], onLoad: function() { $SM.add('stores[\"外星合金\"]', 1); }, buttons: { 'bye': { text: '再见', nextScene: 'end' } } }, 'cells': { text: [ \"这个男人很感激.\", '他留下了他的反馈.', '在他旅行中获得的一些奇怪的发光盒子.' ], onLoad: function() { $SM.add('stores[\"燃料电池\"]', 3); }, buttons: { 'bye': { text: '再见', nextScene: 'end' } } }, '鳞片': { text: [ \"这个男人很感激.\", '他留下了他的反馈.', '在他旅行中获得的一些鳞片.' ], onLoad: function() { $SM.add('stores[\"鳞片\"]', 5); }, buttons: { 'bye': { text: '再见', nextScene: 'end' } } }, 'nothing': { text: [ \"这个男人感谢异常, 挥手告别, 留下一根毛.\" ], buttons: { 'bye': { text: '再见', nextScene: 'end' } } } } } ];"},{"title":"","date":"2022-02-05T07:40:23.070Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/script/events.js","permalink":"http://www.rainend.org/A-Dark-Room/script/events.js","excerpt":"","text":"/** * Module that handles the random event system */ var Events = { _EVENT_TIME_RANGE: [3, 6], // range, in minutes _PANEL_FADE: 200, _FIGHT_SPEED: 100, _EAT_COOLDOWN: 5, _MEDS_COOLDOWN: 7, STUN_DURATION: 4000, init: function(options) { this.options = $.extend( this.options, options ); // Build the Event Pool Events.EventPool = new Array().concat( Events.Global, Events.Room, Events.Outside ); Events.eventStack = []; Events.scheduleNextEvent(); //subscribe to stateUpdates $.Dispatch('stateUpdate').subscribe(Events.handleStateUpdates); }, options: {}, // Nothing for now activeEvent: null, activeScene: null, eventPanel: null, loadScene: function(name) { Engine.log('loading scene: ' + name); Events.activeScene = name; var scene = Events.activeEvent().scenes[name]; // Scene reward if(scene.reward) { $SM.addM('stores', scene.reward); } // onLoad if(scene.onLoad) { scene.onLoad(); } // Notify the scene change if(scene.notification) { Notifications.notify(null, scene.notification); } $('#description', Events.eventPanel()).empty(); $('#buttons', Events.eventPanel()).empty(); if(scene.combat) { Events.startCombat(scene); } else { Events.startStory(scene); } }, startCombat: function(scene) { Engine.event('game event', 'combat'); Events.won = false; var desc = $('#description', Events.eventPanel()); $('').text(scene.notification).appendTo(desc); // Draw the wanderer Events.createFighterDiv('@', World.health, World.getMaxHealth()).attr('id', 'wanderer').appendTo(desc); // Draw the enemy Events.createFighterDiv(scene.chara, scene.health, scene.health).attr('id', 'enemy').appendTo(desc); // Draw the action buttons var btns = $('#buttons', Events.eventPanel()); var numWeapons = 0; for(var k in World.Weapons) { var weapon = World.Weapons[k]; if(typeof Path.outfit[k] == 'number' && Path.outfit[k] > 0) { if(typeof weapon.damage != 'number' || weapon.damage == 0) { // Weapons that deal no damage don't count numWeapons--; } else if(weapon.cost){ for(var c in weapon.cost) { var num = weapon.cost[c]; if(typeof Path.outfit[c] != 'number' || Path.outfit[c] < num) { // Can't use this weapon, so don't count it numWeapons--; } } } numWeapons++; Events.createAttackButton(k).appendTo(btns); } } if(numWeapons == 0) { // No weapons? You can punch stuff! Events.createAttackButton('拳击').prependTo(btns); } Events.createEatMeatButton().appendTo(btns); if((Path.outfit['医疗药剂'] || 0) != 0) { Events.createUseMedsButton().appendTo(btns); } // Set up the enemy attack timer Events._enemyAttackTimer = setTimeout(Events.enemyAttack, scene.attackDelay * 1000); }, createEatMeatButton: function(cooldown) { if (cooldown == null) { cooldown = Events._EAT_COOLDOWN; } var btn = new Button.Button({ id: 'eat', text: '吃腌肉', cooldown: cooldown, click: Events.eatMeat, cost: { '腌肉': 1 } }); if(Path.outfit['腌肉'] == 0) { Button.setDisabled(btn, true); } return btn; }, createUseMedsButton: function(cooldown) { if (cooldown == null) { cooldown = Events._MEDS_COOLDOWN; } var btn = new Button.Button({ id: 'meds', text: '使用药剂', cooldown: cooldown, click: Events.useMeds, cost: { '医疗药剂': 1 } }); if((Path.outfit['医疗药剂'] || 0) == 0) { Button.setDisabled(btn, true); } return btn; }, createAttackButton: function(weaponName) { var weapon = World.Weapons[weaponName]; var cd = weapon.cooldown; if(weapon.type == 'unarmed') { if($SM.hasPerk('降龙十八掌')) { cd /= 2; } } var btn = new Button.Button({ id: 'attack_' + weaponName.replace(' ', '-'), text: weapon.verb, cooldown: cd, click: Events.useWeapon, cost: weapon.cost }); if(typeof weapon.damage == 'number' && weapon.damage > 0) { btn.addClass('weaponButton'); } for(var k in weapon.cost) { if(typeof Path.outfit[k] != 'number' || Path.outfit[k] < weapon.cost[k]) { Button.setDisabled(btn, true); break; } } return btn; }, drawFloatText: function(text, parent) { $('').text(text).addClass('damageText').appendTo(parent).animate({ 'bottom': '50px', 'opacity': '0' }, 300, 'linear', function() { $(this).remove(); }); }, eatMeat: function() { if(Path.outfit['腌肉'] > 0) { Path.outfit['腌肉']--; World.updateSupplies(); if(Path.outfit['腌肉'] == 0) { Button.setDisabled($('#eat'), true); } var hp = World.health; hp += World.meatHeal(); hp = hp > World.getMaxHealth() ? World.getMaxHealth() : hp; World.setHp(hp); if(Events.activeEvent()) { var w = $('#wanderer'); w.data('hp', hp); Events.updateFighterDiv(w); Events.drawFloatText('+' + World.meatHeal(), '#wanderer .hp'); } } }, useMeds: function() { if(Path.outfit['医疗药剂'] > 0) { Path.outfit['医疗药剂']--; World.updateSupplies(); if(Path.outfit['医疗药剂'] == 0) { Button.setDisabled($('#meds'), true); } var hp = World.health; hp += World.medsHeal(); hp = hp > World.getMaxHealth() ? World.getMaxHealth() : hp; World.setHp(hp); if(Events.activeEvent()) { var w = $('#wanderer'); w.data('hp', hp); Events.updateFighterDiv(w); Events.drawFloatText('+' + World.medsHeal(), '#wanderer .hp'); } } }, useWeapon: function(btn) { if(Events.activeEvent()) { var weaponName = btn.attr('id').substring(7).replace('-', ' '); var weapon = World.Weapons[weaponName]; if(weapon.type == 'unarmed') { if(!$SM.get('character.punches')) $SM.set('character.punches', 0); $SM.add('character.punches', 1); if($SM.get('character.punches') == 50 && !$SM.hasPerk('通臂拳')) { $SM.addPerk('通臂拳'); } else if($SM.get('character.punches') == 150 && !$SM.hasPerk('金刚掌')) { $SM.addPerk('金刚掌'); } else if($SM.get('character.punches') == 300 && !$SM.hasPerk('降龙十八掌')) { $SM.addPerk('降龙十八掌'); } } if(weapon.cost) { var mod = {}; var out = false; for(var k in weapon.cost) { if(typeof Path.outfit[k] != 'number' || Path.outfit[k] < weapon.cost[k]) { return; } mod[k] = -weapon.cost[k]; if(Path.outfit[k] - weapon.cost[k] < weapon.cost[k]) { out = true; } } for(var k in mod) { Path.outfit[k] += mod[k]; } if(out) { Button.setDisabled(btn, true); var validWeapons = false; $('.weaponButton').each(function(){ if(!Button.isDisabled($(this)) && $(this).attr('id') != 'attack_fists') { validWeapons = true; return false; } }); if(!validWeapons) { // enable or create the punch button var fists = $('#attack_fists'); if(fists.length == 0) { Events.createAttackButton('拳击').prependTo('#buttons', Events.eventPanel()); } else { Button.setDisabled(fists, false); } } } World.updateSupplies(); } var dmg = -1; if(Math.random() 0) { var dropRow = $('').attr('id', 'drop_' + k.replace(' ', '-')) .text(k + ' x' + numToDrop) .data('thing', k) .data('num', numToDrop) .click(Events.dropStuff); dropRow.appendTo(dropMenu); } } } dropMenu.appendTo(btn); btn.one(\"mouseleave\", function() { $('#dropMenu').remove(); }); } } }, createFighterDiv: function(chara, hp, maxhp) { var fighter = $('').addClass('fighter').text(chara).data('hp', hp).data('maxHp', maxhp); $('').addClass('hp').text(hp+'/'+maxhp).appendTo(fighter); return fighter; }, updateFighterDiv: function(fighter) { $('.hp', fighter).text(fighter.data('hp') + '/' + fighter.data('maxHp')); }, startStory: function(scene) { // Write the text var desc = $('#description', Events.eventPanel()); for(var i in scene.text) { $('').text(scene.text[i]).appendTo(desc); } if(scene.textarea) { $('').val(scene.textarea).appendTo(desc); } // Draw any loot if(scene.loot) { Events.drawLoot(scene.loot); } // Draw the buttons Events.drawButtons(scene); }, drawButtons: function(scene) { var btns = $('#buttons', Events.eventPanel()); for(var id in scene.buttons) { var info = scene.buttons[id]; var b = new Button.Button({ id: id, text: info.text, cost: info.cost, click: Events.buttonClick }).appendTo(btns); if(typeof info.available == 'function' && !info.available()) { Button.setDisabled(b, true); } } Events.updateButtons(); }, updateButtons: function() { var btns = Events.activeEvent().scenes[Events.activeScene].buttons; for(var bId in btns) { var b = btns[bId]; var btnEl = $('#'+bId, Events.eventPanel()); if(typeof b.available == 'function' && !b.available()) { Button.setDisabled(btnEl, true); } else if(b.cost) { var disabled = false; for(var store in b.cost) { var num = Engine.activeModule == World ? Path.outfit[store] : $SM.get('stores[\"'+store+'\"]', true); if(typeof num != 'number') num = 0; if(num < b.cost[store]) { // Too expensive disabled = true; break; } } Button.setDisabled(btnEl, disabled); } } }, buttonClick: function(btn) { var info = Events.activeEvent().scenes[Events.activeScene].buttons[btn.attr('id')]; // Cost var costMod = {}; if(info.cost) { for(var store in info.cost) { var num = Engine.activeModule == World ? Path.outfit[store] : $SM.get('stores[\"'+store+'\"]', true); if(typeof num != 'number') num = 0; if(num < info.cost[store]) { // Too expensive return; } costMod[store] = -info.cost[store]; } if(Engine.activeModule == World) { for(var k in costMod) { Path.outfit[k] += costMod[k]; } World.updateSupplies(); } else { $SM.addM('stores', costMod); } } if(typeof info.onChoose == 'function') { info.onChoose(); } // Reward if(info.reward) { $SM.addM('stores', info.reward); } Events.updateButtons(); // Notification if(info.notification) { Notifications.notify(null, info.notification); } // Next Scene if(info.nextScene) { if(info.nextScene == 'end') { Events.endEvent(); } else { var r = Math.random(); var lowestMatch = null; for(var i in info.nextScene) { if(r < i && (lowestMatch == null || i < lowestMatch)) { lowestMatch = i; } } if(lowestMatch != null) { Events.loadScene(info.nextScene[lowestMatch]); return; } Engine.log('ERROR: no suitable scene found'); Events.endEvent(); } } }, // Makes an event happen! triggerEvent: function() { if(Events.activeEvent() == null) { var possibleEvents = []; for(var i in Events.EventPool) { var event = Events.EventPool[i]; if(event.isAvailable()) { possibleEvents.push(event); } } if(possibleEvents.length == 0) { Events.scheduleNextEvent(0.5); return; } else { var r = Math.floor(Math.random()*(possibleEvents.length)); Events.startEvent(possibleEvents[r]); } } Events.scheduleNextEvent(); }, triggerFight: function() { var possibleFights = []; for(var i in Events.Encounters) { var fight = Events.Encounters[i]; if(fight.isAvailable()) { possibleFights.push(fight); } } var r = Math.floor(Math.random()*(possibleFights.length)); Events.startEvent(possibleFights[r]); }, activeEvent: function() { if(Events.eventStack && Events.eventStack.length > 0) { return Events.eventStack[0]; } return null; }, eventPanel: function() { return Events.activeEvent().eventPanel; }, startEvent: function(event, options) { if(event) { Engine.event('game event', 'event'); Engine.keyLock = true; Events.eventStack.unshift(event); event.eventPanel = $('').attr('id', 'event').addClass('eventPanel').css('opacity', '0'); if(options != null && options.width != null) { Events.eventPanel().css('width', options.width); } $('').addClass('eventTitle').text(Events.activeEvent().title).appendTo(Events.eventPanel()); $('').attr('id', 'description').appendTo(Events.eventPanel()); $('').attr('id', 'buttons').appendTo(Events.eventPanel()); Events.loadScene('start'); $('div#wrapper').append(Events.eventPanel()); Events.eventPanel().animate({opacity: 1}, Events._PANEL_FADE, 'linear'); } }, scheduleNextEvent: function(scale) { var nextEvent = Math.floor(Math.random()*(Events._EVENT_TIME_RANGE[1] - Events._EVENT_TIME_RANGE[0])) + Events._EVENT_TIME_RANGE[0]; if(scale > 0) { nextEvent *= scale; } Engine.log('next event scheduled in ' + nextEvent + ' minutes'); Events._eventTimeout = setTimeout(Events.triggerEvent, nextEvent * 60 * 1000); }, endEvent: function() { Events.eventPanel().animate({opacity:0}, Events._PANEL_FADE, 'linear', function() { Events.eventPanel().remove(); Events.activeEvent().eventPanel = null; Events.eventStack.shift(); Engine.log(Events.eventStack.length + ' events remaining'); Engine.keyLock = false; // Force refocus on the body. I hate you, IE. $('body').focus(); }); }, handleStateUpdates: function(e){ if(e.category == 'stores' && Events.activeEvent() != null){ Events.updateButtons(); } } };"},{"title":"","date":"2022-02-05T07:40:23.074Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/script/room.js","permalink":"http://www.rainend.org/A-Dark-Room/script/room.js","excerpt":"","text":"/** * Module that registers the simple room functionality */ var Room = { // times in (minutes * seconds * milliseconds) _FIRE_COOL_DELAY: 5 * 60 * 1000, // time after a stoke before the fire cools _ROOM_WARM_DELAY: 30 * 1000, // time between room temperature updates _BUILDER_STATE_DELAY: 0.5 * 60 * 1000, // time between builder state updates _STOKE_COOLDOWN: 10, // cooldown to stoke the fire _NEED_WOOD_DELAY: 15 * 1000, // from when the stranger shows up, to when you need wood fire:null, temperature:null, buttons:{}, Craftables: { '陷阱': { button: null, maximum: 10, availableMsg: '工人说她能制作可以捕获活的猎物的陷阱', buildMsg: '更多的陷阱能捕获更多的猎物', maxMsg: \"更多数量的陷阱已经不能带来益处\", type: 'building', cost: function() { var n = $SM.get('game.buildings[\"陷阱\"]', true); return { '木头': 10 + (n*10) }; } }, '筐子': { button: null, maximum: 1, availableMsg: '工人说她能制作收集木头的筐子', buildMsg: '软筐能容纳更多的木头', type: 'building', cost: function() { return { '木头': 30 }; } }, '木屋': { button: null, maximum: 20, availableMsg: \"工人说会有更多的迷路者来到这里, 他们也会加入我们.\", buildMsg: '工人在森林里搭起一座木屋.', maxMsg: '没有空间建造木屋了.', type: 'building', cost: function() { var n = $SM.get('game.buildings[\"木屋\"]', true); return { '木头': 100 + (n*50) }; } }, '猎人小屋': { button: null, maximum: 1, availableMsg: '我们的村民只要有了工具, 他们就能去打猎', buildMsg: '猎人小屋就坐落在村子口', type: 'building', cost: function() { return { '木头': 200, '毛皮': 10, '肉': 5 }; } }, '贸易栈': { button: null, maximum: 1, availableMsg: \"有了贸易栈你就能很灵活的调度物资\", buildMsg: \"游牧民族们可以有地方落脚了\", type: 'building', cost: function() { return { '木头': 400, '毛皮': 100 }; } }, '制革坊': { button: null, maximum: 1, availableMsg: \"工人说皮革很有用, 我们的村民能搞定.\", buildMsg: '游牧民族们可以有地方落脚了', type: 'building', cost: function() { return { '木头': 500, '毛皮': 50 }; } }, '腌肉坊': { button: null, maximum: 1, availableMsg: \"工人说如果不腌制, 鲜肉很快就会腐烂, 她有办法.\", buildMsg: '工人很快建成了腌制房, 她很想吃腊肉, 川味的.', type: 'building', cost: function() { return { '木头': 600, '肉': 50 }; } }, '工具房': { button: null, maximum: 1, availableMsg: \"工人说如果有合适的工具, 她能做的更好\", buildMsg: \"工具间总算完工了, 工人兴奋极了\", type: 'building', cost: function() { return { '木头': 800, '皮革': 100, '鳞片': 10 }; } }, '炼钢炉': { button: null, maximum: 1, availableMsg: \"工人说只要有合适的工具, 村名可以炼钢\", buildMsg: \"炼钢炉起, 雾霾就来了\", type: 'building', cost: function() { return { '木头': 1500, '铁': 100, '煤': 100 }; } }, '军械库': { button: null, maximum: 1, availableMsg: \"工人说稳定的武器和弹药供应是必要的\", buildMsg: \"军械库完成! 武器入库.\", type: 'building', cost: function() { return { '木头': 3000, '钢': 100, '硫磺': 50 }; } }, '火炬': { button: null, type: 'tool', buildMsg: '用以驱散黑暗的火炬', cost: function() { return { '木头': 1, '布匹': 1 }; } }, '水袋': { //'水袋': { button: null, type: 'upgrade', maximum: 1, buildMsg: '水袋..就是用来放水的, 可惜容量小了点', cost: function() { return { '皮革': 50 }; } }, '水桶': { button: null, type: 'upgrade', maximum: 1, buildMsg: '木桶可以存放不少的水, 探险能持续更久', cost: function() { return { '皮革': 100, '铁': 20 }; } }, '水箱': { button: null, type: 'upgrade', maximum: 1, buildMsg: '你再也不会缺水了.', cost: function() { return { '铁': 100, '钢': 50 }; } }, '骨枪': { //'bone spear': { button: null, type: 'weapon', buildMsg: \"这枪有点糙, 但是用来突刺已经足够了\", cost: function() { return { '木头': 100, '牙齿': 5 }; } }, '旅行包': { button: null, type: 'upgrade', maximum: 1, buildMsg: '载得更多意味着更长更远的野外探险', cost: function() { return { '皮革': 200 }; } }, '货车': { button: null, type: 'upgrade', maximum: 1, buildMsg: '货车可以载很多的物资供给', cost: function() { return { '木头': 500, '铁': 100 }; } }, '大货车': { button: null, type: 'upgrade', maximum: 1, buildMsg: '超级大货车可以装载一切', cost: function() { return { '木头': 1000, '铁': 200, '钢': 100 }; } }, '皮甲': { type: 'upgrade', maximum: 1, buildMsg: \"皮革的确不是太牢固, 但总好过布料.\", cost: function() { return { '皮革': 200, '鳞片': 20 }; } }, '铁甲': { type: 'upgrade', maximum: 1, buildMsg: \"铁比皮结实\", cost: function() { return { '皮革': 200, '铁': 100 }; } }, '钢甲': { type: 'upgrade', maximum: 1, buildMsg: \"钢又比铁更牢固\", cost: function() { return { '皮革': 200, '钢': 100 }; } }, '铁剑': { button: null, type: 'weapon', buildMsg: \"铁剑很尖锐, 在野外提供给我们足够的保护.\", cost: function() { return { '木头': 200, '皮革': 50, '铁': 20 }; } }, '钢剑': { button: null, type: 'weapon', buildMsg: \"钢剑很锋利, 很可怕.\", cost: function() { return { '木头': 500, '皮革': 100, '钢': 20 }; } }, '步枪': { type: 'weapon', buildMsg: \"黑火药和子弹, 好复古的感觉.\", cost: function() { return { '木头': 200, '钢': 50, '硫磺': 50 }; } } }, TradeGoods: { '鳞片': { type: 'good', cost: function() { return { '毛皮': 150 }; } }, '牙齿': { type: 'good', cost: function() { return { '毛皮': 300 }; } }, '铁': { type: 'good', cost: function() { return { '毛皮': 150, '鳞片': 50 }; } }, '煤': { type: 'good', cost: function() { return { '毛皮': 200, '牙齿': 50 }; } }, '钢': { type: 'good', cost: function() { return { '毛皮': 300, '鳞片': 50, '牙齿': 50 }; } }, '医疗药剂': { type: 'good', cost: function() { return { '鳞片': 50, '牙齿': 30 }; } }, '子弹': { type: 'good', cost: function() { return { '鳞片': 10 }; } }, '燃料电池': { type: 'good', cost: function() { return { '鳞片': 10, '牙齿': 10 }; } }, '链球': { type: 'weapon', cost: function() { return { '牙齿': 10 }; } }, '手雷': { type: 'weapon', cost: function() { return { '鳞片': 100, '牙齿': 50 }; } }, '刺刀': { type: 'weapon', cost: function() { return { '鳞片': 500, '牙齿': 250 }; } }, '外星合金': { type: 'good', cost: function() { return { '毛皮': 1500, '鳞片': 750, '牙齿': 300 }; } }, '罗盘': { type: 'upgrade', maximum: 1, cost: function() { return { '毛皮': 400, '鳞片': 20, '牙齿': 10 }; } } }, MiscItems: { '镭射枪': { type: 'weapon' } }, name: \"Room\", init: function(options) { this.options = $.extend( this.options, options ); if(Engine._debug) { this._ROOM_WARM_DELAY = 5000; this._BUILDER_STATE_DELAY = 5000; this._STOKE_COOLDOWN = 0; this._NEED_WOOD_DELAY = 5000; } if(typeof $SM.get('features.location.room') == 'undefined') { $SM.set('features.location.room', true); $SM.set('game.builder.level', -1); } Room.temperature = this.TempEnum.Cold; Room.fire = this.FireEnum.Dead; // Create the room tab this.tab = Header.addLocation(\"冰冷漆黑的木屋\", \"room\", Room); // Create the Room panel this.panel = $('') .attr('id', \"roomPanel\") .addClass('location') .appendTo('div#locationSlider'); Engine.updateSlider(); // Create the light button new Button.Button({ id: 'lightButton', text: '点火', click: Room.lightFire, cooldown: Room._STOKE_COOLDOWN, width: '80px', //cost: {'木头': 1} cost: {'木头': 5} }).appendTo('div#roomPanel'); // Create the stoke button new Button.Button({ id: 'stokeButton', text: \"添加木头\", click: Room.stokeFire, cooldown: Room._STOKE_COOLDOWN, width: '80px', cost: {'木头': 1} }).appendTo('div#roomPanel'); // Create the stores container $('').attr('id', 'storesContainer').appendTo('div#roomPanel'); //subscribe to stateUpdates $.Dispatch('stateUpdate').subscribe(Room.handleStateUpdates); Room.updateButton(); Room.updateStoresView(); Room.updateIncomeView(); Room.updateBuildButtons(); Room._fireTimer = setTimeout(Room.coolFire, Room._FIRE_COOL_DELAY); Room._tempTimer = setTimeout(Room.adjustTemp, Room._ROOM_WARM_DELAY); /* * Builder states: * 0 - Approaching * 1 - Collapsed * 2 - Shivering * 3 - Sleeping * 4 - Helping */ if($SM.get('game.builder.level') >= 0 && $SM.get('game.builder.level') < 3) { Room._builderTimer = setTimeout(Room.updateBuilderState, Room._BUILDER_STATE_DELAY); } if($SM.get('game.builder.level') == 1 && $SM.get('stores[\"木头\"]', true) < 0) { setTimeout(Room.unlockForest, Room._NEED_WOOD_DELAY); } setTimeout($SM.collectIncome, 1000); Notifications.notify(Room, \"木屋 \" + Room.temperature.text); Notifications.notify(Room, \"火堆 \" + Room.fire.text); }, options: {}, // Nothing for now onArrival: function(transition_diff) { Room.setTitle(); if(Room.changed) { Notifications.notify(Room, \"火堆 \" + Room.fire.text); Notifications.notify(Room, \"木屋 \" + Room.temperature.text); Room.changed = false; } if($SM.get('game.builder.level') == 3) { $SM.add('game.builder.level', 1); $SM.setIncome('工人', { delay: 10, stores: {'木头' : 2 } }); Room.updateIncomeView(); Notifications.notify(Room, \"陌生人围坐在火堆旁, 她说她会帮忙建造建筑或者制造物件工具.\"); } Engine.moveStoresView(null, transition_diff); }, TempEnum: { fromInt: function(value) { for(var k in this) { if(typeof this[k].value != 'undefined' && this[k].value == value) { return this[k]; } } return null; }, Freezing: { value: 0, text: '极度深寒' }, Cold: { value: 1, text: '很冷' }, Mild: { value: 2, text: '不冷不热' }, Warm: { value: 3, text: '温暖' }, Hot: { value: 4, text: '很热' } }, FireEnum: { fromInt: function(value) { for(var k in this) { if(typeof this[k].value != 'undefined' && this[k].value == value) { return this[k]; } } return null; }, Dead: { value: 0, text: '熄灭了' }, Smoldering: { value: 1, text: '冒烟了' }, Flickering: { value: 2, text: '有火苗了' }, Burning: { value: 3, text: '燃烧中' }, Roaring: { value: 4, text: '熊熊燃烧中' } }, setTitle: function() { var title = Room.fire.value < 2 ? \"小黑屋\" : \"温暖的木屋\"; if(Engine.activeModule == this) { document.title = title; } $('div#location_room').text(title); }, updateButton: function() { var light = $('#lightButton.button'); var stoke = $('#stokeButton.button'); if(Room.fire.value == Room.FireEnum.Dead.value && stoke.css('display') != 'none') { stoke.hide(); light.show(); if(stoke.hasClass('disabled')) { Button.cooldown(light); } } else if(light.css('display') != 'none') { stoke.show(); light.hide(); if(light.hasClass('disabled')) { Button.cooldown(stoke); } } if(!$SM.get('stores[\"木头\"]')) { light.addClass('free'); stoke.addClass('free'); } else { light.removeClass('free'); stoke.removeClass('free'); } }, _fireTimer: null, _tempTimer: null, lightFire: function() { var wood = $SM.get('stores[\"木头\"]'); if(wood < 5) { Notifications.notify(Room, \"木头不足, 无法生火\"); Button.clearCooldown($('#lightButton.button')); return; } else if(wood > 4) { $SM.set('stores[\"木头\"]', wood - 5); } Room.fire = Room.FireEnum.Burning; Room.onFireChange(); }, stokeFire: function() { var wood = $SM.get('stores[\"木头\"]'); if(wood === 0) { Notifications.notify(Room, \"木头用光了\"); Button.clearCooldown($('#stokeButton.button')); return; } if(wood > 0) { $SM.set('stores[\"木头\"]', wood - 1); } if(Room.fire.value < 4) { Room.fire = Room.FireEnum.fromInt(Room.fire.value + 1); } Room.onFireChange(); }, onFireChange: function() { if(Engine.activeModule != Room) { Room.changed = true; } Notifications.notify(Room, \"火堆 \" + Room.fire.text, true); if(Room.fire.value > 1 && $SM.get('game.builder.level') < 0) { $SM.set('game.builder.level', 0); Notifications.notify(Room, \"火堆的光芒映过窗户射进了茫茫黑暗\"); setTimeout(Room.updateBuilderState, Room._BUILDER_STATE_DELAY); } window.clearTimeout(Room._fireTimer); Room._fireTimer = setTimeout(Room.coolFire, Room._FIRE_COOL_DELAY); Room.updateButton(); Room.setTitle(); }, coolFire: function() { var wood = $SM.get('stores[\"木头\"]'); if(Room.fire.value 3 && wood > 0) { Notifications.notify(Room, \"工人给火堆添加木头\", true); $SM.set('stores[\"木头\"]', wood - 1); Room.fire = Room.FireEnum.fromInt(Room.fire.value + 1); } if(Room.fire.value > 0) { Room.fire = Room.FireEnum.fromInt(Room.fire.value - 1); Room._fireTimer = setTimeout(Room.coolFire, Room._FIRE_COOL_DELAY); Room.onFireChange(); } }, adjustTemp: function() { var old = Room.temperature.value; if(Room.temperature.value > 0 && Room.temperature.value > Room.fire.value) { Room.temperature = Room.TempEnum.fromInt(Room.temperature.value - 1); Notifications.notify(Room, \"木屋 \" + Room.temperature.text, true); } if(Room.temperature.value < 4 && Room.temperature.value < Room.fire.value) { Room.temperature = Room.TempEnum.fromInt(Room.temperature.value + 1); Notifications.notify(Room, \"木屋 \" + Room.temperature.text, true); } if(Room.temperature.value != old) { Room.changed = true; } Room._tempTimer = setTimeout(Room.adjustTemp, Room._ROOM_WARM_DELAY); }, unlockForest: function() { $SM.set('stores[\"木头\"]', 4); Outside.init(); Notifications.notify(Room, \"外面寒风呼啸\"); Notifications.notify(Room, \"木头快烧完了\"); Engine.event('progress', 'outside'); }, updateBuilderState: function() { var lBuilder = $SM.get('game.builder.level'); if(lBuilder == 0) { Notifications.notify(Room, \"一个衣衫褴褛的陌生人跌撞进门, 摔倒在墙角\"); lBuilder = $SM.setget('game.builder.level', 1); setTimeout(Room.unlockForest, Room._NEED_WOOD_DELAY); } else if(lBuilder < 3 && Room.temperature.value >= Room.TempEnum.Warm.value) { var msg = \"\"; switch(lBuilder) { case 1: msg = \"陌生人冻得发抖并且胡言乱语不知所云.\"; break; case 2: msg = \"陌生人缩在墙角并不再发抖, 呼吸也平静下来了.\"; break; } Notifications.notify(Room, msg); if(lBuilder < 3) { lBuilder = $SM.setget('game.builder.level', lBuilder + 1); } } if(lBuilder < 3) { setTimeout(Room.updateBuilderState, Room._BUILDER_STATE_DELAY); } Engine.saveGame(); }, updateStoresView: function() { var stores = $('div#stores'); var weapons = $('div#weapons'); var needsAppend = false, wNeedsAppend = false, newRow = false; if(stores.length == 0) { stores = $('').attr({ id: 'stores' }).css('opacity', 0); needsAppend = true; } if(weapons.length == 0) { weapons = $('').attr({ id: 'weapons' }).css('opacity', 0); wNeedsAppend = true; } for(var k in $SM.get('stores')) { var type = null; if(Room.Craftables[k]) { type = Room.Craftables[k].type; } else if(Room.TradeGoods[k]) { type = Room.TradeGoods[k].type; } else if (Room.MiscItems[k]) { type = Room.MiscItems[k].type; } var location; switch(type) { case 'upgrade': // Don't display upgrades on the Room screen continue; case 'weapon': location = weapons; break; default: location = stores; break; } var id = \"row_\" + k.replace(' ', '-'); var row = $('div#' + id, location); var num = $SM.get('stores[\"'+k+'\"]'); if(typeof num != 'number' || isNaN(num)) { // No idea how counts get corrupted, but I have reason to believe that they occassionally do. // Build a little fence around it! num = 0; $SM.set('stores[\"'+k+'\"]', 0); } // thieves? if(typeof $SM.get('game[\"小偷\"]') == 'undefined' && num > 5000 && $SM.get('features.location.world')) { $SM.startThieves(); } if(row.length == 0 && num > 0) { row = $('').attr('id', id).addClass('storeRow'); $('').addClass('row_key').text(k).appendTo(row); $('').addClass('row_val').text(Math.floor(num)).appendTo(row); $('').addClass('clear').appendTo(row); var curPrev = null; location.children().each(function(i) { var child = $(this); var cName = child.attr('id').substring(4).replace('-', ' '); if(cName < k && (curPrev == null || cName > curPrev)) { curPrev = cName; } }); if(curPrev == null) { row.prependTo(location); } else { row.insertAfter(location.find('#row_' + curPrev.replace(' ', '-'))); } newRow = true; } else if(num>= 0){ $('div#' + row.attr('id') + ' > div.row_val', location).text(Math.floor(num)); } } if(needsAppend && stores.children().length > 0) { stores.appendTo('div#storesContainer'); stores.animate({opacity: 1}, 300, 'linear'); } if(wNeedsAppend && weapons.children().length > 0) { weapons.appendTo('div#storesContainer'); weapons.animate({opacity: 1}, 300, 'linear'); } if(newRow) { Room.updateIncomeView(); } if($(\"div#outsidePanel\").length) { Outside.updateVillage(); } }, updateIncomeView: function() { var stores = $('div#stores'); if(stores.length == 0 || typeof $SM.get('income') == 'undefined') return; $('div.storeRow', stores).each(function(index, el) { el = $(el); $('div.tooltip', el).remove(); var tt = $('').addClass('tooltip bottom right'); var storeName = el.attr('id').substring(4).replace('-', ' '); for(var incomeSource in $SM.get('income')) { var income = $SM.get('income[\"'+incomeSource+'\"]'); for(var store in income.stores) { if(store == storeName && income.stores[store] != 0) { $('').addClass('row_key').text(incomeSource).appendTo(tt); $('') .addClass('row_val') .text(Engine.getIncomeMsg(income.stores[store], income.delay)) .appendTo(tt); } } } if(tt.children().length > 0) { tt.appendTo(el); } }); }, buy: function(buyBtn) { var thing = $(buyBtn).attr('buildThing'); var good = Room.TradeGoods[thing]; var numThings = $SM.get('stores[\"'+thing+'\"]', true); if(numThings < 0) numThings = 0; if(good.maximum 0) { craftSection.appendTo('div#roomPanel').animate({opacity: 1}, 300, 'linear'); } if(bNeedsAppend && buildSection.children().length > 0) { buySection.appendTo('div#roomPanel').animate({opacity: 1}, 300, 'linear'); } }, handleStateUpdates: function(e){ if(e.category == 'stores'){ Room.updateStoresView(); Room.updateBuildButtons(); } else if(e.category == 'income'){ Room.updateStoresView(); Room.updateIncomeView(); } else if(e.stateName.indexOf('game.buildings') == 0){ Room.updateBuildButtons(); } } };"},{"title":"","date":"2022-02-05T07:40:23.078Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/script/world.js","permalink":"http://www.rainend.org/A-Dark-Room/script/world.js","excerpt":"","text":"var World = { RADIUS: 30, VILLAGE_POS: [30, 30], TILE: { VILLAGE: 'A', IRON_MINE: 'I', COAL_MINE: 'C', SULPHUR_MINE: 'S', FOREST: ';', FIELD: ',', BARRENS: '.', ROAD: '#', HOUSE: 'H', CAVE: 'V', TOWN: 'O', CITY: 'Y', OUTPOST: 'P', SHIP: 'W', BOREHOLE: 'B', BATTLEFIELD: 'F', SWAMP: 'M', CACHE: 'U' }, TILE_PROBS: {}, LANDMARKS: {}, STICKINESS: 0.5, // 0"},{"title":"","date":"2022-02-05T07:40:23.070Z","updated":"2015-05-11T09:19:25.000Z","comments":true,"path":"A-Dark-Room/script/events/setpieces.js","permalink":"http://www.rainend.org/A-Dark-Room/script/events/setpieces.js","excerpt":"","text":"/** * Events that only occur at specific times. Launched manually. **/ Events.Setpieces = { \"哨站\": { /* Friendly Outpost */ title: '一个前哨战(友善)', scenes: { 'start': { text: [ '一个庇护所.' ], notification: '一个野外的庇护所.', loot: { '腌肉': { min: 5, max: 10, chance: 1 } }, onLoad: function() { World.useOutpost(); }, buttons: { 'leave': { text: '离开', nextScene: 'end' } } } } }, \"沼泽\": { /* Swamp */ title: '一个烟雾迷茫的沼泽', scenes: { 'start': { text: [ '腐烂的芦苇漂浮在沼泽上.', '一个孤单的青蛙静静的蹲坐在淤泥上.' ], notification: '污浊溃烂的气息弥漫在空气中.', buttons: { 'enter': { text: '进入', nextScene: {1: 'cabin'} }, 'leave': { text: '离开', nextScene: 'end' } } }, 'cabin': { text: [ '沼泽深处有一个覆满苔藓的小屋.', '一个年老的流浪汉在里面, 看似精神恍惚.' ], buttons: { 'talk': { cost: {'护身符': 1}, text: '对话', nextScene: {1: 'talk'} }, 'leave': { text: '离开', nextScene: 'end' } } }, 'talk': { text: [ '流浪者点头拿过了护身符.', '他说有一次带领着一个大团队抵达了一个新世界.', '但是未知事物带来的破坏毁灭了那个团队, 剩余的人忍饥挨饿痛苦异常.', '现在轮到他了, 流落在这里深深的忏悔....' ], onLoad: function() { $SM.addPerk('九阳神功'); World.markVisited(World.curPos[0], World.curPos[1]); }, buttons: { 'leave': { text: '离开', nextScene: 'end' } } } } }, \"洞穴\": { /* Cave */ title: '一个潮湿的洞穴', scenes: { 'start': { text: [ '洞穴的入口宽而深.', \"无法看清内部的清醒.\" ], notification: '这里的地面到处都是裂痕, 就好像一条条古老的大地伤痕', buttons: { 'enter': { text: '进入一探', cost: { '火炬': 1 }, //tim mark in case of bug nextScene: {0.3: 'a1', 0.6: 'a2', 1: 'a3'} }, 'leave': { text: '离开', nextScene: 'end' } } }, 'a1': { combat: true, enemy: '野兽', chara: 'B', damage: 1, hit: 0.8, attackDelay: 1, health: 5, notification: '一头受惊的野兽正要捍卫自己的巢穴', loot: { '毛皮': { min: 1, max: 10, chance: 1 }, '牙齿': { min: 1, max: 5, chance: 0.8 } }, buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'b1', 1: 'b2'} }, 'leave': { text: '离开洞穴', nextScene: 'end' } } }, 'a2': { text: [ '洞穴已经小的没有落脚之地了.', \"墙壁很潮湿并覆满了苔藓\" ], buttons: { 'continue': { text: '挤进去', nextScene: {0.5: 'b2', 1: 'b3'} }, 'leave': { text: '离开洞穴', nextScene: 'end' } } }, 'a3': { text: [ '一个老旧的营地呈现在你面前.', '灰黑的睡袋被褥都撕裂开了, 布满了灰尘.' ], loot: { '腌肉': { min: 1, max: 5, chance: 1 }, '火炬': { min: 1, max: 5, chance: 0.5 }, '皮革': { min: 1, max: 5, chance: 0.3 } }, buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'b3', 1: 'b4'} }, 'leave': { text: '离开洞穴', nextScene: 'end' } } }, 'b1': { text: [ '一个流浪者的尸体躺在一个小穴里面.', \"尸体高度腐烂, 一些肢体已经不见了.\", \"鬼知道还剩下些什么有用东西.\" ], loot: { '铁剑': { min: 1, max: 1, chance: 1 }, '腌肉': { min: 1, max: 5, chance: 0.8 }, '火炬': { min: 1, max: 3, chance: 0.5 }, '医疗药剂': { min: 1, max: 2, chance: 0.1 } }, buttons: { 'continue': { text: '继续前进', nextScene: { 1: 'c1' } }, 'leave': { text: '离开洞穴', nextScene: 'end' } } }, 'b2': { text: [ '火炬熄灭在潮湿的空气中', '黑暗再度来袭' ], notification: '火炬熄灭了', buttons: { 'continue': { text: '继续前进', cost: {'火炬': 1}, nextScene: { 1: 'c1' } }, 'leave': { text: '离开洞穴', nextScene: 'end' } } }, 'b3': { combat: true, enemy: '野兽', chara: 'B', damage: 1, hit: 0.8, attackDelay: 1, health: 5, notification: '一个受惊的野兽正要保护它的巢穴', loot: { '毛皮': { min: 1, max: 3, chance: 1 }, '牙齿': { min: 1, max: 2, chance: 0.8 } }, buttons: { 'continue': { text: '继续前进', nextScene: {1: 'c2'} }, 'leave': { text: '离开洞穴', nextScene: 'end' } } }, 'b4': { combat: true, enemy: '洞穴蜥蜴', chara: 'L', damage: 3, hit: 0.8, attackDelay: 2, health: 6, notification: '一头洞穴蜥蜴向你攻击', loot: { '鳞片': { min: 1, max: 3, chance: 1 }, '牙齿': { min: 1, max: 2, chance: 0.8 } }, buttons: { 'continue': { text: '继续前进', nextScene: {1: 'c2'} }, 'leave': { text: '离开洞穴', nextScene: 'end' } } }, 'c1': { combat: true, enemy: '野兽', chara: 'B', damage: 3, hit: 0.8, attackDelay: 2, health: 10, notification: '一头巨大的野兽冲出黑暗', loot: { '毛皮': { min: 1, max: 3, chance: 1 }, '牙齿': { min: 1, max: 3, chance: 1 } }, buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'end1', 1: 'end2'} }, 'leave': { text: '离开洞穴', nextScene: 'end' } } }, 'c2': { combat: true, enemy: '蜥蜴', chara: 'L', damage: 4, hit: 0.8, attackDelay: 2, health: 10, notification: '一只巨大的蜥蜴躺在地上', loot: { '鳞片': { min: 1, max: 3, chance: 1 }, '牙齿': { min: 1, max: 3, chance: 1 } }, buttons: { 'continue': { text: '继续前进', nextScene: {0.7: 'end2', 1: 'end3'} }, 'leave': { text: '离开洞穴', nextScene: 'end' } } }, 'end1': { text: [ '一只大型动物的巢穴就在洞穴的后方.' ], onLoad: function() { World.clearDungeon(); }, loot: { '肉': { min: 5, max: 10, chance: 1 }, '毛皮': { min: 5, max: 10, chance: 1 }, '鳞片': { min: 5, max: 10, chance: 1 }, '牙齿': { min: 5, max: 10, chance: 1 }, '布匹': { min: 5, max: 10, chance: 0.5 } }, buttons: { 'leave': { text: '离开洞穴', nextScene: 'end' } } }, 'end2': { text: [ '一个小型供给点隐藏在洞穴后方.' ], loot: { '布匹': { min: 5, max: 10, chance: 1 }, '皮革': { min: 5, max: 10, chance: 1 }, '铁': { min: 5, max: 10, chance: 1 }, '腌肉': { min: 5, max: 10, chance: 1 }, '钢': { min: 5, max: 10, chance: 0.5 }, '链球': { min: 1, max: 3, chance: 0.3 }, '医疗药剂': { min: 1, max: 4, chance: 0.15 } }, onLoad: function() { World.clearDungeon(); }, buttons: { 'leave': { text: '离开洞穴', nextScene: 'end' } } }, 'end3': { text: [ '一个老旧的包裹嵌在石头后方, 满布灰尘.' ], loot: { '钢剑': { min: 1, max: 1, chance: 1 }, '链球': { min: 1, max: 3, chance: 0.5 }, '医疗药剂': { min: 1, max: 3, chance: 0.3 } }, onLoad: function() { World.clearDungeon(); }, buttons: { 'leave': { text: '离开洞穴', nextScene: 'end' } } } } }, \"小镇\": { /* Town */ title: '一个沙漠小镇', scenes: { 'start': { text: [ '一个小型社区坐落在前方, 房子都烧焦残破了.', \"路灯都破烂锈迹斑斑, 这个地方失去光明很旧了.\" ], notification: \"小镇废弃在前方, 里面的居民已经死了很久了\", buttons: { 'enter': { text: '探索', nextScene: {0.3: 'a1', 0.7: 'a3', 1: 'a2'} }, 'leave': { text: '离开', nextScene: 'end' } } }, 'a1': { text: [ \"学校房屋的玻璃窗都没有碎掉, 但是都被熏黑了.\", '大门吱吱不停的摇曳在残风中.' ], buttons: { 'enter': { text: '进入', nextScene: {0.5: 'b1', 1: 'b2'}, cost: {'火炬': 1} //tim tag in case of bug }, 'leave': { text: '离开小镇', nextScene: 'end' } } }, 'a2': { combat: true, enemy: '暴徒', chara: 'T', damage: 4, hit: 0.8, attackDelay: 2, health: 30, loot: { '布匹': { min: 5, max: 10, chance: 0.8 }, '皮革': { min: 5, max: 10, chance: 0.8 }, '腌肉': { min: 1, max: 5, chance: 0.5 } }, notification: '街头有埋伏.', buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'b3', 1: 'b4'} }, 'leave': { text: '离开小镇', nextScene: 'end' } } }, 'a3': { text: [ \"前方有一坐建筑物.\", '在肮脏的窗子后面有一个绿十字.' ], buttons: { 'enter': { text: '进入', nextScene: {0.5: 'b5', 1: 'end5'}, cost: {'火炬': 1} //tim mark, in case of bug }, 'leave': { text: '离开小镇', nextScene: 'end' } } }, 'b1': { text: [ '生锈的锁柜里面有一些供给品.' ], loot: { '腌肉': { min: 1, max: 5, chance: 1 }, '火炬': { min: 1, max: 3, chance: 0.8 }, '子弹': { min: 1, max: 5, chance: 0.3 }, '医疗药剂': { min: 1, max: 3, chance: 0.05 } }, buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'c1', 1: 'c2'} }, 'leave': { text: '离开小镇', nextScene: 'end' } } }, 'b2': { combat: true, enemy: '清道夫', chara: 'S', damage: 4, hit: 0.8, attackDelay: 2, health: 30, loot: { '布匹': { min: 5, max: 10, chance: 0.8 }, '皮革': { min: 5, max: 10, chance: 0.8 }, '腌肉': { min: 1, max: 5, chance: 0.5 } }, notification: '一个清道夫就在门里面.', buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'c2', 1: 'c3'} }, 'leave': { text: '离开小镇', nextScene: 'end' } } }, 'b3': { combat: true, enemy: '野兽', chara: 'B', damage: 3, hit: 0.8, attackDelay: 1, health: 25, loot: { '牙齿': { min: 1, max: 5, chance: 1 }, '毛皮': { min: 5, max: 10, chance: 1 } }, notification: '有一头野兽坐在杂草丛生的公园内.', buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'c4', 1: 'c5'} }, 'leave': { text: '离开小镇', nextScene: 'end' } } }, 'b4': { text: [ '一个撞翻的大篷车中的物件洒落在整个街道.', \"拾荒者已经扫荡过一遍了, 但是应该还找得到一些有用的东西.\" ], loot: { '腌肉': { min: 1, max: 5, chance: 0.8 }, '火炬': { min: 1, max: 3, chance: 0.5 }, '子弹': { min: 1, max: 5, chance: 0.3 }, '医疗药剂': { min: 1, max: 3, chance: 0.1 } }, buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'c5', 1: 'c6' } }, 'leave': { text: '离开小镇', nextScene: 'end' } } }, 'b5': { combat: true, enemy: '疯徒', chara: 'M', damage: 6, hit: 0.3, attackDelay: 1, health: 10, loot: { '布匹': { min: 2, max: 4, chance: 0.3 }, '腌肉': { min: 1, max: 5, chance: 0.9 }, '医疗药剂': { min: 1, max: 2, chance: 0.4 } }, notification: '一个疯子尖叫着攻击你.', buttons: { 'continue': { text: '继续前进', nextScene: {0.3: 'end5', 1: 'end6'} }, 'leave': { text: '离开小镇', nextScene: 'end' } } }, 'c1': { combat: true, enemy: '暴徒', chara: 'T', damage: 4, hit: 0.8, attackDelay: 2, health: 30, loot: { '布匹': { min: 5, max: 10, chance: 0.8 }, '皮革': { min: 5, max: 10, chance: 0.8 }, '腌肉': { min: 1, max: 5, chance: 0.5 } }, notification: '一个暴徒走出了阴影.', buttons: { 'continue': { text: '继续前进', nextScene: {1: 'd1'} }, 'leave': { text: '离开小镇', nextScene: 'end' } } }, 'c2': { combat: true, enemy: '野兽', chara: 'B', damage: 3, hit: 0.8, attackDelay: 1, health: 25, loot: { '牙齿': { min: 1, max: 5, chance: 1 }, '毛皮': { min: 5, max: 10, chance: 1 } }, notification: '一头野兽冲突了已经空荡荡的教室.', buttons: { 'continue': { text: '继续前进', nextScene: {1: 'd1'} }, 'leave': { text: '离开小镇', nextScene: 'end' } } }, 'c3': { text: [ '在通过体育馆大门的时候, 脚步声清晰可闻.', '火炬照亮了走廊.', '脚步声停了下来.' ], buttons: { 'continue': { text: '进入', nextScene: {1: 'd1'} }, 'leave': { text: '离开小镇', nextScene: 'end' } } }, 'c4': { combat: true, enemy: '野兽', chara: 'B', damage: 4, hit: 0.8, attackDelay: 1, health: 25, loot: { '牙齿': { min: 1, max: 5, chance: 1 }, '毛皮': { min: 5, max: 10, chance: 1 } }, notification: '通过噪声可以感觉到另外一头野兽, 在树林里面.', buttons: { 'continue': { text: '继续前进', nextScene: {1: 'd2'} }, 'leave': { text: '离开小镇', nextScene: 'end' } } }, 'c5': { text: [ \"有什么事情在下边的路上引起了骚动.\", \"可能是战斗.\" ], buttons: { 'continue': { text: '继续前进', nextScene: {1: 'd2'} }, 'leave': { text: '离开小镇', nextScene: 'end' } } }, 'c6': { text: [ '一个装满食物的小篮子隐藏在公园的长椅下, 上面还有个纸条.', \"看不懂写的什么.\" ], loot: { '腌肉': { min: 1, max: 5, chance: 1 } }, buttons: { 'continue': { text: '继续前进', nextScene: {1: 'd2'} }, 'leave': { text: '离开小镇', nextScene: 'end' } } }, 'd1': { combat: true, enemy: '清道夫', chara: 'S', damage: 5, hit: 0.8, attackDelay: 2, health: 30, loot: { '腌肉': { min: 1, max: 5, chance: 1 }, '皮革': { min: 5, max: 10, chance: 0.8 }, '钢剑': { min: 1, max: 1, chance: 0.5 } }, notification: '一个惊慌的清道夫尖叫着闯过了大门.', buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'end1', 1: 'end2'} }, 'leave': { text: '离开小镇', nextScene: 'end' } } }, 'd2': { combat: true, enemy: '警员', chara: 'V', damage: 6, hit: 0.8, attackDelay: 2, health: 30, loot: { '腌肉': { min: 1, max: 5, chance: 1 }, '皮革': { min: 5, max: 10, chance: 0.8 }, '钢剑': { min: 1, max: 1, chance: 0.5 } }, notification: \"一个男人站在死去的流浪汉边上, 意识到他不是唯一的人类.\", buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'end3', 1: 'end4'} }, 'leave': { text: '离开小镇', nextScene: 'end' } } }, 'end1': { text: [ '清道夫有一个小营地在学校里面.', '收集的各种垃圾散落在地面上, 就好像是从天上下下来的.' ], onLoad: function() { World.clearDungeon(); }, loot: { '钢剑': { min: 1, max: 1, chance: 1 }, '钢': { min: 5, max: 10, chance: 1 }, '腌肉': { min: 5, max: 10, chance: 1 }, '链球': { min: 1, max: 5, chance: 0.5 }, '医疗药剂': { min: 1, max: 2, chance: 0.3 } }, buttons: { 'leave': { text: '离开小镇', nextScene: 'end' } } }, 'end2': { text: [ \"清道夫似乎一直在寻找各种物资.\", \"不好意思, 我笑纳了.\" ], onLoad: function() { World.clearDungeon(); }, loot: { '煤': { min: 5, max: 10, chance: 1 }, '腌肉': { min: 5, max: 10, chance: 1 }, '皮革': { min: 5, max: 10, chance: 1 } }, buttons: { 'leave': { text: '离开小镇', nextScene: 'end' } } }, 'end3': { text: [ \"流浪汉身体下有一些东西, 手上也抓着很多, 闪闪发光.\", \"真值得一杀.\" ], onLoad: function() { World.clearDungeon(); }, loot: { '步枪': { min: 1, max: 1, chance: 1 }, '子弹': { min: 1, max: 5, chance: 1 } }, buttons: { 'leave': { text: '离开小镇', nextScene: 'end' } } }, 'end4': { text: [ \"以牙还牙相当公平.\", \"无往而不利.\", \"骨头捡起来之后发现了一些小东西.\" ], onLoad: function() { World.clearDungeon(); }, loot: { '腌肉': { min: 5, max: 10, chance: 1 }, '铁': { min: 5, max: 10, chance: 1 }, '火炬': { min: 1, max: 5, chance: 1 }, '链球': { min: 1, max: 5, chance: 0.5 }, '医疗药剂': { min: 1, max: 2, chance: 0.1 } }, buttons: { 'leave': { text: '离开小镇', nextScene: 'end' } } }, 'end5': { text: [ '抽屉里面有一些治疗药剂.' ], onLoad: function() { World.clearDungeon(); }, loot: { '医疗药剂': { min: 2, max: 5, chance: 1 } }, buttons: { 'leave': { text: '离开小镇', nextScene: 'end' } } }, 'end6': { text: [ '诊所已经被洗劫一空.', '只有污浊的尘土依旧.' ], onLoad: function() { World.clearDungeon(); }, buttons: { 'leave': { text: '离开小镇', nextScene: 'end' } } } } }, \"城镇\": { /* City */ title: '一座诅咒之城', scenes: { 'start': { text: [ '一个可怜的高速公路标志坐落在这座曾经的大城市的入口.', \"曾经壮观的高塔就好比是野兽的身体突出部位一般诡异.\", '可能有一些有用的东西在里面.' ], notification: \"一个破损的高塔指向天际\", buttons: { 'enter': { text: '探索', nextScene: {0.2: 'a1', 0.5: 'a2', 0.8: 'a3', 1: 'a4'} }, 'leave': { text: '离开', nextScene: 'end' } } }, 'a1': { text:[ '街道都是空的.', '空气飘满了灰尘, 任凭风吹雨打.' ], buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'b1', 1: 'b2'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'a2': { text:[ '橙色的交通警示标记平方在街道上, 不过都破烂得不行了.', '灯光闪烁在建筑的缝隙中.' ], buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'b3', 1: 'b4'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'a3': { text: [ '一直巨大的棚屋延绵穿过了街区.', '一张张灰黑布满血迹的脸从小破屋里面伸出来.' ], buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'b5', 1: 'b6'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'a4': { text: [ '一个废弃的医院坐落在前方.' ], buttons: { 'enter': { text: '进入', cost: { '火炬': 1 }, nextScene: {0.5: 'b7', 1: 'b8'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'b1': { text: [ '塔的内部似乎保存完整.', '烧烂的汽车壳子挡住了入口.', '大多数的落地窗户被捣毁了.' ], buttons: { 'enter': { text: '进入', nextScene: {0.5: 'c1', 1: 'c2'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'b2': { combat: true, notification: '一个巨大的蜥蜴打破了老地铁站的宁静.', enemy: '蜥蜴', chara: 'L', damage: 5, hit: 0.8, attackDelay: 2, health: 20, loot: { '鳞片': { min: 5, max: 10, chance: 0.8 }, '牙齿': { min: 5, max: 10, chance: 0.5 }, '肉': { min: 5, max: 10, chance: 0.8 } }, buttons: { 'descend': { text: '拜访', nextScene: {0.5: 'c2', 1: 'c3'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'b3': { notification: '枪响在街道上产生回声.', combat: true, enemy: '狙击手', chara: 'S', damage: 15, hit: 0.8, attackDelay: 4, health: 30, ranged: true, loot: { '腌肉': { min: 1, max: 5, chance: 0.8 }, '子弹': { min: 1, max: 5, chance: 0.5 }, '步枪': { min: 1, max: 1, chance: 0.2 } }, buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'c4', 1: 'c5'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'b4': { notification: '士兵在建筑之间战斗, 奔跑和射击.', combat: true, enemy: '士兵', ranged: true, chara: 'D', damage: 8, hit: 0.8, attackDelay: 2, health: 50, loot: { '腌肉': { min: 1, max: 5, chance: 0.8 }, '子弹': { min: 1, max: 5, chance: 0.5 }, '步枪': { min: 1, max: 1, chance: 0.2 } }, buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'c5', 1: 'c6'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'b5': { notification: '一个看上去挺斯文的人挡住去路并挑衅.', combat: true, enemy: '斯文禽兽', chara: 'M', damage: 1, hit: 0.8, attackDelay: 2, health: 10, loot: { '腌肉': { min: 1, max: 5, chance: 0.8 }, '布匹': { min: 1, max: 5, chance: 0.5 }, '皮革': { min: 1, max: 1, chance: 0.2 }, '医疗药剂': { min: 1, max: 3, chance: 0.05 } }, buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'c7', 1: 'c8'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'b6': { text: [ '除了低垂的眼帘.', '这个人很旧以前就被杀死了.' ], buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'c8', 1: 'c9'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'b7': { text: [ '空荡的走廊.', '清道夫已经把这搜刮干净了.' ], buttons: { 'continue': { text: '继续前进', nextScene: {0.3: 'c12', 0.7: 'c10', 1: 'c11'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'b8': { notification: '一个老人挥舞着手术刀冲了过来.', combat: true, enemy: '老家伙', chara: 'M', damage: 3, hit: 0.5, attackDelay: 2, health: 10, loot: { '腌肉': { min: 1, max: 3, chance: 0.5 }, '布匹': { min: 1, max: 5, chance: 0.8 }, '医疗药剂': { min: 1, max: 2, chance: 0.5 } }, buttons: { 'continue': { text: '继续前进', nextScene: {0.3: 'c13', 0.7: 'c11', 1: 'end15'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'c1': { notification: '一个暴徒等在另外一边墙那.', combat: true, enemy: '暴徒', chara: 'T', damage: 3, hit: 0.8, attackDelay: 2, health: 30, loot: { '钢剑': { min: 1, max: 1, chance: 0.5 }, '腌肉': { min: 1, max: 3, chance: 0.5 }, '布匹': { min: 1, max: 5, chance: 0.8 } }, buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'd1', 1: 'd2'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'c2': { notification: '一头咆哮着的野兽从车后面跳出来.', combat: true, enemy: '野兽', chara: 'B', damage: 2, hit: 0.8, attackDelay: 1, health: 30, loot: { '肉': { min: 1, max: 5, chance: 0.8 }, '毛皮': { min: 1, max: 5, chance: 0.8 }, '牙齿': { min: 1, max: 5, chance: 0.5 } }, buttons: { 'continue': { text: '继续前进', nextScene: {1: 'd2'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'c3': { text: [ '地铁站上方的街道已经被摧毁了.', '一些光线照射到阴霾的尘土中.', '前方传来一些声响.' ], buttons: { 'enter': { text: '调查', cost: { '火炬': 1 }, nextScene: {0.5: 'd2', 1: 'd3'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'c4': { text: [ '好像前方有一个营地.', '生锈的链条东拉西扯的.', '大火灾庭院前燃烧.' ], buttons: { 'enter': { text: '继续前进', nextScene: {0.5: 'd4', 1: 'd5'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'c5': { text: [ '前方传来更多的声响.', '肯定有什么事情发生了.' ], buttons: { 'enter': { text: '继续前进', nextScene: {1: 'd5'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'c6': { text: [ '风中传来枪响.', '前方街道闪光连连.' ], buttons: { 'enter': { text: '继续前进', nextScene: {0.5: 'd5', 1: 'd6'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'c7': { text: [ '越来越多的人挤过来了.', '有人扔出一块石头.' ], buttons: { 'enter': { text: '继续前进', nextScene: {0.5: 'd7', 1: 'd8'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'c8': { text: [ '一个简易车间被安置在路边.', '店主坚强的站在边上.' ], loot: { '钢剑': { min: 1, max: 1, chance: 0.8 }, '步枪': { min: 1, max: 1, chance: 0.5 }, '子弹': { min: 1, max: 8, chance: 0.25 }, '外星合金': { min: 1, max: 1, chance: 0.01 }, '医疗药剂': { min: 1, max: 4, chance: 0.5 } }, buttons: { 'enter': { text: '继续前进', nextScene: {1: 'd8'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'c9': { text: [ '很多肉条晒在路边.', '人们纷纷后退, 躲闪着眼光.' ], loot: { '腌肉': { min: 5, max: 10, chance: 1 } }, buttons: { 'enter': { text: '继续前进', nextScene: {0.5: 'd8', 1: 'd9'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'c10': { text: [ '有人反锁了手术室的门.' ], buttons: { 'enter': { text: '继续前进', nextScene: {0.2: 'end12', 0.6: 'd10', 1: 'd11'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'c11': { notification: '老人们的蜗居就在这间病房.', combat: true, enemy: '一群难民', plural: true, chara: 'SSS', damage: 2, hit: 0.7, attackDelay: 0.5, health: 40, loot: { '腌肉': { min: 1, max: 3, chance: 0.5 }, '布匹': { min: 3, max: 8, chance: 0.8 }, '医疗药剂': { min: 1, max: 3, chance: 0.3 } }, buttons: { 'continue': { text: '继续前进', nextScene: { 1: 'end10' } }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'c12': { notification: '一群蜥蜴在角落里.', combat: true, enemy: '一群蜥蜴', plural: true, chara: 'LLL', damage: 4, hit: 0.7, attackDelay: 0.7, health: 30, loot: { '肉': { min: 3, max: 8, chance: 1 }, '牙齿': { min: 2, max: 4, chance: 1 }, '鳞片': { min: 3, max: 5, chance: 1 } }, buttons: { 'continue': { text: '继续前进', nextScene: { 1: 'end10' } }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'c13': { text: [ '肉条挂在房间里面风干.' ], loot: { '腌肉': { min: 3, max: 10, chance: 1 } }, buttons: { 'continue': { text: '继续前进', nextScene: { 0.5: 'end10', 1: 'end11' } }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'd1': { notification: '楼梯尽头有一个巨大的鸟巢.', combat: true, enemy: '怪鸟', chara: 'B', damage: 5, hit: 0.7, attackDelay: 1, health: 45, loot: { '肉': { min: 5, max: 10, chance: 0.8 } }, buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'end1', 1: 'end2'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'd2': { text: [ \"这里碎片密布.\", \"可能在碎片中会有一些有用的东西.\" ], loot: { '子弹': { min: 1, max: 5, chance: 0.5 }, '钢': { min: 1, max: 10, chance: 0.8 }, '外星合金': { min: 1, max: 1, chance: 0.01 }, '布匹': { min: 1, max: 10, chance: 1 } }, buttons: { 'continue': { text: '继续前进', nextScene: {1: 'end2'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'd3': { notification: '一大群老鼠冲入隧道.', combat: true, enemy: '一群老鼠', plural: true, chara: 'RRR', damage: 1, hit: 0.8, attackDelay: 0.25, health: 60, loot: { '毛皮': { min: 5, max: 10, chance: 0.8 }, '牙齿': { min: 5, max: 10, chance: 0.5 } }, buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'end2', 1: 'end3'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'd4': { notification: '一个高大的男人挥舞着刺刀进行攻击.', combat: true, enemy: '老兵', chara: 'V', damage: 3, hit: 0.8, attackDelay: 2, health: 45, loot: { '刺刀': { min: 1, max: 1, chance: 0.5 }, '腌肉': { min: 1, max: 5, chance: 0.8 } }, buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'end4', 1: 'end5'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'd5': { notification: '第二个士兵开火了.', combat: true, enemy: '士兵', ranged: true, chara: 'D', damage: 8, hit: 0.8, attackDelay: 2, health: 50, loot: { '腌肉': { min: 1, max: 5, chance: 0.8 }, '子弹': { min: 1, max: 5, chance: 0.5 }, '步枪': { min: 1, max: 1, chance: 0.2 } }, buttons: { 'continue': { text: '继续前进', nextScene: {1: 'end5'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'd6': { notification: '一个蒙面士兵持枪站在角落', combat: true, enemy: '民兵', chara: 'C', ranged: true, damage: 3, hit: 0.9, attackDelay: 2, health: 55, loot: { '步枪': { min: 1, max: 1, chance: 0.5 }, '子弹': { min: 1, max: 5, chance: 0.8 }, '腌肉': { min: 1, max: 5, chance: 0.8 } }, buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'end5', 1: 'end6'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'd7': { notification: '人群涌动.', combat: true, enemy: '一群难民', plural: true, chara: 'SSS', damage: 2, hit: 0.7, attackDelay: 0.5, health: 40, loot: { '布匹': { min: 1, max: 5, chance: 0.8 }, '牙齿': { min: 1, max: 5, chance: 0.5 } }, buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'end7', 1: 'end8'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'd8': { notification: '小年轻拿了根树枝就跳出来了.', combat: true, enemy: '洗剪吹', chara: 'Y', damage: 2, hit: 0.7, attackDelay: 1, health: 45, loot: { '布匹': { min: 1, max: 5, chance: 0.8 }, '牙齿': { min: 1, max: 5, chance: 0.5 } }, buttons: { 'continue': { text: '继续前进', nextScene: {1: 'end8'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'd9': { notification: '有个人坚守在小木屋的门口.', combat: true, enemy: '难民', chara: 'S', damage: 3, hit: 0.8, attackDelay: 2, health: 20, loot: { '布匹': { min: 1, max: 5, chance: 0.8 }, '牙齿': { min: 1, max: 5, chance: 0.5 } }, buttons: { 'continue': { text: '继续前进', nextScene: {0.5: 'end8', 1: 'end9'} }, 'leave': { text: '离开城市', nextScene: 'end' } } }, 'd10': { notification: '在门后的一个畸形人进行攻击.', combat: true, enemy: '畸形人', chara: 'D', damage: 8, hit: 0.6, attackDelay: 2, health: 40, loot: { '布匹': { min: 1, max: 5, chance: 0.8 }, '牙齿': { min: 2, max: 2, chance: 1 }, '钢': { min: 1, max: 3, chance: 0.6 }, '鳞片': { min: 2, max: 3, chance: 0.1 } }, buttons: { 'continue': { text: '继续前进', nextScene: {1: 'end14'} } } }, 'd11': { notification: '门只要开了一点, 几百个触手就涌过来.', combat: true, enemy: '满天触手', plural: true, chara: 'TTT', damage: 2, hit: 0.6, attackDelay: 0.5, health: 60, loot: { '肉': { min: 10, max: 20, chance: 1 } }, buttons: { 'continue': { text: '继续前进', nextScene: {1: 'end13'} } } }, 'end1': { text: [ '鸟儿都喜欢闪亮的东西.', '它们的巢里面经常有好东西.' ], onLoad: function() { World.clearDungeon(); $SM.set('game.cityCleared', true); }, loot: { '子弹': { min: 5, max: 10, chance: 0.8 }, '链球': { min: 1, max: 5, chance: 0.5 }, '外星合金': { min: 1, max: 1, chance: 0.5 } }, buttons: { 'leave': { text: '离开城市', nextScene: 'end' } } }, 'end2': { text: [ '没什么东西了.', '清道夫已经来过这里了.' ], onLoad: function() { World.clearDungeon(); $SM.set('game.cityCleared', true); }, loot: { '火炬': { //tim mark, incase of bug min: 1, max: 5, chance: 0.8 }, '腌肉': { min: 1, max: 5, chance: 0.5 } }, buttons: { 'leave': { text: '离开城市', nextScene: 'end' } } }, 'end3': { text: [ '隧道通向一个平台.', '残破的墙壁.', '肢体和供给散落在墙壁两旁.' ], onLoad: function() { World.clearDungeon(); $SM.set('game.cityCleared', true); }, loot: { '步枪': { min: 1, max: 1, chance: 0.8 }, '子弹': { min: 1, max: 5, chance: 0.8 }, '镭射枪': { min: 1, max: 1, chance: 0.3 }, '燃料电池': { min: 1, max: 5, chance: 0.3 }, '外星合金': { min: 1, max: 1, chance: 0.3 } }, buttons: { 'leave': { text: '离开城市', nextScene: 'end' } } }, 'end4': { text: [ '小型军事哨站补给充分.', '武器弹药整理的排列在储藏室的地上.', '跟以往一样的致命.' ], onLoad: function() { World.clearDungeon(); $SM.set('game.cityCleared', true); }, loot: { '步枪': { min: 1, max: 1, chance: 1 }, '子弹': { min: 1, max: 10, chance: 1 }, '手雷': { min: 1, max: 5, chance: 0.8 } }, buttons: { 'leave': { text: '离开城市', nextScene: 'end' } } }, 'end5': { text: [ '搜索尸体会得到一些物资.', '路上会遇到更多的尸体的.', '该离开了.' ], onLoad: function() { World.clearDungeon(); $SM.set('game.cityCleared', true); }, loot: { '步枪': { min: 1, max: 1, chance: 1 }, '子弹': { min: 1, max: 10, chance: 1 }, '腌肉': { min: 1, max: 5, chance: 0.8 }, '医疗药剂': { min: 1, max: 4, chance: 0.1 } }, buttons: { 'leave': { text: '离开城市', nextScene: 'end' } } }, 'end6': { text: [ '小型定居点已经烧了一阵子了.', '透过火焰仍可看到在燃烧的尸体.', \"还有时间取得一些物资.\" ], onLoad: function() { World.clearDungeon(); $SM.set('game.cityCleared', true); }, loot: { '镭射枪': { min: 1, max: 1, chance: 0.5 }, '燃料电池': { min: 1, max: 5, chance: 0.5 }, '腌肉': { min: 1, max: 10, chance: 1 } }, buttons: { 'leave': { text: '离开城市', nextScene: 'end' } } }, 'end7': { text: [ '剩下的居民四处逃逸, 他们的物资都被抛下了.', \"还能找到一些有用的东西, 虽然不多.\" ], onLoad: function() { World.clearDungeon(); $SM.set('game.cityCleared', true); }, loot: { '钢剑': { min: 1, max: 1, chance: 0.8 }, '燃料电池': { min: 1, max: 5, chance: 0.5 }, '腌肉': { min: 1, max: 10, chance: 1 } }, buttons: { 'leave': { text: '离开城市', nextScene: 'end' } } }, 'end8': { text: [ '那个年轻的居民背着的是帆布包.', \"里面有一些旅行用品和几个装饰品\", \"没别的了.\" ], onLoad: function() { World.clearDungeon(); $SM.set('game.cityCleared', true); }, loot: { '钢剑': { min: 1, max: 1, chance: 0.8 }, '链球': { min: 1, max: 5, chance: 0.5 }, '腌肉': { min: 1, max: 10, chance: 1 } }, buttons: { 'leave': { text: '离开城市', nextScene: 'end' } } }, 'end9': { text: [ '小木屋内, 一个孩子在哭.', \"有几个行李靠在墙边.\", \"没有东西了.\" ], onLoad: function() { World.clearDungeon(); $SM.set('game.cityCleared', true); }, loot: { '步枪': { min: 1, max: 1, chance: 0.8 }, '子弹': { min: 1, max: 5, chance: 0.8 }, '链球': { min: 1, max: 5, chance: 0.5 }, '外星合金': { min: 1, max: 1, chance: 0.2 } }, buttons: { 'leave': { text: '离开城市', nextScene: 'end' } } }, 'end10': { text: [ '腐烂和死亡的气息弥漫在手术室.', \"有一些东西散落在地上.\", '没有其他东西了.' ], onLoad: function() { World.clearDungeon(); $SM.set('game.cityCleared', true); }, loot: { '燃料电池': { min: 1, max: 1, chance: 0.3 }, '医疗药剂': { min: 1, max: 5, chance: 0.3 }, '牙齿': { min: 3, max: 8, chance: 1 }, '鳞片': { min: 4, max: 7, chance: 0.9 } }, buttons: { 'leave': { text: '离开城市', nextScene: 'end' } } }, 'end11': { text: [ '一个朴素的药箱在走廊尽头.', \"医院里面已经没什么了.\" ], onLoad: function() { World.clearDungeon(); $SM.set('game.cityCleared', true); }, loot: { '燃料电池': { min: 1, max: 1, chance: 0.2 }, '医疗药剂': { min: 3, max: 10, chance: 1 }, '牙齿': { min: 1, max: 2, chance: 0.2 } }, buttons: { 'leave': { text: '离开城市', nextScene: 'end' } } }, 'end12': { text: [ '肯定有人一直储备东西在这里.' ], onLoad: function() { World.clearDungeon(); $SM.set('game.cityCleared', true); }, loot: { '燃料电池': { min: 1, max: 3, chance: 0.2 }, '医疗药剂': { min: 3, max: 10, chance: 0.5 }, '子弹': { min: 2, max: 8, chance: 1 }, '火炬': { min: 1, max: 3, chance: 0.5 }, '手雷': { min: 1, max: 1, chance: 0.5 }, '外星合金': { min: 1, max: 2, chance: 0.8 } }, buttons: { 'leave': { text: '离开城市', nextScene: 'end' } } }, 'end13': { text: [ '恐怖触手被几百了.', '里面到处都是遇难者的尸体.' ], onLoad: function() { World.clearDungeon(); $SM.set('game.cityCleared', true); }, loot: { '钢剑': { min: 1, max: 3, chance: 0.5 }, '步枪': { min: 1, max: 2, chance: 0.3 }, '牙齿': { min: 2, max: 8, chance: 1 }, '布匹': { min: 3, max: 6, chance: 0.5 }, '外星合金': { min: 1, max: 1, chance: 0.1 } }, buttons: { 'leave': { text: '离开城市', nextScene: 'end' } } }, 'end14': { text: [ '扭曲的男人死了.', '手术室有很多奇怪的设备.' ], onLoad: function() { World.clearDungeon(); $SM.set('game.cityCleared', true); }, loot: { '燃料电池': { min: 2, max: 5, chance: 0.8 }, '医疗药剂': { min: 3, max: 12, chance: 1 }, '布匹': { min: 1, max: 3, chance: 0.5 }, '钢': { min: 2, max: 3, chance: 0.3 }, '外星合金': { min: 1, max: 1, chance: 0.3 } }, buttons: { 'leave': { text: '离开城市', nextScene: 'end' } } }, 'end15': { text: [ '这个老人有一些有趣的小收藏.' ], onLoad: function() { World.clearDungeon(); $SM.set('game.cityCleared', true); }, loot: { '外星合金': { min: 1, max: 1, chance: 0.8 }, '医疗药剂': { min: 1, max: 4, chance: 1 }, '腌肉': { min: 3, max: 7, chance: 1 }, '链球': { min: 1, max: 3, chance: 0.5 }, '毛皮': { min: 1, max: 5, chance: 0.8 } }, buttons: { 'leave': { text: '离开城市', nextScene: 'end' } } } } }, \"废屋\": { /* Abandoned House */ title: '一所老房子', scenes: { 'start': { text: [ '一所老房子依旧留存着, 白色的外墙泛黄脱落.', '门开着.' ], notification: '老房子好比是一座对时代的纪念碑一般', buttons: { 'enter': { text: '进入一探', nextScene: { 0.25: 'medicine', 0.5: 'supplies', 1: 'occupied' } }, 'leave': { text: '离开', nextScene: 'end' } } }, 'supplies': { text: [ '房子虽然被废弃了, 但是还有一些东西.', '水井里面依旧有水.' ], onLoad: function() { World.markVisited(World.curPos[0], World.curPos[1]); World.setWater(World.getMaxWater()); Notifications.notify(null, '水满了'); }, loot: { '腌肉': { min: 1, max: 10, chance: 0.8 }, '皮革': { min: 1, max: 10, chance: 0.2 }, '布匹': { min: 1, max: 10, chance: 0.5 } }, buttons: { 'leave': { text: '离开', nextScene: 'end' } } }, 'medicine': { text: [ '房子已经被洗劫一空了.', '但是地板下面还有一些医疗用品.' ], onLoad: function() { World.markVisited(World.curPos[0], World.curPos[1]); }, loot: { '医疗药剂': { min: 2, max: 5, chance: 1 } }, buttons: { 'leave': { text: '离开', nextScene: 'end' } } }, 'occupied': { combat: true, enemy: '难民', chara: 'S', damage: 3, hit: 0.8, attackDelay: 2, health: 10, notification: '一个男人占据着大厅, 手持大刀', onLoad: function() { World.markVisited(World.curPos[0], World.curPos[1]); }, loot: { '腌肉': { min: 1, max: 10, chance: 0.8 }, '皮革': { min: 1, max: 10, chance: 0.2 }, '布匹': { min: 1, max: 10, chance: 0.5 } }, buttons: { 'leave': { text: '离开', nextScene: 'end' } } } } }, \"战场\": { /* Discovering an old battlefield */ title: '遗落战场', scenes: { 'start': { text: [ '很久以前的大战.', '双方的高科技造成了如此壮观的景象.' ], onLoad: function() { World.markVisited(World.curPos[0], World.curPos[1]); }, loot: { '步枪': { min: 1, max: 3, chance: 0.5 }, '子弹': { min: 5, max: 20, chance: 0.8 }, '镭射枪': { min: 1, max: 3, chance: 0.3 }, '燃料电池': { min: 5, max: 10, chance: 0.5 }, '手雷': { min: 1, max: 5, chance: 0.5 }, '外星合金': { min: 1, max: 1, chance: 0.3 } }, buttons: { 'leave': { text: '离开', nextScene: 'end' } } } } }, \"巨坑\": { /* Admiring a huge borehole */ title: '一个巨坑', scenes: { 'start': { text: [ '一个巨大的深坑切入地表.', '他们拿走所需, 拍拍屁股.', '通过悬崖边依旧能看清庞大的废弃场.' ], onLoad: function() { World.markVisited(World.curPos[0], World.curPos[1]); }, loot: { '外星合金': { min: 1, max: 3, chance: 1 } }, buttons: { 'leave': { text: '离开', nextScene: 'end' } } } } }, \"飞船\": { /* Finding a way off this rock */ title: '破损的飞船', scenes: { 'start': { onLoad: function() { World.markVisited(World.curPos[0], World.curPos[1]); World.drawRoad(); World.state.ship = true; }, text: [ '尘土和灰烬之下流露出熟悉的各种曲线. ', \"很幸运当地人不会机械.\", '飞船可以被修复.' ], buttons: { 'leavel': { text: '打捞', nextScene: 'end' } } } } }, \"硫磺矿\": { /* Clearing the Sulphur Mine */ title: '一座硫磺矿', scenes: { 'start': { text: [ \"军队已经驻扎在矿井入口了.\", '巡逻兵挎着步枪.' ], notification: '军队已经驻扎在矿井入口了', buttons: { 'attack': { text: '攻击', nextScene: {1: 'a1'} }, 'leave': { text: '离开', nextScene: 'end' } } }, 'a1': { combat: true, enemy: '士兵', ranged: true, chara: 'D', damage: 8, hit: 0.8, attackDelay: 2, health: 50, loot: { '腌肉': { min: 1, max: 5, chance: 0.8 }, '子弹': { min: 1, max: 5, chance: 0.5 }, '步枪': { min: 1, max: 1, chance: 0.2 } }, notification: '一个士兵发现并开火了.', buttons: { 'continue': { text: '继续前进', nextScene: { 1: 'a2' } }, 'run': { text: '逃跑', nextScene: 'end' } } }, 'a2': { combat: true, enemy: '士兵', ranged: true, chara: 'D', damage: 8, hit: 0.8, attackDelay: 2, health: 50, loot: { '腌肉': { min: 1, max: 5, chance: 0.8 }, '子弹': { min: 1, max: 5, chance: 0.5 }, '步枪': { min: 1, max: 1, chance: 0.2 } }, notification: '第二个士兵加入战斗.', buttons: { 'continue': { text: '继续前进', nextScene: { 1: 'a3' } }, 'run': { text: '逃跑', nextScene: 'end' } } }, 'a3': { combat: true, enemy: '老兵', chara: 'V', damage: 10, hit: 0.8, attackDelay: 2, health: 65, loot: { '刺刀': { min: 1, max: 1, chance: 0.5 }, '腌肉': { min: 1, max: 5, chance: 0.8 } }, notification: '一个头发花白的士兵加入战斗, 挥舞着刺刀.', buttons: { 'continue': { text: '继续前进', nextScene: { 1: 'cleared' } } } }, 'cleared': { text: [ '军队已经被清除.', '矿坑现在可以工作了.' ], notification: '硫磺矿解除危险了', onLoad: function() { World.drawRoad(); World.state.sulphurmine = true; World.markVisited(World.curPos[0], World.curPos[1]); }, buttons: { 'leave': { text: '离开', nextScene: 'end' } } } } }, \"煤矿\": { /* Clearing the Coal Mine */ title: '一座煤矿', scenes: { 'start': { text: [ '矿坑入口篝火很旺.', '有人带着武器驻守在那.' ], notification: '这座老矿坑没有被遗弃', buttons: { 'attack': { text: '攻击', nextScene: {1: 'a1'} }, 'leave': { text: '离开', nextScene: 'end' } } }, 'a1': { combat: true, enemy: '壮汉', chara: 'M', damage: 3, hit: 0.8, attackDelay: 2, health: 10, loot: { '腌肉': { min: 1, max: 5, chance: 0.8 }, '布匹': { min: 1, max: 5, chance: 0.8 } }, notification: '一个人加入战斗攻击', buttons: { 'continue': { text: '继续前进', nextScene: { 1: 'a2' } }, 'run': { text: '逃跑', nextScene: 'end' } } }, 'a2': { combat: true, enemy: '壮汉', chara: 'M', damage: 3, hit: 0.8, attackDelay: 2, health: 10, loot: { '腌肉': { min: 1, max: 5, chance: 0.8 }, '布匹': { min: 1, max: 5, chance: 0.8 } }, notification: '一个人加入战斗', buttons: { 'continue': { text: '继续前进', nextScene: { 1: 'a3' } }, 'run': { text: '逃跑', nextScene: 'end' } } }, 'a3': { combat: true, enemy: 'chief', chara: 'C', damage: 5, hit: 0.8, attackDelay: 2, health: 20, loot: { '腌肉': { min: 5, max: 10, chance: 1 }, '布匹': { min: 5, max: 10, chance: 0.8 }, '铁': { min: 1, max: 5, chance: 0.8 } }, notification: '只有老大还在.', buttons: { 'continue': { text: '继续前进', nextScene: { 1: 'cleared' } } } }, 'cleared': { text: [ '营地依旧, 还有火焰燃烧的声音.', '矿坑安全了.' ], notification: '矿坑解除危险了', onLoad: function() { World.drawRoad(); World.state.coalmine = true; World.markVisited(World.curPos[0], World.curPos[1]); }, buttons: { 'leave': { text: '离开', nextScene: 'end' } } } } }, \"铁矿\": { /* Clearing the Iron Mine */ title: '一个铁矿', scenes: { 'start': { text: [ '一个老矿坑在哪, 生锈的工具被乱丢.', '各种白骨散落一地, 上面还有深深的齿痕.', '黑暗中传来野性的咆哮.' ], notification: '通向矿坑的小路', buttons: { 'enter': { text: '进入一探', nextScene: { 1: 'enter' }, cost: { '火炬': 1 } }, 'leave': { text: '离开', nextScene: 'end' } } }, 'enter': { combat: true, enemy: '兽女', chara: 'M', damage: 4, hit: 0.8, attackDelay: 2, health: 10, loot: { '牙齿': { min: 5, max: 10, chance: 1 }, '鳞片': { min: 5, max: 10, chance: 0.8 }, '布匹': { min: 5, max: 10, chance: 0.5 } }, notification: '一个巨大的生物出现, 肌肉大到爆', buttons: { 'leave': { text: '离开', nextScene: { 1: 'cleared' } } } }, 'cleared': { text: [ '野兽死了.', '矿坑安全了.' ], notification: '矿坑解除危险了', onLoad: function() { World.drawRoad(); World.state.ironmine = true; World.markVisited(World.curPos[0], World.curPos[1]); }, buttons: { 'leave': { text: '离开', nextScene: 'end' } } } } }, \"临时\": { /* Cache - contains some of supplies from previous game */ title: '一个毁灭的村庄', scenes: { 'start': { text: [ '毁灭的村子到处都是灰尘.', '破烂的尸体到处都是.' ], notification: '被烧焦的尸体挂在空中.', buttons: { 'enter': { text: '进入', nextScene: {1: 'underground'} }, 'leave': { text: '离开', nextScene: 'end' } } }, 'underground': { text: [ '一个木屋处理在村子中心.', '里面还有一些物资.' ], buttons: { 'take': { text: '拿走', nextScene: {1: 'exit'} } } }, 'exit': { text: [ '前代人的痕迹就在这里了.', '是时候采摘果实了.' ], onLoad: function() { World.markVisited(World.curPos[0], World.curPos[1]); Prestige.collectStores(); }, buttons: { 'leave': { text: '离开', nextScene: 'end' } } } } } };"},{"title":"","date":"2022-02-11T08:50:30.399Z","updated":"2022-02-11T08:44:29.532Z","comments":true,"path":"js/valine.min.js","permalink":"http://www.rainend.org/js/valine.min.js","excerpt":"","text":"/*! * Valine v1.4.16 * (c) 2017-2021 xCss * Released under the GPL-2.0 License. * Last Update: 2021-10-19 6:07:44 ├F10: PM┤ */ !function(e,t){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define([],t):\"object\"==typeof exports?exports.Valine=t():e.Valine=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,\"a\",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p=\"\",t(t.s=119)}([function(e,t,n){\"use strict\";var r=SyntaxError,o=Function,i=TypeError,a=function(e){try{return o('\"use strict\"; return ('+e+\").constructor;\")()}catch(e){}},s=Object.getOwnPropertyDescriptor;if(s)try{s({},\"\")}catch(e){s=null}var l=function(){throw new i},c=s?function(){try{return arguments.callee,l}catch(e){try{return s(arguments,\"callee\").get}catch(e){return l}}}():l,u=n(22)(),f=Object.getPrototypeOf||function(e){return e.__proto__},p={},d=\"undefined\"==typeof Uint8Array?void 0:f(Uint8Array),h={\"%AggregateError%\":\"undefined\"==typeof AggregateError?void 0:AggregateError,\"%Array%\":Array,\"%ArrayBuffer%\":\"undefined\"==typeof ArrayBuffer?void 0:ArrayBuffer,\"%ArrayIteratorPrototype%\":u?f([][Symbol.iterator]()):void 0,\"%AsyncFromSyncIteratorPrototype%\":void 0,\"%AsyncFunction%\":p,\"%AsyncGenerator%\":p,\"%AsyncGeneratorFunction%\":p,\"%AsyncIteratorPrototype%\":p,\"%Atomics%\":\"undefined\"==typeof Atomics?void 0:Atomics,\"%BigInt%\":\"undefined\"==typeof BigInt?void 0:BigInt,\"%Boolean%\":Boolean,\"%DataView%\":\"undefined\"==typeof DataView?void 0:DataView,\"%Date%\":Date,\"%decodeURI%\":decodeURI,\"%decodeURIComponent%\":decodeURIComponent,\"%encodeURI%\":encodeURI,\"%encodeURIComponent%\":encodeURIComponent,\"%Error%\":Error,\"%eval%\":eval,\"%EvalError%\":EvalError,\"%Float32Array%\":\"undefined\"==typeof Float32Array?void 0:Float32Array,\"%Float64Array%\":\"undefined\"==typeof Float64Array?void 0:Float64Array,\"%FinalizationRegistry%\":\"undefined\"==typeof FinalizationRegistry?void 0:FinalizationRegistry,\"%Function%\":o,\"%GeneratorFunction%\":p,\"%Int8Array%\":\"undefined\"==typeof Int8Array?void 0:Int8Array,\"%Int16Array%\":\"undefined\"==typeof Int16Array?void 0:Int16Array,\"%Int32Array%\":\"undefined\"==typeof Int32Array?void 0:Int32Array,\"%isFinite%\":isFinite,\"%isNaN%\":isNaN,\"%IteratorPrototype%\":u?f(f([][Symbol.iterator]())):void 0,\"%JSON%\":\"object\"==typeof JSON?JSON:void 0,\"%Map%\":\"undefined\"==typeof Map?void 0:Map,\"%MapIteratorPrototype%\":\"undefined\"!=typeof Map&&u?f((new Map)[Symbol.iterator]()):void 0,\"%Math%\":Math,\"%Number%\":Number,\"%Object%\":Object,\"%parseFloat%\":parseFloat,\"%parseInt%\":parseInt,\"%Promise%\":\"undefined\"==typeof Promise?void 0:Promise,\"%Proxy%\":\"undefined\"==typeof Proxy?void 0:Proxy,\"%RangeError%\":RangeError,\"%ReferenceError%\":ReferenceError,\"%Reflect%\":\"undefined\"==typeof Reflect?void 0:Reflect,\"%RegExp%\":RegExp,\"%Set%\":\"undefined\"==typeof Set?void 0:Set,\"%SetIteratorPrototype%\":\"undefined\"!=typeof Set&&u?f((new Set)[Symbol.iterator]()):void 0,\"%SharedArrayBuffer%\":\"undefined\"==typeof SharedArrayBuffer?void 0:SharedArrayBuffer,\"%String%\":String,\"%StringIteratorPrototype%\":u?f(\"\"[Symbol.iterator]()):void 0,\"%Symbol%\":u?Symbol:void 0,\"%SyntaxError%\":r,\"%ThrowTypeError%\":c,\"%TypedArray%\":d,\"%TypeError%\":i,\"%Uint8Array%\":\"undefined\"==typeof Uint8Array?void 0:Uint8Array,\"%Uint8ClampedArray%\":\"undefined\"==typeof Uint8ClampedArray?void 0:Uint8ClampedArray,\"%Uint16Array%\":\"undefined\"==typeof Uint16Array?void 0:Uint16Array,\"%Uint32Array%\":\"undefined\"==typeof Uint32Array?void 0:Uint32Array,\"%URIError%\":URIError,\"%WeakMap%\":\"undefined\"==typeof WeakMap?void 0:WeakMap,\"%WeakRef%\":\"undefined\"==typeof WeakRef?void 0:WeakRef,\"%WeakSet%\":\"undefined\"==typeof WeakSet?void 0:WeakSet},v=function e(t){var n;if(\"%AsyncFunction%\"===t)n=a(\"async function () {}\");else if(\"%GeneratorFunction%\"===t)n=a(\"function* () {}\");else if(\"%AsyncGeneratorFunction%\"===t)n=a(\"async function* () {}\");else if(\"%AsyncGenerator%\"===t){var r=e(\"%AsyncGeneratorFunction%\");r&&(n=r.prototype)}else if(\"%AsyncIteratorPrototype%\"===t){var o=e(\"%AsyncGenerator%\");o&&(n=f(o.prototype))}return h[t]=n,n},g={\"%ArrayBufferPrototype%\":[\"ArrayBuffer\",\"prototype\"],\"%ArrayPrototype%\":[\"Array\",\"prototype\"],\"%ArrayProto_entries%\":[\"Array\",\"prototype\",\"entries\"],\"%ArrayProto_forEach%\":[\"Array\",\"prototype\",\"forEach\"],\"%ArrayProto_keys%\":[\"Array\",\"prototype\",\"keys\"],\"%ArrayProto_values%\":[\"Array\",\"prototype\",\"values\"],\"%AsyncFunctionPrototype%\":[\"AsyncFunction\",\"prototype\"],\"%AsyncGenerator%\":[\"AsyncGeneratorFunction\",\"prototype\"],\"%AsyncGeneratorPrototype%\":[\"AsyncGeneratorFunction\",\"prototype\",\"prototype\"],\"%BooleanPrototype%\":[\"Boolean\",\"prototype\"],\"%DataViewPrototype%\":[\"DataView\",\"prototype\"],\"%DatePrototype%\":[\"Date\",\"prototype\"],\"%ErrorPrototype%\":[\"Error\",\"prototype\"],\"%EvalErrorPrototype%\":[\"EvalError\",\"prototype\"],\"%Float32ArrayPrototype%\":[\"Float32Array\",\"prototype\"],\"%Float64ArrayPrototype%\":[\"Float64Array\",\"prototype\"],\"%FunctionPrototype%\":[\"Function\",\"prototype\"],\"%Generator%\":[\"GeneratorFunction\",\"prototype\"],\"%GeneratorPrototype%\":[\"GeneratorFunction\",\"prototype\",\"prototype\"],\"%Int8ArrayPrototype%\":[\"Int8Array\",\"prototype\"],\"%Int16ArrayPrototype%\":[\"Int16Array\",\"prototype\"],\"%Int32ArrayPrototype%\":[\"Int32Array\",\"prototype\"],\"%JSONParse%\":[\"JSON\",\"parse\"],\"%JSONStringify%\":[\"JSON\",\"stringify\"],\"%MapPrototype%\":[\"Map\",\"prototype\"],\"%NumberPrototype%\":[\"Number\",\"prototype\"],\"%ObjectPrototype%\":[\"Object\",\"prototype\"],\"%ObjProto_toString%\":[\"Object\",\"prototype\",\"toString\"],\"%ObjProto_valueOf%\":[\"Object\",\"prototype\",\"valueOf\"],\"%PromisePrototype%\":[\"Promise\",\"prototype\"],\"%PromiseProto_then%\":[\"Promise\",\"prototype\",\"then\"],\"%Promise_all%\":[\"Promise\",\"all\"],\"%Promise_reject%\":[\"Promise\",\"reject\"],\"%Promise_resolve%\":[\"Promise\",\"resolve\"],\"%RangeErrorPrototype%\":[\"RangeError\",\"prototype\"],\"%ReferenceErrorPrototype%\":[\"ReferenceError\",\"prototype\"],\"%RegExpPrototype%\":[\"RegExp\",\"prototype\"],\"%SetPrototype%\":[\"Set\",\"prototype\"],\"%SharedArrayBufferPrototype%\":[\"SharedArrayBuffer\",\"prototype\"],\"%StringPrototype%\":[\"String\",\"prototype\"],\"%SymbolPrototype%\":[\"Symbol\",\"prototype\"],\"%SyntaxErrorPrototype%\":[\"SyntaxError\",\"prototype\"],\"%TypedArrayPrototype%\":[\"TypedArray\",\"prototype\"],\"%TypeErrorPrototype%\":[\"TypeError\",\"prototype\"],\"%Uint8ArrayPrototype%\":[\"Uint8Array\",\"prototype\"],\"%Uint8ClampedArrayPrototype%\":[\"Uint8ClampedArray\",\"prototype\"],\"%Uint16ArrayPrototype%\":[\"Uint16Array\",\"prototype\"],\"%Uint32ArrayPrototype%\":[\"Uint32Array\",\"prototype\"],\"%URIErrorPrototype%\":[\"URIError\",\"prototype\"],\"%WeakMapPrototype%\":[\"WeakMap\",\"prototype\"],\"%WeakSetPrototype%\":[\"WeakSet\",\"prototype\"]},m=n(9),y=n(25),b=m.call(Function.call,Array.prototype.concat),w=m.call(Function.apply,Array.prototype.splice),x=m.call(Function.call,String.prototype.replace),k=m.call(Function.call,String.prototype.slice),S=/[^%.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|%$))/g,_=/\\\\(\\\\)?/g,A=function(e){var t=k(e,0,1),n=k(e,-1);if(\"%\"===t&&\"%\"!==n)throw new r(\"invalid intrinsic syntax, expected closing `%`\");if(\"%\"===n&&\"%\"!==t)throw new r(\"invalid intrinsic syntax, expected opening `%`\");var o=[];return x(e,S,function(e,t,n,r){o[o.length]=n?x(r,_,\"$1\"):t||e}),o},O=function(e,t){var n,o=e;if(y(g,o)&&(n=g[o],o=\"%\"+n[0]+\"%\"),y(h,o)){var a=h[o];if(a===p&&(a=v(o)),void 0===a&&!t)throw new i(\"intrinsic \"+e+\" exists, but is not available. Please file an issue!\");return{alias:n,name:o,value:a}}throw new r(\"intrinsic \"+e+\" does not exist!\")};e.exports=function(e,t){if(\"string\"!=typeof e||0===e.length)throw new i(\"intrinsic name must be a non-empty string\");if(arguments.length>1&&\"boolean\"!=typeof t)throw new i('\"allowMissing\" argument must be a boolean');var n=A(e),o=n.length>0?n[0]:\"\",a=O(\"%\"+o+\"%\",t),l=a.name,c=a.value,u=!1,f=a.alias;f&&(o=f[0],w(n,b([0,1],f)));for(var p=1,d=!0;p=n.length){var x=s(c,v);d=!!x,c=d&&\"get\"in x&&!(\"originalValue\"in x.get)?x.get:c[v]}else d=y(c,v),c=c[v];d&&!u&&(h[l]=c)}}return c}},function(e,t,n){\"use strict\";var r=n(0),o=n(4),i=o(r(\"String.prototype.indexOf\"));e.exports=function(e,t){var n=r(e,!!t);return\"function\"==typeof n&&i(e,\".prototype.\")>-1?o(n):n}},function(e,t,n){\"use strict\";var r=n(99),o=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol(\"foo\"),i=Object.prototype.toString,a=Array.prototype.concat,s=Object.defineProperty,l=function(e){return\"function\"==typeof e&&\"[object Function]\"===i.call(e)},c=s&&function(){var e={};try{s(e,\"x\",{enumerable:!1,value:e});for(var t in e)return!1;return e.x===e}catch(e){return!1}}(),u=function(e,t,n,r){(!(t in e)||l(r)&&r())&&(c?s(e,t,{configurable:!0,enumerable:!1,value:n,writable:!0}):e[t]=n)},f=function(e,t){var n=arguments.length>2?arguments[2]:{},i=r(t);o&&(i=a.call(i,Object.getOwnPropertySymbols(t)));for(var s=0;s0&&t.forEach(function(t){e.forEach(function(e){var n=e.get(\"xid\")||encodeURI(e.get(\"url\")),r=e.get(\"time\"),o=(0,S.default)(t),i=o.attr(\"id\");if((/\\%/.test(i)?i:encodeURI(i))==n){var a=o.find(\".leancloud-visitors-count\");a&&a.text(r)}})})}).catch(function(e){})}}};o.prototype.Q=function(e){var t=this,n=arguments.length,r=t.cfg.clazzName;if(1==n){var o=new AV.Query(r);o.doesNotExist(\"rid\");var i=new AV.Query(r);i.equalTo(\"rid\",\"\");var a=AV.Query.or(o,i);return\"*\"===e?a.exists(\"url\"):a.equalTo(\"url\",decodeURI(e)),a.addDescending(\"createdAt\"),a.addDescending(\"insertedAt\"),a}var s=JSON.stringify(arguments[1]).replace(/(\\[|\\])/g,\"\"),l=\"select * from \"+r+\" where rid in (\"+s+\") order by -createdAt,-createdAt\";return AV.Query.doCloudQuery(l)},o.prototype.installLocale=function(e,t){var n=this;return n.i18n(e,t),n},o.prototype.setPath=function(e){return this.config.path=e,this},o.prototype.bind=function(){var e=this,t=e.$el.find(\".vemojis\"),n=e.$el.find(\".vpreview\"),r=e.$el.find(\".vemoji-btn\"),o=e.$el.find(\".vpreview-btn\"),i=e.$el.find(\".veditor\"),a=d.default.maps,l=!1,u=function(e){var n=[];for(var r in a)a.hasOwnProperty(r)&&!!d.default.build(r)&&n.push(''+d.default.build(r)+\"\");t.html(n.join(\"\")),l=!0,t.find(\"i\").on(\"click\",function(e){e.preventDefault(),w(i[0],\" :\"+(0,S.default)(this).attr(\"title\")+\":\")})};e.$emoji={show:function(){return!l&&u(),e.$preview.hide(),t.show(),r.addClass(\"actived\"),e.$emoji},hide:function(){return r.removeClass(\"actived\"),t.hide(),e.$emoji}},e.$preview={show:function(){return T?(e.$emoji.hide(),o.addClass(\"actived\"),n.html(T).show(),P()):e.$preview.hide(),e.$preview},hide:function(){return o.removeClass(\"actived\"),n.hide().html(\"\"),e.$preview}};var f=function(t){var r=(0,A.default)(t.val()||\"\");r||e.$preview.hide(),T!=r&&(T=r,o.hasClass(\"actived\")>-1&&T!=n.html()&&n.html(T),(0,c.default)(t[0]),P())};r.on(\"click\",function(t){r.hasClass(\"actived\")?e.$emoji.hide():e.$emoji.show()}),o.on(\"click\",function(t){o.hasClass(\"actived\")?e.$preview.hide():e.$preview.show()});var p=e.cfg.meta,v={},m={veditor:\"comment\"};p.forEach(function(e){m[\"v\"+e]=e});for(var y in m)m.hasOwnProperty(y)&&function(){var t=m[y],n=e.$el.find(\".\"+y);v[t]=n,n.on(\"input change blur propertychange\",function(r){e.cfg.enableQQ&&\"blur\"===r.type&&\"nick\"===t&&(isNaN(n.val())?S.default.store.get(h.QQCacheKey)&&S.default.store.get(h.QQCacheKey).nick!=n.val()&&(S.default.store.remove(h.QQCacheKey),E.nick=n.val(),E.mail=\"\",E.QQAvatar=\"\"):(0,b.fetchQQFn)(n.val(),function(e){var t=e.nick||n.val(),r=e.qq+\"@qq.com\";(0,S.default)(\".vnick\").val(t),(0,S.default)(\".vmail\").val(r),E.nick=t,E.mail=r,E.QQAvatar=e.pic})),\"comment\"===t?f(n):E[t]=S.default.escape(n.val().replace(/(^\\s*)|(\\s*$)/g,\"\")).substring(0,40)})}();var w=function(e,t){if(document.selection){e.focus();document.selection.createRange().text=t,e.focus()}else if(e.selectionStart||\"0\"==e.selectionStart){var n=e.selectionStart,r=e.selectionEnd,o=e.scrollTop;e.value=e.value.substring(0,n)+t+e.value.substring(r,e.value.length),e.focus(),e.selectionStart=n+t.length,e.selectionEnd=n+t.length,e.scrollTop=o}else e.focus(),e.value+=t;setTimeout(function(t){f((0,S.default)(e))},100)},k={no:1,size:e.cfg.pageSize,skip:e.cfg.pageSize},_=e.$el.find(\".vpage\");_.on(\"click\",function(e){_.hide(),k.no++,O()});var O=function(){var t=k.size,n=k.no,r=Number(e.$el.find(\".vnum\").text());e.$loading.show();var o=e.Q(e.cfg.path);o.limit(t),o.skip((n-1)*t),o.find().then(function(o){if(k.skip=k.size,o&&o.length){var i=[];o.forEach(function(t){i.push(t.id),$(t,e.$el.find(\".vcards\"),!0)}),e.Q(e.cfg.path,i).then(function(e){(e&&e.results||[]).forEach(function(e){$(e,(0,S.default)('.vquote[data-self-id=\"'+e.get(\"rid\")+'\"]'))})}).catch(function(e){}),t*n0?(e.$el.find(\".vcount\").show().find(\".vnum\").text(t),O()):e.$loading.hide()}).catch(function(t){(0,x.default)(e,t,\"count\")});var $=function(t,n,r){var o=(0,S.default)(''),i=t.get(\"ua\"),a=\"\";i&&!/ja/.test(e.cfg.lang)&&(i=S.default.detect(i),a=i.os?''+i.browser+\" \"+i.version+' '+i.os+\" \"+i.osVersion+\"\":\"\"),\"*\"===e.cfg.path&&(a=''+t.get(\"url\")+\"\");var l=t.get(\"link\")?/^https?\\:\\/\\//.test(t.get(\"link\"))?t.get(\"link\"):\"http://\"+t.get(\"link\"):\"\",c=S.default.escape(t.get(\"nick\")),u=l?''+c+\"\":''+c+\"\",f=I.hide?\"\":e.cfg.enableQQ&&t.get(\"QQAvatar\")?'':'',p=f+''+u+\" \"+a+''+(0,g.default)(t.get(\"insertedAt\"),e.i18n)+''+e.i18n.t(\"reply\")+''+(0,j.default)(t.get(\"comment\"))+'';o.html(p);var d=o.find(\".vat\");o.find(\"a:not(.at)\").forEach(function(e){(0,S.default)(e).attr({target:\"_blank\",rel:\"noopener\"})}),r?n.append(o):n.prepend(o);var h=o.find(\".vcontent\");h&&R(h),d&&C(d,t)},z={},C=function(t,n){t.on(\"click\",function(r){var o=t.attr(\"data-vm-id\"),i=t.attr(\"data-self-id\"),a=e.$el.find(\".vwrap\"),s=\"@\"+S.default.escape(n.get(\"nick\"));(0,S.default)('.vreply-wrapper[data-self-id=\"'+i+'\"]').append(a).find(\".cancel-reply\").show(),z={at:S.default.escape(s)+\" \",rid:o,pid:i,rmail:n.get(\"mail\")},v.comment.attr({placeholder:s})[0].focus()})},P=function(){setTimeout(function(){try{e.cfg.mathjax&&\"MathJax\"in window&&\"version\"in window.MathJax&&(/^3.*/.test(window.MathJax.version)&&MathJax.typeset()||MathJax.Hub.Queue([\"Typeset\",MathJax.Hub,document.querySelector(\".v\")])),\"renderMathInElement\"in window&&renderMathInElement((0,S.default)(\".v\")[0],{delimiters:[{left:\"$$\",right:\"$$\",display:!0},{left:\"$\",right:\"$\",display:!1}]})}catch(e){}},100)},R=function(e){setTimeout(function(){e[0].offsetHeight>200&&(e.addClass(\"expand\"),e.on(\"click\",function(t){e.removeClass(\"expand\")}))})};!function(t){if(t=S.default.store.get(h.MetaCacheKey)||t)for(var n in p)if(p.hasOwnProperty(n)){var r=p[n];e.$el.find(\".v\"+r).val(S.default.unescape(t[r])),E[r]=t[r]}var o=S.default.store.get(h.QQCacheKey);E.QQAvatar=e.cfg.enableQQ&&!!o&&o.pic||\"\"}(),e.reset=function(){E.comment=\"\",v.comment.val(\"\"),f(v.comment),v.comment.attr(\"placeholder\",e.cfg.placeholder),z={},e.$preview.hide(),e.$el.find(\".vpanel\").append(e.$el.find(\".vwrap\")),e.$el.find(\".cancel-reply\").hide(),T=\"\"};var M=e.$el.find(\".vsubmit\"),F=function(t){if(e.cfg.requiredFields.indexOf(\"nick\")>-1&&E.nick.length-1&&!/[\\w-\\.]+@([\\w-]+\\.)+[a-z]{2,3}/.test(E.mail))return v.mail[0].focus(),void e.$el.find(\".status-bar\").text(\"\"+e.i18n.t(\"mailFail\")).empty(3e3);if(\"\"==T)return void v.comment[0].focus();E.comment=T,E.nick=E.nick||\"Anonymous\";var n=S.default.store.get(\"vlx\");if(n){if(Date.now()/1e3-n/1e30){var a=n[r];M.attr({disabled:!0});var s=\"![Uploading \"+a.name+\"...]()\";w(i[0],s),D(a,function(l){500!=l.code?(i.val(i.val().replace(s,\"![\"+a.name+\"](\"+l.data.url+\")\\r\\n\")),(0,c.default)(i[0]),++r2?i=!!AV.applicationId&&!!AV.applicationKey:o.default.deleteInWin(\"AV\",0)}i?t&&t():o.default.sdkLoader(\"//fujiatian.com/js/src/av-min.js\",\"AV\",function(n){var r=\"https://\",o=\"\",a=e.app_id||e.appId,s=e.app_key||e.appKey;if(!e.serverURLs)switch(a.slice(-9)){case\"-9Nh9j0Va\":r+=\"tab.\";break;case\"-MdYXbMMI\":r+=\"us.\"}o=e.serverURLs||r+\"leancloud.cn\",AV.init({appId:a,appKey:s,serverURLs:o}),i=!0,t&&t()})}},function(e,t,n){\"use strict\";function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var o=n(95),i=r(o),a=n(111),s=r(a),l=n(112),c=r(l),u=n(109),f=r(u),p=n(110),d=r(p),h={zh:s.default,\"zh-cn\":s.default,\"zh-CN\":s.default,\"zh-TW\":c.default,en:f.default,\"en-US\":f.default,ja:d.default,\"ja-JP\":d.default};t.default=function(e,t){return!h[e]&&e&&t&&(h[e]=t),new i.default({phrases:h[e||\"zh\"],locale:e})}},function(e,t,n){\"use strict\";t.__esModule=!0,t.default=function(e,t){if(e.$el&&e.$loading.hide().$nodata.hide(),\"[object Error]\"==={}.toString.call(t)){var n=t.code||t.message||t.error||\"\";if(isNaN(n))e.$el&&e.$nodata.show(' '+JSON.stringify(t)+\"\");else{var r=e.i18n.t(\"code-\"+n),o=(r==\"code-\"+n?void 0:r)||t.message||t.error||\"\";101==n||-1==n?e.$nodata.show():e.$el&&e.$nodata.show('Code '+n+\": \"+o+\"\")}}else e.$el&&e.$nodata.show(''+JSON.stringify(t)+\"\")}},function(e,t,n){\"use strict\";function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var o=n(94),i=r(o),a=n(54),s=r(a),l=n(86),c=r(l),u=n(3),f=r(u),p=n(13),d=r(p),h=new i.default.Renderer;h.code=function(e,t){return''+(t&&hljs.getLanguage(t)?hljs.highlight(t,e).value:f.default.escape(e))+\"\"},i.default.setOptions({renderer:\"hljs\"in window?h:new i.default.Renderer,highlight:function(e,t){return\"hljs\"in window?t&&hljs.getLanguage(t)&&hljs.highlight(t,e,!0).value||hljs.highlightAuto(e).value:(0,c.default)(e)},gfm:!0,tables:!0,breaks:!0,pedantic:!1,sanitize:!0,sanitizer:s.default,smartLists:!0,smartypants:!0,headerPrefi:\"v-\"}),t.default=function(e){return(0,i.default)(d.default.parse(e,!0))}},function(e,t,n){\"use strict\";t.__esModule=!0,t.recordIPFn=t.fetchQQFn=void 0;var r=n(3),o=function(e){return e&&e.__esModule?e:{default:e}}(r),i=n(6),a=function(e,t){var n=o.default.store.get(i.QQCacheKey);n&&n.qq==e?t&&t(n):o.default.ajax({url:\"//valine.api.ioliu.cn/getqqinfo\",method:\"POST\",body:{qq:e}}).then(function(e){e.json().then(function(e){e.errmsg||(o.default.store.set(i.QQCacheKey,e),t&&t(e))})})},s=function(e){o.default.ajax({url:\"//api.ip.sb/jsonip\",method:\"jsonp\"}).then(function(t){e(t.ip)})};t.fetchQQFn=a,t.recordIPFn=s},function(e,t,n){\"use strict\";t.__esModule=!0,t.default=function(e,t){if(!e)return\"\";try{var n=o(e).getTime(),i=(new Date).getTime(),a=i-n,s=Math.floor(a/864e5);if(0===s){var l=a%864e5,c=Math.floor(l/36e5);if(0===c){var u=l%36e5,f=Math.floor(u/6e4);if(0===f){var p=u%6e4;return Math.round(p/1e3)+\" \"+t.t(\"seconds\")}return f+\" \"+t.t(\"minutes\")}return c+\" \"+t.t(\"hours\")}return s>16)+(n>>16)>5]|=128>9>t%32&255);return n}function h(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t5]|=(255&e.charCodeAt(t/8))4&15)+r.charAt(15&t);return o}function y(e){return unescape(encodeURIComponent(e))}function b(e){return v(y(e))}function w(e){return m(b(e))}function x(e,t){return g(y(e),y(t))}function k(e,t){return m(x(e,t))}function S(e,t,n){return t?n?x(t,e):k(t,e):n?b(e):w(e)}void 0!==(r=function(){return S}.call(t,n,t,e))&&(e.exports=r)}()},function(e,t,n){\"use strict\";var r=n(2),o=n(4),i=n(1),a=n(5),s=n(14),l=n(15),c=l(),u=n(49),f=i(\"Array.prototype.slice\"),p=o.apply(c),d=function(e,t){return a(e),p(e,f(arguments,1))};r(d,{getPolyfill:l,implementation:s,shim:u}),e.exports=d},function(e,t,n){\"use strict\";var r=n(2),o=n(15);e.exports=function(){var e=o();return r(Array.prototype,{forEach:e},{forEach:function(){return Array.prototype.forEach!==e}}),e}},function(e,t,n){\"use strict\";function r(e){for(var t,n,o=Array.prototype.slice.call(arguments,1);o.length;){t=o.shift();for(n in t)t.hasOwnProperty(n)&&(\"[object Object]\"===Object.prototype.toString.call(e[n])?e[n]=r(e[n],t[n]):e[n]=t[n])}return e}e.exports=r},function(e,t,n){\"use strict\";t.__esModule=!0;var r=n(53),o=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default=function(e){return e=(0,o.default)({url:\"\",method:\"get\",body:{}},e),new Promise(function(t,n){if(\"jsonp\"==e.method){var r=\"cb_\"+(Date.now()+Math.round(1e3*Math.random())).toString(32),o=document,i=o.body,s=o.createElement(\"script\");return e.body.callback=r,e.body.t=Date.now(),s.src=e.url+\"?\"+a(e.body),window[r]=function(e){window[r]=null,i.removeChild(s),t(e)},void i.appendChild(s)}var l=\"XMLHttpRequest\"in window?new XMLHttpRequest:new ActiveXObject(\"Microsoft.XMLHTTP\"),c=[],u=[],f={},p=function e(){return{ok:2==(l.status/100|0),statusText:l.statusText,status:l.status,url:l.responseURL,text:function(){return Promise.resolve(l.responseText)},json:function(){return Promise.resolve(l.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([l.response]))},clone:e,headers:{keys:function(){return c},entries:function(){return u},get:function(e){return f[e.toLowerCase()]},has:function(e){return e.toLowerCase()in f}}}};e.url=e.url+\"?\"+(\"get\"==e.method?a(e.body):\"\"),l.open(e.method||\"get\",e.url,!0),l.onload=function(){l.getAllResponseHeaders().replace(/^(.*?):[^\\S\\n]*([\\s\\S]*?)$/gm,function(e,t,n){c.push(t=t.toLowerCase()),u.push([t,n]),f[t]=f[t]?f[t]+\",\"+n:n}),t(p())},l.onerror=n,l.withCredentials=\"include\"==e.credentials;for(var d in e.headers)l.setRequestHeader(d,e.headers[d]);l.send(\"post\"==e.method?e.body:\"get\"==e.method?null:a(e.body))})};var i=encodeURIComponent,a=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(i(n)+\"=\"+i(e[n]));return(t=t.join(\"&\").replace(/%20/g,\"+\"))||null}},function(e,t,n){\"use strict\";t.__esModule=!0;var r=function(e){e=e||navigator.userAgent;var t={},n={Trident:e.indexOf(\"Trident\")>-1||e.indexOf(\"NET CLR\")>-1,Presto:e.indexOf(\"Presto\")>-1,WebKit:e.indexOf(\"AppleWebKit\")>-1,Gecko:e.indexOf(\"Gecko/\")>-1,Safari:e.indexOf(\"Safari\")>-1,Edge:e.indexOf(\"Edge\")>-1||e.indexOf(\"Edg\")>-1,Chrome:e.indexOf(\"Chrome\")>-1||e.indexOf(\"CriOS\")>-1,IE:e.indexOf(\"MSIE\")>-1||e.indexOf(\"Trident\")>-1,Firefox:e.indexOf(\"Firefox\")>-1||e.indexOf(\"FxiOS\")>-1,\"Firefox Focus\":e.indexOf(\"Focus\")>-1,Chromium:e.indexOf(\"Chromium\")>-1,Opera:e.indexOf(\"Opera\")>-1||e.indexOf(\"OPR\")>-1,Vivaldi:e.indexOf(\"Vivaldi\")>-1,Yandex:e.indexOf(\"YaBrowser\")>-1,Kindle:e.indexOf(\"Kindle\")>-1||e.indexOf(\"Silk/\")>-1,360:e.indexOf(\"360EE\")>-1||e.indexOf(\"360SE\")>-1,UC:e.indexOf(\"UC\")>-1||e.indexOf(\" UBrowser\")>-1,QQBrowser:e.indexOf(\"QQBrowser\")>-1,QQ:e.indexOf(\"QQ/\")>-1,Baidu:e.indexOf(\"Baidu\")>-1||e.indexOf(\"BIDUBrowser\")>-1,Maxthon:e.indexOf(\"Maxthon\")>-1,Sogou:e.indexOf(\"MetaSr\")>-1||e.indexOf(\"Sogou\")>-1,LBBROWSER:e.indexOf(\"LBBROWSER\")>-1,\"2345Explorer\":e.indexOf(\"2345Explorer\")>-1,TheWorld:e.indexOf(\"TheWorld\")>-1,XiaoMi:e.indexOf(\"MiuiBrowser\")>-1,Quark:e.indexOf(\"Quark\")>-1,Qiyu:e.indexOf(\"Qiyu\")>-1,Wechat:e.indexOf(\"MicroMessenger\")>-1,Taobao:e.indexOf(\"AliApp(TB\")>-1,Alipay:e.indexOf(\"AliApp(AP\")>-1,Weibo:e.indexOf(\"Weibo\")>-1,Douban:e.indexOf(\"com.douban.frodo\")>-1,Suning:e.indexOf(\"SNEBUY-APP\")>-1,iQiYi:e.indexOf(\"IqiyiApp\")>-1,Windows:e.indexOf(\"Windows\")>-1,Linux:e.indexOf(\"Linux\")>-1||e.indexOf(\"X11\")>-1,macOS:e.indexOf(\"Macintosh\")>-1,Android:e.indexOf(\"Android\")>-1||e.indexOf(\"Adr\")>-1,Ubuntu:e.indexOf(\"Ubuntu\")>-1,FreeBSD:e.indexOf(\"FreeBSD\")>-1,Debian:e.indexOf(\"Debian\")>-1,\"Windows Phone\":e.indexOf(\"IEMobile\")>-1||e.indexOf(\"Windows Phone\")>-1,BlackBerry:e.indexOf(\"BlackBerry\")>-1||e.indexOf(\"RIM\")>-1||e.indexOf(\"BB10\")>-1,MeeGo:e.indexOf(\"MeeGo\")>-1,Symbian:e.indexOf(\"Symbian\")>-1,iOS:e.indexOf(\"like Mac OS X\")>-1,\"Chrome OS\":e.indexOf(\"CrOS\")>-1,WebOS:e.indexOf(\"hpwOS\")>-1,Mobile:e.indexOf(\"Mobi\")>-1||e.indexOf(\"iPh\")>-1||e.indexOf(\"480\")>-1,Tablet:e.indexOf(\"Tablet\")>-1||e.indexOf(\"Pad\")>-1||e.indexOf(\"Nexus 7\")>-1};n.Mobile&&(n.Mobile=!(e.indexOf(\"iPad\")>-1));var r={browser:[\"Safari\",\"Chrome\",\"Edge\",\"IE\",\"Firefox\",\"Firefox Focus\",\"Chromium\",\"Opera\",\"Vivaldi\",\"Yandex\",\"Kindle\",\"360\",\"UC\",\"QQBrowser\",\"QQ\",\"Baidu\",\"Maxthon\",\"Sogou\",\"LBBROWSER\",\"2345Explorer\",\"TheWorld\",\"XiaoMi\",\"Quark\",\"Qiyu\",\"Wechat\",\"Taobao\",\"Alipay\",\"Weibo\",\"Douban\",\"Suning\",\"iQiYi\"],os:[\"Windows\",\"Linux\",\"Mac OS\",\"macOS\",\"Android\",\"Ubuntu\",\"FreeBSD\",\"Debian\",\"iOS\",\"Windows Phone\",\"BlackBerry\",\"MeeGo\",\"Symbian\",\"Chrome OS\",\"WebOS\"]};for(var o in r)if(r.hasOwnProperty(o))for(var i=0,a=r[o].length;i=0&&y[o]!==i;o--);if(o>=0){for(r=y.length-1;r>=o;r--)t.end&&t.end(y[r]);y.length=o}}for(var m,y=r(),b=e;e;)!function(){m=!0,n();var t=e===b;b=e,t&&(e=\"\")}();g()}var i=n(10),a=n(28),s=(n(26),n(27)),l=/^1?{type:\"space\",raw:t[0]}:{raw:\"\\n\"}},t.code=function(e,t){var n=this.rules.block.code.exec(e);if(n){var r=t[t.length-1];if(r&&\"paragraph\"===r.type)return{raw:n[0],text:n[0].trimRight()};var o=n[0].replace(/^ {1,4}/gm,\"\");return{type:\"code\",raw:n[0],codeBlockStyle:\"indented\",text:this.options.pedantic?o:N(o,\"\\n\")}}},t.fences=function(e){var t=this.rules.block.fences.exec(e);if(t){var n=t[0],r=m(n,t[3]||\"\");return{type:\"code\",raw:n,lang:t[2]?t[2].trim():t[2],text:r}}},t.heading=function(e){var t=this.rules.block.heading.exec(e);if(t){var n=t[2].trim();if(/#$/.test(n)){var r=N(n,\"#\");this.options.pedantic?n=r.trim():r&&!/ $/.test(r)||(n=r.trim())}return{type:\"heading\",raw:t[0],depth:t[1].length,text:n}}},t.nptable=function(e){var t=this.rules.block.nptable.exec(e);if(t){var n={type:\"table\",header:U(t[1].replace(/^ *| *\\| *$/g,\"\")),align:t[2].replace(/^ *|\\| *$/g,\"\").split(/ *\\| */),cells:t[3]?t[3].replace(/\\n$/,\"\").split(\"\\n\"):[],raw:t[0]};if(n.header.length===n.align.length){var r,o=n.align.length;for(r=0;r1,d={type:\"list\",raw:u,ordered:p,start:p?+f.slice(0,-1):\"\",loose:!1,items:[]},h=t[0].match(this.rules.block.item),v=!1,g=h.length;o=this.rules.block.listItemStart.exec(h[0]);for(var m=0;mo[1].length:i[1].length>o[0].length||i[1].length>3){h.splice(m,2,h[m]+\"\\n\"+h[m+1]),m--,g--;continue}(!this.options.pedantic||this.options.smartLists?i[2][i[2].length-1]!==f[f.length-1]:p===(1===i[2].length))&&(a=h.slice(m+1).join(\"\\n\"),d.raw=d.raw.substring(0,d.raw.length-a.length),m=g-1),o=i}r=n.length,n=n.replace(/^ *([*+-]|\\d+[.)]) ?/,\"\"),~n.indexOf(\"\\n \")&&(r-=n.length,n=this.options.pedantic?n.replace(/^ {1,4}/gm,\"\"):n.replace(new RegExp(\"^ {1,\"+r+\"}\",\"gm\"),\"\")),s=v||/\\n\\n(?!\\s*$)/.test(n),m!==g-1&&(v=\"\\n\"===n.charAt(n.length-1),s||(s=v)),s&&(d.loose=!0),this.options.gfm&&(l=/^\\[[ xX]\\] /.test(n),c=void 0,l&&(c=\" \"!==n[1],n=n.replace(/^\\[[ xX]\\] +/,\"\"))),d.items.push({type:\"list_item\",raw:u,task:l,checked:c,loose:s,text:n})}return d}},t.html=function(e){var t=this.rules.block.html.exec(e);if(t)return{type:this.options.sanitize?\"paragraph\":\"html\",raw:t[0],pre:!this.options.sanitizer&&(\"pre\"===t[1]||\"script\"===t[1]||\"style\"===t[1]),text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(t[0]):B(t[0]):t[0]}},t.def=function(e){var t=this.rules.block.def.exec(e);if(t){t[3]&&(t[3]=t[3].substring(1,t[3].length-1));return{tag:t[1].toLowerCase().replace(/\\s+/g,\" \"),raw:t[0],href:t[2],title:t[3]}}},t.table=function(e){var t=this.rules.block.table.exec(e);if(t){var n={type:\"table\",header:U(t[1].replace(/^ *| *\\| *$/g,\"\")),align:t[2].replace(/^ *|\\| *$/g,\"\").split(/ *\\| */),cells:t[3]?t[3].replace(/\\n$/,\"\").split(\"\\n\"):[]};if(n.header.length===n.align.length){n.raw=t[0];var r,o=n.align.length;for(r=0;r"}],"posts":[{"title":"PSR观测(1)","slug":"PSR观测-1","date":"2022-04-09T12:41:19.000Z","updated":"2022-04-10T03:57:51.951Z","comments":true,"path":"2022/04/09/PSR观测-1/","link":"","permalink":"http://www.rainend.org/2022/04/09/PSR%E8%A7%82%E6%B5%8B-1/","excerpt":"","text":"什么是脉冲星(PSR)？脉冲星：具有周期性脉冲发射观测效应的致密天体（中子星、白矮星） 因目前观测到的脉冲星大多是中子星，所以按中子星的标准给出脉冲星的物理参数： 直径：10～20km #此项为估算，无需直接测量质量：1.4～2.2密度：~倍数于原子核密度磁场：~自传周期：1ms～23s 燃鹅，目前还没有一种能准确描述中子星物理的理论，这是因为实验室还无法准确制造那里的条件，导致了现在描述中子星结构的理论模型还挺多的，大家都各有各的道理。这里仅简单介绍一种较为传统的对中子星的描述： 一般认为中子星由大气、外壳、内壳、外核和内核组成。其中大气和外壳主要是一些原子核、电子简并气和一些中子（过渡层），到了外核的时候中子成分逐渐增加成为主要成分，内核是quark-hadron transition&amp;&amp;quarks？ 脉冲星的观测量想要准确建立中子星的理论模型，需要很多参数的支持，然而中子星通常离我们非常远、且尺度非常小～10km，导致了在光学上很难观测到（历史上第一次发现中子星并不是在光学波段直接看到的，而是由贝尔在射电波段观测到的）。所以我们大多数情况下只能通过观测那些能发射脉冲的中子星（脉冲星），通过观测脉冲星发射的脉冲信号的性质来反推中子星的参数。 classDiagram Animal","categories":[{"name":"技术","slug":"技术","permalink":"http://www.rainend.org/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[],"author":"walnut"},{"title":"coma星团弥散速度","slug":"coma星团弥散速度","date":"2022-04-04T08:07:52.000Z","updated":"2022-04-05T16:06:31.707Z","comments":true,"path":"2022/04/04/coma星团弥散速度/","link":"","permalink":"http://www.rainend.org/2022/04/04/coma%E6%98%9F%E5%9B%A2%E5%BC%A5%E6%95%A3%E9%80%9F%E5%BA%A6/","excerpt":"","text":"关于速度弥散速度弥散度的定义（velocity dispersion）：弥散度是指随机变量方差的平方根，即均方差或标准差。在天文学中﹐速度弥散度通常是指恒星系统中剩余速度的弥散度。下面例举一些天文学中速度弥散的用途： 速度弥散和恒星年龄 ​ 天文统计学研究表明，速度弥散和恒星年龄Age呈相关关系。因此在已知其中一个量的情况下，可以较好的估计另一个量。 Faber-Jackson关系​ 与盘星系对照，椭圆星系中的恒星并不遵循“有序旋转”，它们的大部分动能投入到了随机运动中，可以用速度弥散描述这种随机运动。Faber-Jackson关系是椭圆星系的光度L与其中发光物质的速度弥散的关系： 也即： 指数接近于4。该关系可以用来测定椭圆星系的距离。 Coma星系团的速度弥散根据定义编写代码求恒星的弥散速度和速度分布图： import numpy as np from astropy.io import fits as pyfits import astropy.io.fits as fits import matplotlib import matplotlib.pyplot as plt def loadData(filename): tchfits = fits.open(filename) tabl = tchfits[1].data.copy() return tabl filename = &#39;ComaCluster.fits&#39; coma = loadData(filename) #排除掉红移速度小于0和大于两万的数据，太大的值有可能是背景星: cz = coma.czA[(coma.czA&lt;20000) &amp; (coma.czA&gt;0)] sig_cz = np.var(cz) print(np.sqrt(sig_cz)) #速度弥散 zgrid =np.arange(2000.,12000.,750.) h, xedge = np.histogram(cz, bins=zgrid) fig = plt.figure(figsize=[4,4]) ax = fig.add_subplot(111) print(zgrid) ax.plot(zgrid[0:-1]+250,h,&#39;k*-&#39;) #zgrid的值从第0号取到倒数第二号 ax.set_xlabel(&#39;redshift (km/s)&#39;) fig.show() 需要注意的是： 1.求速度弥散之前要剔除掉一些离谱的数据：-max_int和redshift超过两万的值，极高redshift值的样本可能是背景星。 2.使用np.histogram根据bins=zgrid划分cz数据点数量的时候，得到的h值的个数比zgrid少一个，所以最后画图的时候横坐标使用zgrid[0:-1]+250。 速度弥散的后验分布无信息先验分布的正态模型通常情况下无信息先验分布选择为均匀分布的正态分布。 这里计算时使用以下步骤的随机抽样方法： 1.先从中抽取随机的。1.1数值化实现分布:作为lnv-Gamma分布的一个特例，实际服从变倍的分布，即有： 即有： 为了避免计算机处理极大数或极小数的限制，对上式两边同时取对数： 然后减去对数密度分布的最大值： 最后再从对数还原为线性值： 1.2.用python代码还原以上过程：#使用python def InvGammaln(x,alpha,beta): return np.log(beta)*alpha-(special.gammaln(alpha))-\\ np.log(x)*(+alpha+1)-beta/x #取对数后的公式，对应公式z=... #special.gammaln: In(|\\Gamma()|) def Scl_InvChi2ln(x, nu, s2): return InvGammaln(x, nu/2.,nu/2.*s2) def randDraw_SInvChi2(nu,s2, N): #从公式抽取随机的sigma2 x = [] k = 0 m = 0 while k&lt;N and m &lt;= 100: x0 = np.random.uniform(low=1e5,high=10e6,size=N*20) y0 = np.log(np.random.uniform(\\ low=0,high=0.006,size=N*20)) #x0 = logit(x0) y1 = Scl_InvChi2ln(x0, nu, s2) ind = (y0&lt;y1) x.append(x0[ind]) #y0&lt;y1 k = k + np.sum(ind) m += 1 #print(k,m,len(np.array(x))) x2 = np.concatenate(x) xx = np.array(x2).reshape((k,1)) return (xx[0:N]) 编写好以上函数后，抽取出的可用sigma2 = randDraw_SInvChi2(n-1,s2, N)算出。","categories":[{"name":"技术","slug":"技术","permalink":"http://www.rainend.org/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[],"author":"walnut"},{"title":"R_Astro","slug":"astro-python","date":"2022-03-26T13:13:24.000Z","updated":"2022-03-27T08:29:36.889Z","comments":true,"path":"2022/03/26/astro-python/","link":"","permalink":"http://www.rainend.org/2022/03/26/astro-python/","excerpt":"","text":"基础库（主要的支持库）：numpy, matplotlib, ipython, scipy, pandas, seaborn 天文&amp;射电天文库：astropy$ pip install astropy 手册：https://docs.astropy.org/en/stable/ spectral-cube三维（两个位置维度和一个光谱维度）天文数据处理 $ pip install spectral-cube 手册：https://spectral-cube.readthedocs.io/en/latest/ mayavi3D 数据/3D 绘图 $ pip install mayavi $ pip install PyQt5 手册：https://docs.enthought.com/mayavi/mayavi/index.html healpy天图数据处理常用包 $ pip install healpy 手册：https://healpy.readthedocs.io/en/latest/tutorial.html astroML天文&amp;天体物理数据挖掘、机器学习库 $ pip install astroML 手册：https://www.astroml.org/ pycamb宇宙学代码，计算 CMB、透镜、星系计数、暗年龄 21cm 功率谱、物质功率谱和传递函数 pip install camb 手册：https://camb.readthedocs.io/en/latest/ astrometry天体测量数据、天图数据相关包 安装： #安装依赖包，我使用的是ubuntu环境，别的系统请自行参考手册 $ sudo apt install build-essential curl git file pkg-config swig \\ libcairo2-dev libnetpbm10-dev netpbm libpng-dev libjpeg-dev \\ zlib1g-dev libbz2-dev libcfitsio-dev wcslib-dev \\ python3 python3-pip python3-distutils python3-dev \\ python3-numpy python3-scipy python3-pil #获取代码 $ wget http://astrometry.net/downloads/astrometry.net-latest.tar.gz $ tar xvzf astrometry.net-latest.tar.gz $ cd astrometry.net-* #安装。ubuntu环境下，以下操作建议全程sudo或者su获取权限 $ make $ make py $ make extra $ make install # to put it in /usr/local/astrometry # or: $ make install INSTALL_DIR=/some/other/place 手册：https://nova.astrometry.net/ http://astrometry.net/doc/readme.html#","categories":[{"name":"资源","slug":"资源","permalink":"http://www.rainend.org/categories/%E8%B5%84%E6%BA%90/"}],"tags":[],"author":"walnut"},{"title":"服务器部署jupyter notebook","slug":"服务器部署jupyter notebook","date":"2022-03-16T19:38:05.000Z","updated":"2022-04-04T15:39:49.790Z","comments":true,"path":"2022/03/17/服务器部署jupyter notebook/","link":"","permalink":"http://www.rainend.org/2022/03/17/%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2jupyter%20notebook/","excerpt":"","text":"因此学期开了两门在课堂演示和讲解python代码的课，故想在课堂上跟着练习；可我的陈年笔记本太重、续航也不太行，所以想到了可以在（承担了太多的）服务器上部署jupyter，通过平板浏览器远程访问就行。 也顺便解决了多平台数据共享不方便的问题，这样无论在linux、windows还是平板上写代码，进度都是共享的。 效果(和A4纸对比)： 安装anaconda服务器：CentOs7 1.下载安装anaconda去官网找到 ananconda linux对应版本的下载链接。如https://repo.anaconda.com/archive/Anaconda3-5.1.0-Linux-x86_64.sh在服务器合适位置下载 wget https://repo.anaconda.com/archive/Anaconda3-5.1.0-Linux-x86_64.sh 下载完毕后输入 bash Anaconda-xxx.sh 根据提示安装 (一路yes即可) 2.使ananconda立即生效并测试source ~/.bashrc 测试是否生效 在控制台输入 python，看到首行Python 3.6.4 |Anaconda, Inc.|,则大功告成。如果还是旧版本的python，说明在安装的过程中，添加环境变量的时候被选中了 no。 3.手动添加环境变量vim ~/.bashrc将下面这句插入到最后一行export PATH=/root/anaconda3/bin:$PATH如果不是root用户（往控制台上面翻，安装的时候给出这个path了）export PATH=”/home/用户名/anaconda3/bin:$PATH”最后再执行source ~/.bashrc 服务器上部署jupyter1.创建jupyter默认配置文件jupyter notebook --generate-config 此时会显示配置文件的位置，稍后会用到。 mkdir jupyter #创建jupyter工作目录 pwd #查看工作目录的路径，配置文件时会用到 2.生成密钥命令行输入 ipython #输入ipython后编写代码： from notebook.auth import passwd passwd() 并将生成的sha1:xxx复制下来。 3.修改配置文件使用vim打开第一步中生成的配置文件，在文件的末尾将下面的代码复制进去，并自行修改。 c.NotebookApp.ip = &#39;*&#39; #所有绑定服务器的IP都能访问，若想只在特 定ip访问，输入ip地址即可 c.NotebookApp.port = 8888 #将端口设置为自己喜欢的吧，默认是8888 c.NotebookApp.open_browser = False #我们并不想在服务器上直接打开Jupyter Notebook，所以设置成False c.NotebookApp.notebook_dir = &#39;/root/jupyter_projects&#39; #这里是设置Jupyter的根目&gt;录，若不设置将默认root的根目录，不安全 c.NotebookApp.allow_root = True # 为了安全，Jupyter默认不允许以root权限启&gt;动jupyter c.NotebookApp.terminals_enabled = False # 关闭terminal c.NotebookApp.allow_remote_access=True #不加这个可能会出现无法启动服务 c.NotebookApp.password = r&#39;sha1:xxxxxx&#39; # 此处是登录jupyter notebook的密码 4.启动命令jupyter notebook --ip=0.0.0.0 --no-browser --allow-root 以上为临时启动命令，即断开ssh连接后jupyter也会自动断开连接。 下面使用nohup命令让jupyter在后台一直运行 nohup jupyter notebook --ip=0.0.0.0 --no-browser --allow-root &amp; 结束后台运行的jupyter //查看正在运行的jupyter进程pid //a: 显示所有程序 //u: 以用户为主的格式来显示 //x: 显示所有程序，不以终端来区分 ps -aux | grep jupyter //结束进程 //指令格式 kill -9 pid //eg kill -9 17702 防火墙原因引起的ERR_TIME_OUT报错开放指定端口，并重启防火墙 firewall-cmd --zone=public --add-port=8888/tcp --permanent systemctl restart firewalld.service 若用的腾讯云/阿里云，也可在服务器相应的管理界面开放端口。","categories":[{"name":"技术","slug":"技术","permalink":"http://www.rainend.org/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"web","slug":"web","permalink":"http://www.rainend.org/tags/web/"}],"author":"walnut"},{"title":"恒星结构-名词解释","slug":"恒星结构-名词解释","date":"2021-12-02T13:13:39.000Z","updated":"2022-03-29T14:06:06.538Z","comments":true,"path":"2021/12/02/恒星结构-名词解释/","link":"","permalink":"http://www.rainend.org/2021/12/02/%E6%81%92%E6%98%9F%E7%BB%93%E6%9E%84-%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A/","excerpt":"","text":"恒星结构-名词解释*用途：查补恒星结构名词、概念(现阶段就用ctrlF吧..)结合恒星内部结构的课件资料观看细节 Volume1chap1进动( procession ):一个自转的物体受外力作用导致其自 转轴 绕某一中心与自转方向相同的旋转 chap2自行( proper motion ):恒星于一年内所行经的距离对观测者所张的⻆度 ( 横向运动 ) chap3三⻆视差( trigonometric parallaxes ):恒星对日地平均距离的张⻆叫做恒星的三⻆视差 chap4大气质量( air mass ):实际上的黑体( black body ):一个理想化的物体,能够吸收外来的全部电磁辐射,并且不会有任何的反射与投射,辐射仅与温度有关热动平衡 / 热力学平衡( thermodynamic equilibrium ):当系统处于平衡状态时,其宏观物理性质是不随时间变化的,但从微观方面来看,组成系统的 粒子 却处于永不停息的热运动之中。斯特藩 - 玻尔兹曼定律( Stefan-Boltzmann law ): 维恩位移定律( Wien’s displacement law ):在一定温度下,绝对黑体的温度与辐射本领最大值相对应的峰值波⻓ λ 的乘积为一常数。当绝对黑体的温度升高时,辐射本领的最大值向短波方向移动。太阳常数( solar constant ):地球大气每秒每平方厘米能接收到的太阳辐射量绝对星等( absolute magnitude ):恒星在 10pc 距离处的视星等 chap5主序( main sequence ):颜色星等图中,大多数恒星所落在的一条线巨星( giant ):比主序更亮的星矮星( dwarf ):巨星之外的星,主序和比主序更暗的星疏散星团( open cluster ):由数百颗至上千颗由较弱引力联系的恒星所组成的天体球状星团:由成千上万甚至数十万颗恒星组成,外貌呈球形,越往中心恒星越密集 chap6热星等( bolometric magnitude ):表征天体在整个辐射波段内辐射总量的星等 chap7视宁度( seeing ):望远镜显示图像的清晰度 chap8有效温度( effective temperature ):释放相同总电磁辐射量的黑体的温度 chap9多普勒效应( Doppler effect ):物体辐射的波⻓因为波源和观测者的相对运动而产生变化。在运动的波源前面,波⻓变短,频率变高(蓝移 blue shi );在运动的波源后面,波⻓变⻓,频率变低(红移 red shi )夫琅和费线( Fraunhofer line ):太阳光谱中的吸收线高分辨率光谱( high resolution spectra ):可以在很窄的波⻓带中观测到恒星能量分布的光谱分光双星( spectroscopic binary star ):通过对某天体谱线位置变化的观测分析,能判断出的双星质光关系( The mass-luminosity relation ):愈大质量的恒星,发光能力也愈高。光度与质量的 α 次幂成正比, α 在 3.5 ~ 4 之间。 chap10光谱序( spectral sequence ):将恒星依光谱类型 (O, B, A, F, G, K, M) 由高温到低温排序 chap12紫外超( ultraviolet excess ):天体的紫外辐射大于相同光谱型天体的正常紫外辐射的现象 chap14塞曼效应( Zeeman effect ):原子在外磁场中发光谱线发生分裂且偏振的现象 chap15压力标高( scale height ):表征恒星气压随着高度增加而减小的量,高度每升高一个 “ 标高 ”H ,气压就减小为原来的 e 分之一爱丁顿流( Eddington current ):快速自转恒星产生的缓慢物质流。在极区自下而上,在赤道区域自上而下。P Cygni 轮廓:由于恒星膨胀,正对观测者的部分产生的吸收线蓝移,而恒星边缘的发射线没有多普勒运动,导致出现蓝端吸收、红端发射的谱线轮廓。 chap16脉动变星( pulsating star ):由脉动引起亮度变化的恒星周光关系( period-luminosity relation ):造父变星具有的光变周期和绝对星等之间的关系 chap17回光 / 光回声( light echo ):超新星爆发后被周围尘埃云反射到接收者的光拉格朗日点( Lagrange point ):又称平动点,在天体力学中是限制性三体问题的五个特解洛希瓣( Roche lobe ):包围在天体周围的临界等位面,在这个临界面范围内的物质会受到该天体的引力约束而在轨道上环绕 洛希极限( Roche limit ):双星系统中,如果仅考虑行星对卫星的潮汐,当卫星接近行星到某个极限距离,作用于卫星的起潮力于卫星自引力,卫星便不能维持其整体而被起潮力撕裂。潮汐作用是相互的,一对相互作用的行星和卫星, 卫星在行星上引发汐作用的同时行星也在卫星上 引发潮汐作用。当两者相互接近时 , 潮汐作用增强。如果仅考虑行星对卫星的潮汐,当卫星接近行星到某个极限距离,作用于卫星的起潮力大于卫星自引力,卫星便不能维持其整体而被起潮力撕裂。 chap18太阳米粒组织( solar granulation ):太阳光球层上的一种日面结构。呈多⻆形小颗粒形状,得用望远镜才能观测到闪光光谱( flash spectrum ):在⻝既与生光发生的几秒内才能观测到的光谱过渡区( transition zone ):从色球层到冕层之间的区域(对太阳而言,温度在30000K- )日冕洞( corona hole ):日冕中进行软 X 射线辐射的区域较差自转( differential rotation ):一个天体在自转时不同部位的⻆速度互不相同的现象 chap19星际红化( interstellar reddening ):星光通过星际空间而变红的现象。星际介质在蓝端消光多,红端消光少,看上去偏红。色余( color excess ):观测所得的大气外天体色指数与无星际消光时该天体的真实色指数之差 Volume2chap4基尔霍夫定律( law of Kirchhoff ):完全热动平衡下,源函数等于普朗克函数 chap5临边昏暗( limb darking ):太阳圆面各处的亮度不均匀。圆面中心亮度最大,越向边缘亮度越小,边缘区域亮度只有中心区域的 40% 左右。这种从日面中心向日面边缘逐渐变暗的现象称为临边昏暗规律。 chap6热平衡( thermal equilibrium ):温度不随时间变化。辐射平衡( radiative equilibrium ):天体辐射流量不随时间变化,不会加热或冷却。灰大气( grey atmosphere ):连续吸收系数与波⻓ / 频率无关的大气。 chap7玻尔兹曼方程( Boltzmann formula ):描述同一电离态不同能级间的粒子数布居。萨哈方程( the Saha equation ):描述相邻电离态粒子数布居。 chap8爱丁顿 - 巴⻉尔关系( Eddington-Barbier relation ):辐射流量等于光深为 2 3 处的源函数的值巴尔末跳变 / 巴尔末跳跃( Balmer jump ):由氢原子的束缚 - 自由跃迁造成的光谱中巴尔末系限两边的强度突变表层降温效应( surface cooling effect ):在非灰大气中,吸收系数 大,几何深度 t 小,观测到更接近表层,温度更低底部升温效应( backwarming effect ):在非灰大气假设下,大量强线会影响连续谱。谱线形成层 大,则辐射的能量小,观测到的能量就更多来自谱线形成层底部更深层的辐射,温度更高 chap10线深( line depth ):谱线处减少的流量与背景流量的比值等值宽度( equivalent width ):与吸收(或发射)谱线轮廓和连续谱之间所包围的面积相当的高度为 1 的矩形的宽度辐射 / 自然阻尼致宽( radiative/natural damping broadening ):粒子本身会辐射。根据不确定性原理 ΔE ⋅ Δt = ħ ,能级平均寿命越⻓,能级宽度越小,相应的谱线具有一定宽度,这与波⻓本身无关多普勒致宽( Doppler broadening ):粒子的热运动服从⻨克斯⻙速度分布,由多普勒效应使谱线加宽半峰半宽( half width at half maximum ):吸收谱带高度为最大处高度一半时谱带的半宽湍动致宽( turbulent broadening ):为了让理论与观测谱一致需要假设有微观湍流存在,与热运动致宽效果相同生⻓曲线( the curve of growth ):等值宽度 与产生该谱线的低能级原子或离子数目之间的关系 chap11斯塔克效应( Stark effect ):由于外加电场出现的谱线移动和分裂现象压力致宽( impact broadening ):由于吸收原子(或离子)受到原子、离子、电子分子的弹性碰撞导致的能量变化,使谱线加宽 chap12多重线 / 多重态( multiplet ):两个精细结构能级之间的所有跃迁 chap13局部热动平衡( local thermodynamic balance ):在恒星大气的局部区域,引入局部温度表征其状态,局部温度不变,且粒子速度满足⻨克斯⻙速度分布、粒子数布居满足玻尔兹曼方程和萨哈方程细致平衡( detailed balance ):在热动平衡中,对每个跃迁过程都要有相同数目的双向跃迁 chap14对流( convection ):流体内部由于各部分温度不同而造成的相对流动热容( heat capacity ):百科(精确):当一系统由于加给一微小的热量 dQ 而温度升高 dT 时, dQ/dT 这个量即是该系统的热容;姜老师(简单理解):每 mol 物质温度升高 1K 需要吸收的热量混合程 / 混合⻓( mixing length ):百科:大气湍流场中,流体微团运动一段距离后仍保留原有特性而不与周围介质混合的⻓度;杜老师:从对流元产生到与周围环境混合在一起运动的距离 chap16爱丁顿极限( Eddington limit ):天体的光度极限,超过此光度恒星就会由于辐射力大于引力而逐渐瓦解 Volume3chap2维里定理( Virial theorem ):热能等于负的引力能的一半( )开尔文 - 亥姆霍兹时标( Kelvin-Helmholtz time ):主序前,恒星引力收缩的时间 chap6对流超射( convective overshoot ):对流元到达对流区顶部时还有向上的速度和正温差带来的加速度,要继续向上运动,到对流稳定区中速度减为 0 ,向下同理。 chap7隧穿效应( tunnel effect ):电子等微观粒子能够穿入或穿越位势垒的量子行为,尽管位势垒的高度大于粒子的总能量伽莫夫峰( Gamow peak ):原子核燃烧(反应)的最有效能区 chap9克雷默不透明度定律( Kramers’ opacity law ):质量吸收系数 ,其中 与金属丰度有关同系星( homologous star ):质量、温度、压强、能量的无量纲量对半径无量纲量有着相同依赖关系的恒星 chap11完全对流恒星( whole convective star ):只有对流没有辐射的恒星,一般在主序之前出现林忠四郎线( Hayashi line ):完全对流恒星在赫罗图上的演化轨迹,理论上不会有比其温度更低的恒星。 chap13零龄主序( zero age main-sequence ,缩写 ZAMS ):当恒星开始核心 H 燃烧并达到流体静力学平衡时, 在赫罗图上的位置(主序带的最左侧)爱丁顿 - 斯威特循环( Eddington-Sweet circulation ):大质量恒星由于快速自转造成的扭曲变形。 chap14赫兹普⻰空隙 / 赫氏空隙( Hertzsprung gap ):小质量恒星脱离主序进入亚巨星支,核心 He 丰度增大一点会引起壳层大幅扩张,有效温度降低。整个过程很快,只发现了很少的星处在此区域,所以称为空隙。挖掘 / 掘取( dredge up ):恒星演化至红巨星阶段,对流区向恒星内部延伸,将主序期间氢燃烧的产物带到恒星表层氦闪( helium flash ):红巨星支顶端,氦核内部电子完全简并,氦核发生爆发性燃烧,核心温度快速上升,核心简并解除,开始平稳氦燃烧过程。团簇星( clump stars ):由于演化过程缓慢而在赫罗图上形成积聚的恒星 chap15蓝回绕( blue loop excursions ):大质量氦核大于 时,核心膨胀,核心温度降低,包层收缩,有效温度上升,在赫罗图上恒星向蓝端移动;核心消耗氦产生碳,粒子数密度降低,核心收缩,核心温度升高,包层膨胀,有效温度降低,在赫罗图上恒星向红端移动。碳闪( carbon flash ):氦燃烧结束后,核心粒子数密度足够高,核心电子完全简并, 12 C 爆发性燃烧,核心温度上升,简并解除,开始平稳碳燃烧。 chap16钱德拉塞卡极限( Chandrasekhar limit ):无自转恒星以电子简并压力阻挡引力坍缩所能承受的最大质量,即白矮星的最高质量,约为","categories":[{"name":"文章","slug":"文章","permalink":"http://www.rainend.org/categories/%E6%96%87%E7%AB%A0/"}],"tags":[],"author":"walnut"},{"title":"某科学の自动打卡脚本","slug":"某科学的自动打卡脚本","date":"2021-11-27T21:41:05.000Z","updated":"2022-03-26T06:28:28.238Z","comments":true,"path":"2021/11/28/某科学的自动打卡脚本/","link":"","permalink":"http://www.rainend.org/2021/11/28/%E6%9F%90%E7%A7%91%E5%AD%A6%E7%9A%84%E8%87%AA%E5%8A%A8%E6%89%93%E5%8D%A1%E8%84%9A%E6%9C%AC/","excerpt":"","text":"项目来源&amp;源码：https://github.com/IanSmith123/ucas-covid19 gkd疫情防控每日填报助手，用于解决忘记填写企业微信中身体状况每日打卡的问题。 请在合理且合法的范围内使用本程序。 本程序仅用于解决忘记打卡这一问题，如果填报表中任意情况发生变化，比如地点发生变化，处在居家隔离阶段等情况，请务必在程序运行之前手动打卡。由于各种已知的或未知的原因可能造成打卡信息不一定总是准确的，请经常人工查看企业微信里面的填报表信息是否正确。 安装在服务器上执行： git clone https://github.com/IanSmith123/ucas-covid19 --depth=1 or wget https://github.com/IanSmith123/ucas-covid19/archive/refs/heads/master.zip 解压并进入项目文件夹 tar -zxvf ucas-covid19-master.zip cd /ucas-covid19-master 安装依赖，依赖库为requests和pytz pip3 install -r requirements.txt 修改配置文件在项目文件中输入 vim sub.py 更改配置文件# 全局变量，如果使用自己的服务器运行请根据需要修改 -&gt;以下变量&lt;- user = &quot;USERNAME&quot; # sep 账号 passwd = r&quot;PASSWORD&quot; # sep 密码 api_key = &quot;&quot; # 可选， server 酱的通知 api key 设置邮件通知# 可选，如果需要邮件通知，那么修改下面五行 :) smtp_port = &quot;SMTP_PORT&quot; #若选用QQ邮箱，此项为465 smtp_server = &quot;SMTP_SERVER&quot; #若选用QQ邮箱，此项为smtp.qq.com sender_email = &quot;&quot; #发送邮箱账号 sender_email_passwd = r&quot;&quot; #发送邮箱密码 receiver_email = &quot;&quot; #接收邮箱账号 定时执行脚本修改crontab，设定为每天八点半运行。 $ crontab -e # 进入crontab的文本模式 30 8 * * * /usr/bin/python3 /root/ucas-covid19/sub.py &gt;&gt;/tmp/yqfk.log # 在文本最后一行添加,注意修改为实际路径，修改后立即生效。请注意这里使用是python3不是python2 也可自行设置crontab脚本执行时间： # Example of job definition: # .---------------- minute (0 - 59) # | .------------- hour (0 - 23) # | | .---------- day of month (1 - 31) # | | | .------- month (1 - 12) OR jan,feb,mar,apr ... # | | | | .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat # | | | | | # * * * * * user-name command to be executed","categories":[{"name":"技术","slug":"技术","permalink":"http://www.rainend.org/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[],"author":"walnut"},{"title":"射电天文简述","slug":"射电天文简述","date":"2021-10-23T14:56:56.000Z","updated":"2022-03-26T12:28:17.625Z","comments":true,"path":"2021/10/23/射电天文简述/","link":"","permalink":"http://www.rainend.org/2021/10/23/%E5%B0%84%E7%94%B5%E5%A4%A9%E6%96%87%E7%AE%80%E8%BF%B0/","excerpt":"","text":"序​ 射电天文学是什么？回答这个问题之前我想先谈论一下它的‘上位’问题：天文学是什么？研究天文的手段有哪些？ 研究地球是天文吗？ 不是。这种学科叫“地球物理”。 研究大气是天文吗？ 不是。这种学科叫”气象学“或“大气科学”。 研究大气层以外到月球之间的空间是天文吗？ 不是。这种学科叫“空间科学”。 ​ 现代天文学给出的定义是：天文学是研究宇宙天体^[1]^及其物理规律的科学。 ​ 人类通过来自宇宙的各种媒介(messenger)及其配套的观测手段来获取各类宇宙天体的信息，结合这些观测得到的信息去验证、修改、创造理论框架，不断地去尝试理解宇宙^[2]^。这些来自宇宙的媒介目前可分为四大类：电磁波、引力波、宇宙线还有中微子；其中电磁波是自古以来最主要的观测媒介，其历史可以追述到人类第一次抬头仰望星空的时候。（可见光也是一种波长在400nm-700nm的电磁波），下面就是一张经典的电磁波谱图片： ​ 图中标有彩色光谱的区域就是人类肉眼可见的光的频段范围，称为可见光窗口。可以看到地球大气对可见光的吸收并不是特别显著，所以人们仅用肉眼或许还需要加上光学望远镜就能直接观测到这个频段内宇宙所表现出的景象。 ​ 二十世纪三十年代之前，天文学家们都只能通过可见光这一种途径来进行天文观测，直到电磁波探测技术的出现给我们提供了另一种可以了解宇宙天体的途径。 ​ 在电磁波频谱图右边，那有一块很大的窗口就是射电窗口（对应的频率大概在15MHz-1300GHz），因为地球大气的组分对射电辐射的吸收不显著，对射电波来说大气可以看作是透明的，那么身在地球上的我们就可以用电磁波技术在另一片广阔的窗口来观测宇宙了，真是可喜可贺。 题外话：图中可以看到紫外、X射电波段的窗口被截断了，红外和远红外的观测条件也不是特别理想；所以X射线天文和远红外天文几乎都选择发射带有探测器/望远镜的卫星避开地球的大气去观测。 ​ 这里还要额外说明一下，虽然像x射线、可见光、射电等都是电磁波，但是它们所使用的探测原理和技术在很多方面可以说是毫不相干，一般情况下不可把不同波段的探测设备混作一谈来进行比较和拉踩，比如网上随处可见的把射电望远镜拿去和光学望远镜比口径大小，属于是贻笑大方了。不可轻易跨界比较的原因可以用波粒二象性来简要解释：越是高频的电磁波其粒子性越占主导，越低频的电磁波其波动性越占主导，那就需要不同的理论基础去实现。比如射电望远镜接收的是波动性显著的电磁波，所以其理论基础主要是电动力学、微波原理、天线原理、射电干涉原理等；射电望远镜的接收天线也都是金属，且不一定需要是抛物面形状的天线；和光学望远镜采用的理论基础及构成可以说是大相径庭。 射电天文望远镜先来介绍一下射电天文学家们的好帮手 主要参数单口径射电望远镜对于一个单口径的射电望远镜来说，无论它灵敏度和分辨率有多高、大小如何、长得多么奇怪，构成望远镜的主要部件也都是固定的那几样。","categories":[{"name":"文章","slug":"文章","permalink":"http://www.rainend.org/categories/%E6%96%87%E7%AB%A0/"}],"tags":[],"author":"walnut"},{"title":"说明书","slug":"说明书","date":"2021-06-30T19:38:05.000Z","updated":"2022-03-22T14:12:34.458Z","comments":true,"path":"2021/07/01/说明书/","link":"","permalink":"http://www.rainend.org/2021/07/01/%E8%AF%B4%E6%98%8E%E4%B9%A6/","excerpt":"","text":"绪这是一篇关于搭建、配置、部署、调教和使用hexo-sakura博客的教程备档，目的是方便发生了一些不可名状的事故后能快速抢救（w。 OS：ubuntu20 搭建与配置篇一、搭建hexo&amp;&amp;sakura1.准备工作需要提前安装：Node.js , Git Git貌似ubuntu已经自带，这里只介绍安装Node.js： 先在建特定目录下建文件，然后cd进去 mkdir /soft mkdir /soft/hexo cd /soft/hexo 可以从官网下载node.js，也可直接wget，下载后解压 wget https://nodejs.org/dist/v10.9.0/node-v10.9.0-linux-x64.tar.xz tar xf node-v10.9.0-linux-x64.tar.xz //解压 安装 cd node-v10.9.0-linux-x64/ ./bin/node -v // 如果出现版本号，说明安装成功 设置软连接 cd .. mv node-v10.9.0-linux-x64 nodejs //先改名 ln -s /soft/hexo/nodejs/bin/node /usr/local/bin/node ln -s /soft/hexo/nodejs/bin/npm /usr/local/bin/npm 完成后检测版本，出现版本号即为安装成功 node -v //检查node版本 npm -v //检查npm版本 git --version //检查git版本 2.安装hexo在任意目录创建空文件夹，在文件夹中打开bash npm i hexo-cli -g //安装Hexo hexo -v //验证安装 hexo init //初始化\\Blog文件夹 npm install //安装基本组件 hexo g //生成静态页面 hexo s //打开本地服务器 进入浏览器访问 localhost:4000 可以进入Hexo博客页面 3.载入sakura主题hexo-Sakura主题载入方式：直接覆盖到博客根目录 可以再用 hexo g &amp;&amp; hexo s 检查主题是否生效 二、将hexo自动部署到centos云服务器1.服务器创建git用户1.创建一个git用户来运行git服务（root不安全），并设置密码。 sudo useradd git -m sudo passwd git 2.增加git用户执行sudo的权限 chmod 740 /etc/sudoers vim /etc/sudoers 找到以下内容：root ALL=(ALL) ALL在下面添加一行 git ALL=(ALL) ALL 保存退出后改回权限： chmod 400 /etc/sudoers 2.服务器打开RSA认证RSA用公钥加密，私钥解密，成为加密通信。 2.1开启认证配置服务器端centos： cd /etc/ssh/ vi sshd_config 在sshd_config中开启以下几项：(前两项yes，后一项修改为如下) RSAAuthentication yes PubkeyAuthentication yes AuthorizedKeysFile .ssh/authorized_keys 重启sshd systemctl stop sshd.service systemctl start sshd.service 2.2建立ssh信任关系本地电脑生成秘钥对-》发送公钥到服务器-》本地可免密连接服务器 1.在本地电脑生成密钥对 ssh-keygen -t rsa -C &quot;邮箱&quot; 这里需要把生成的公钥id_rsa.pub的绝对路径复制下来，如： /home/xxx/.ssh/id_rsa.pub 2.在服务器端切换至git用户，创建~/.ssh 文件夹 su git mkdir ~/.ssh 或者root用户直接创建： cd /home/git/ mkdir .ssh 3.在本地电脑，发送公钥 id_rsa.pub 到 /home/git/.ssh/authorzied_keys ssh-copy-id -i /home/xxx/.ssh/id_rsa.pub git@1.1.1.1.//把公钥发送给服务器 ssh git@1.1.1.1 // 测试能否登录 通过ssh能够直接登录操作shell，后面要关掉git的这个shell权限的，不然要小心异地登录。 可在服务器端的/home/git/.ssh下ls查看公钥 4.服务器端，文件夹权限调整 authorzied_keys权限为600时才生效 cd /home/git/.ssh/ chmod 700 ~/.ssh chmod 600 ~/.ssh/authorzied_keys 现在就搭建好git桥梁，为后面实现hexo d部署时，可以自动上传. 3.创建blog.git空仓库需要先在centos中安装git，这里直接用yum安装。 sudo yum install -y git 1.切换到git用户，以下代码块都是在git用户权限下进行操作： su git //切换git用户 cd /home/git/ mkdir -p projects/blog //创建你的博客目录 mkdir repos &amp;&amp; cd repos git init --bare blog.git //创建一个空仓库 cd blog.git/hooks vi post-receive //创建hook钩子函数，输入以下内容 git --work-tree=/home/git/projects/blog --git-dir=/home/git/repos/blog.git checkout -f chmod +x post-receive // 修改钩子函数权限 2.改变 hexo.git 目录的拥有者为git用户： 在/home/git/repos目录下使用root用户： sudo chown -R git:git blog.git 3.添加备份目录 cd /home/git/projects/ mkdir -p tmp/blog 修改/home/git/repos/blog.git/hooks中钩子post-receive的内容： （重点是git clone 克隆到主目录home/git/projects/blog主目录要配置到nginx中去的） #!/bin/bash GIT_REPO=/home/git/repos/blog.git # git仓库 TMP_GIT_CLONE=/home/git/projects/tmp/blog PUBLIC_WWW=/home/git/projects/blog # 网站目录 rm -rf $&#123;TMP_GIT_CLONE&#125; git clone $GIT_REPO $TMP_GIT_CLONE rm -rf $&#123;PUBLIC_WWW&#125;/* cp -rf $&#123;TMP_GIT_CLONE&#125;/* $&#123;PUBLIC_WWW&#125; chmod +x post-receive # 赋予脚本的执行权限 git用户赋权： su git cd repos/ sudo chmod +x post-receive exit // 退出到 root 登录 chown -R git:git /home/git/repos/blog.git // 添加权限 sudo chown git:git -R /home/git/projects/ 4.为了安全起见，需要关闭git账号登录shell的权限(可放在最后做) vim /etc/passwd 找到git账号(一般在最后面)添加：/usr/bin/git-shell，如： git:x:1000:1000::/home/git:/usr/bin/git-shell 加上后git就只能git clone，如需shell操作，撤销/usr/bin/git-shell即可。 5.在本地任意一空目录，测试git仓库是否可用（测试步骤，稍后可清除） git clone git@1.1.1.1:/home/git/repos/blog.git 4.hexo配置修改博客根目录配置_config.yml，部署部分，增添repo：（以git用户的身份操作） deploy: type: git message: update gitee: git@1.1.1.1:/home/git/repos/blog.git branch: master 接下来，在用hexo clean &amp;&amp; hexo g -d时，就会自动上传。 只有在ssh秘钥配置成功，才能成功上传。如果需要修改公钥，要打开git操作shell的权限哦！vim /etc/passwd最后一句。及时开，及时关，做到万无一失。 现在public生成的静态文件已经完好推送到服务器了！现在需要Pages工作：即将静态页面显示在网站上。 5.nginx配置5.1 安装nginx安装所需插件 yum -y install gcc #安装gcc gcc -v #查看版本 yum install -y pcre pcre-devel #perl库 yum install -y zlib zlib-devel #压缩、解压缩库 yum install -y openssl openssl-devel #安全通信 yum install -y gd gd-devel 安装nginx 1.下载解压nginx安装包 wget http://nginx.org/download/nginx-1.9.9.tar.gz tar -zxvf nginx-1.9.9.tar.gz #选在合适的地方解压 2.cd到/nginx-1.9.9目录下，执行： ./configure make make install 3.配置文件 vi /usr/local/nginx/conf/nginx.conf nginx.conf说明 #user nobody; worker_processes 1; #工作进程：数目。根据硬件调整，通常等于cpu数量或者2倍cpu数量。 #错误日志存放路径 #error_log logs/error.log; #error_log logs/error.log notice; #error_log logs/error.log info; #pid logs/nginx.pid; # nginx进程pid存放路径 events &#123; worker_connections 1024; # 工作进程的最大连接数量 &#125; http &#123; include mime.types; #指定mime类型，由mime.type来定义 default_type application/octet-stream; # 日志格式设置 #log_format main &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39; # &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39; # &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;; #access_log logs/access.log main; #用log_format指令设置日志格式后，需要用access_log来指定日志文件存放路径 sendfile on; #指定nginx是否调用sendfile函数来输出文件，对于普通应用，必须设置on。 如果用来进行下载等应用磁盘io重负载应用，可设着off，以平衡磁盘与网络io处理速度，降低系统uptime。 #tcp_nopush on; #此选项允许或禁止使用socket的TCP_CORK的选项，此选项仅在sendfile的时候使用 #keepalive_timeout 0; #keepalive超时时间 keepalive_timeout 65; #gzip on; #开启gzip压缩服务 #虚拟主机 server &#123; listen 80; #配置监听端口号 server_name localhost; #配置访问域名，域名可以有多个，用空格隔开 #charset koi8-r; #字符集设置 #access_log logs/host.access.log main; location / &#123; root html; index index.html index.htm; &#125; #错误跳转页 #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root html; &#125; # proxy the PHP scripts to Apache listening on 127.0.0.1:80 # #location ~ \\.php$ &#123; # proxy_pass http://127.0.0.1; #&#125; # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000 # #location ~ \\.php$ &#123; #请求的url过滤，正则匹配，~为区分大小写，~*为不区分大小写。 # root html; #根目录 # fastcgi_pass 127.0.0.1:9000; #请求转向定义的服务器列表 # fastcgi_index index.php; # 如果请求的Fastcgi_index URI是以 / 结束的, 该指令设置的文件会被附加到URI的后面并保存在变量$fastcig_script_name中 # fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name; # include fastcgi_params; #&#125; # deny access to .htaccess files, if Apache&#39;s document root # concurs with nginx&#39;s one # #location ~ /\\.ht &#123; # deny all; #&#125; &#125; # another virtual host using mix of IP-, name-, and port-based configuration # #server &#123; # listen 8000; # listen somename:8080; # server_name somename alias another.alias; # location / &#123; # root html; # index index.html index.htm; # &#125; #&#125; # HTTPS server # #server &#123; # listen 443 ssl; #监听端口 # server_name localhost; #域名 # ssl_certificate cert.pem; #证书位置 # ssl_certificate_key cert.key; #私钥位置 # ssl_session_cache shared:SSL:1m; # ssl_session_timeout 5m; # ssl_ciphers HIGH:!aNULL:!MD5; #密码加密方式 # ssl_prefer_server_ciphers on; # ssl_prefer_server_ciphers on; # # location / &#123; # root html; # index index.html index.htm; # &#125; #&#125; &#125; 端口号（服务器控制台安全组规则要打开端口） 修改域名 修改根目录位置 修改用户为root用户 4.启动nginx sudo /usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf 5.2 nginx常用命令启动：/usr/local/nginx/sbin/nginx关闭：/usr/local/nginx/sbin/nginx -s stop重启：/usr/local/nginx/sbin/nginx -s reload查看nginx的进程pid： cat /usr/local/nginx/logs/nginx.pid查看版本：/usr/local/nginx/sbin/nginx -V修改配置文件：vim /usr/local/nginx/conf/nginx.conf修改完后测试：/usr/local/nginx/sbin/nginx -t 也可为nginx取别名，更方便的使用命令 alias nginx=&#39;/usr/local/nginx/sbin/nginx&#39; 启动：nginx关闭：nginx -s stop重启：nginx -s reload查看nginx的进程pid： cat /usr/local/nginx/logs/nginx.pid查看版本：nginx -V修改配置文件：vim /usr/local/nginx/conf/nginx.conf修改完后测试：nginx -t 三、使用cdn进行加速图片资源加速推荐方法： jsdelivr: 将你的图片传至GitHub仓库并发布，通过 https://cdn.jsdelivr.com/gh/|USERNAME|/目录/xxxxx.jpg （也可以是webp,png等格式图片，随意） PicGo: 项目地址：https://github.com/Molunerfinn/PicGo将图片上传到配置好的图床，直接引用 Cloudflare CDN替换为国内CDN这里使用的是国内的BootCDN，速度蛮不错 方法： 在 \\themes\\Sakura\\source\\js\\ 中找到 sakura-app.js 编辑搜索 cloudflare 找到第1114行如下内容： $.getScript(&#39;//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML&#39;, function () &#123; 替换为 $.getScript(&#39;//cdn.bootcss.com/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML&#39;, function () &#123; 在 \\themes\\Sakura\\layout_widget\\ 中找到 common-article.ejs 将 第2行 如下内容： &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css&quot;&gt; 替换为 &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.bootcss.com/tocbot/4.10.1/tocbot.css&quot;&gt; 字体资源替换在 \\themes\\Sakura\\layoout_partial\\ 中找到 head.ejs 这里存在拖慢加载速度的字体资源 将第28行以下内容 &lt;link rel=&quot;stylesheet&quot; href=&quot;https://fonts.googleapis.com/css?family=Noto+SerifMerriweather|Merriweather+Sans|Source+Code+Pro|Ubuntu:400,700|Noto+Serif+SC&quot; media=&quot;all&quot;&gt; 替换为 &lt;link rel=&quot;stylesheet&quot; href=&quot;https://flymc.top/css/0font.css&quot; media=&quot;all&quot;&gt; //这里引用的是我自己扒过来的字体库 //如果你想引用本地资源的话，也可以自己用上面的链接扒一扒，麻烦一点 //所以这里我提供了我自己的代码","categories":[{"name":"技术","slug":"技术","permalink":"http://www.rainend.org/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"web","slug":"web","permalink":"http://www.rainend.org/tags/web/"}],"author":"walnut"}],"categories":[{"name":"技术","slug":"技术","permalink":"http://www.rainend.org/categories/%E6%8A%80%E6%9C%AF/"},{"name":"资源","slug":"资源","permalink":"http://www.rainend.org/categories/%E8%B5%84%E6%BA%90/"},{"name":"文章","slug":"文章","permalink":"http://www.rainend.org/categories/%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"web","slug":"web","permalink":"http://www.rainend.org/tags/web/"}]}